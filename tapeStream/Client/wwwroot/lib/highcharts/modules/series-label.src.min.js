"use strict";!function(e){"object"==typeof module&&module.exports?module.exports=e.default=e:"function"==typeof define&&define.amd?define("highcharts/modules/series-label",["highcharts"],function(t){return e(t),e.Highcharts=t,e}):e("undefined"!=typeof Highcharts?Highcharts:void 0)}(function(t){var e=t?t._modules:{};function o(t,e,o,r){t.hasOwnProperty(e)||(t[e]=r.apply(null,o))}o(e,"Extensions/SeriesLabel.js",[e["Core/Animation/AnimationUtilities.js"],e["Core/Chart/Chart.js"],e["Core/Globals.js"],e["Core/Renderer/SVG/SVGRenderer.js"],e["Core/Utilities.js"]],function(t,e,o,r,n){var z=t.animObject,i=n.addEvent,B=n.extend,a=n.fireEvent,D=n.format,M=n.isNumber,j=n.pick,h=n.setOptions,s=n.syncTimeout,l=o.Series;function c(t,e,o,r,i,a){var h=(a-e)*(o-t)-(r-e)*(i-t);return 0<h||!(h<0)}function p(t,e,o,r,i,a,h,n){return c(t,e,i,a,h,n)!==c(o,r,i,a,h,n)&&c(t,e,o,r,i,a)!==c(t,e,o,r,h,n)}function Y(t,e,o,r,i,a,h,n){return p(t,e,t+o,e,i,a,h,n)||p(t+o,e,t+o,e+r,i,a,h,n)||p(t,e+r,t+o,e+r,i,a,h,n)||p(t,e,t,e+r,i,a,h,n)}function d(i){var a,h;this.renderer&&(h=z((a=this).renderer.globalAnimation).duration,a.labelSeries=[],a.labelSeriesMaxSum=0,n.clearTimeout(a.seriesLabelTimer),a.series.forEach(function(t){var e=t.options.label,o=t.labelBySeries,r=o&&o.closest;e.enabled&&t.visible&&(t.graph||t.area)&&!t.isSeriesBoosting&&(a.labelSeries.push(t),e.minFontSize&&e.maxFontSize&&(t.sum=t.yData.reduce(function(t,e){return(t||0)+(e||0)},0),a.labelSeriesMaxSum=Math.max(a.labelSeriesMaxSum,t.sum)),"load"===i.type&&(h=Math.max(h,z(t.options.animation).duration)),r&&(void 0!==r[0].plotX?o.animate({x:r[0].plotX+r[1],y:r[0].plotY+r[2]}):o.attr({opacity:0})))}),a.seriesLabelTimer=s(function(){a.series&&a.labelSeries&&a.drawSeriesLabels()},a.renderer.forExport||!h?0:h))}h({plotOptions:{series:{label:{enabled:!0,connectorAllowed:!1,connectorNeighbourDistance:24,format:void 0,formatter:void 0,minFontSize:null,maxFontSize:null,onArea:null,style:{fontWeight:"bold"},boxesToAvoid:[]}}}}),r.prototype.symbols.connector=function(t,e,o,r,i){var a,h,n=i&&i.anchorX,s=i&&i.anchorY,l=o/2;return M(n)&&M(s)&&(a=[["M",n,s]],(h=e-s)<0&&(h=-r-h),h<o&&(l=n<t+o/2?h:o-h),e+r<s?a.push(["L",t+l,e+r]):s<e?a.push(["L",t+l,e]):n<t?a.push(["L",t,e+r/2]):t+o<n&&a.push(["L",t+o,e+r/2])),a||[]},l.prototype.getPointsOnGraph=function(){if(this.xAxis||this.yAxis){var t,e,o,r,i,a,h,n,s,l,c=this.points,p=[],d=this.graph||this.area,u=d.element,f=this.chart.inverted,x=this.xAxis,b=this.yAxis,g=f?b.pos:x.pos,m=f?x.pos:b.pos,y=j(this.options.label.onArea,!!this.area),Y=b.getThreshold(this.options.threshold),X={};if(this.getPointSpline&&u.getPointAtLength&&!y&&c.length<this.chart.plotSizeX/16){for(d.toD&&(l=d.attr("d"),d.attr({d:d.toD})),h=u.getTotalLength(),o=0;o<h;o+=16)w({chartX:g+(t=u.getPointAtLength(o)).x,chartY:m+t.y,plotX:t.x,plotY:t.y});l&&d.attr({d:l}),(t=c[c.length-1]).chartX=g+t.plotX,t.chartY=m+t.plotY,w(t)}else for(h=c.length,o=0;o<h;o+=1){if(t=c[o],e=c[o-1],t.chartX=g+t.plotX,t.chartY=m+t.plotY,y&&(t.chartCenterY=m+(t.plotY+j(t.yBottom,Y))/2),0<o&&(r=Math.abs(t.chartX-e.chartX),i=Math.abs(t.chartY-e.chartY),16<(a=Math.max(r,i))))for(n=Math.ceil(a/16),s=1;s<n;s+=1)w({chartX:e.chartX+(t.chartX-e.chartX)*(s/n),chartY:e.chartY+(t.chartY-e.chartY)*(s/n),chartCenterY:e.chartCenterY+(t.chartCenterY-e.chartCenterY)*(s/n),plotX:e.plotX+(t.plotX-e.plotX)*(s/n),plotY:e.plotY+(t.plotY-e.plotY)*(s/n)});M(t.plotY)&&w(t)}return p}function w(t){var e=Math.round(t.plotX/8)+","+Math.round(t.plotY/8);X[e]||(X[e]=1,p.push(t))}},l.prototype.labelFontSize=function(t,e){return t+this.sum/this.chart.labelSeriesMaxSum*(e-t)+"px"},l.prototype.checkClearPoint=function(t,e,o,r){var i,a,h,n,s,l,c,p,d,u,f,x=Number.MAX_VALUE,b=Number.MAX_VALUE,g=j(this.options.label.onArea,!!this.area),m=g||this.options.label.connectorAllowed,y=this.chart;for(p=0;p<y.boxesToAvoid.length;p+=1)if(u=y.boxesToAvoid[p],!((f={left:t,right:t+o.width,top:e,bottom:e+o.height}).left>u.right||f.right<u.left||f.top>u.bottom||f.bottom<u.top))return!1;for(p=0;p<y.series.length;p+=1)if(n=(h=y.series[p]).interpolatedPoints,h.visible&&n){for(d=1;d<n.length;d+=1){if(n[d].chartX>=t-16&&n[d-1].chartX<=t+o.width+16){if(Y(t,e,o.width,o.height,n[d-1].chartX,n[d-1].chartY,n[d].chartX,n[d].chartY))return!1;this===h&&!s&&r&&(s=Y(t-16,e-16,o.width+32,o.height+32,n[d-1].chartX,n[d-1].chartY,n[d].chartX,n[d].chartY))}!m&&!s||this===h&&!g||(l=t+o.width/2-n[d].chartX,c=e+o.height/2-n[d].chartY,x=Math.min(x,l*l+c*c))}if(!g&&m&&this===h&&(r&&!s||x<Math.pow(this.options.label.connectorNeighbourDistance,2))){for(d=1;d<n.length;d+=1)(i=Math.min(Math.pow(t+o.width/2-n[d].chartX,2)+Math.pow(e+o.height/2-n[d].chartY,2),Math.pow(t-n[d].chartX,2)+Math.pow(e-n[d].chartY,2),Math.pow(t+o.width-n[d].chartX,2)+Math.pow(e-n[d].chartY,2),Math.pow(t+o.width-n[d].chartX,2)+Math.pow(e+o.height-n[d].chartY,2),Math.pow(t-n[d].chartX,2)+Math.pow(e+o.height-n[d].chartY,2)))<b&&(b=i,a=n[d]);s=!0}}return!(r&&!s)&&{x:t,y:e,weight:x-(a?b:0),connectorPoint:a}},e.prototype.drawSeriesLabels=function(){var k=this,t=this.labelSeries;k.boxesToAvoid=[],t.forEach(function(t){t.interpolatedPoints=t.getPointsOnGraph(),(t.options.label.boxesToAvoid||[]).forEach(function(t){k.boxesToAvoid.push(t)})}),k.series.forEach(function(t){var e=t.options.label;if(e&&(t.xAxis||t.yAxis)){var o,r,i,a,h,n,s,l,c,p,d,u,f,x,b,g=[],m=k.inverted,y=m?t.yAxis.pos:t.xAxis.pos,Y=m?t.xAxis.pos:t.yAxis.pos,X=k.inverted?t.yAxis.len:t.xAxis.len,w=k.inverted?t.xAxis.len:t.yAxis.len,M=t.interpolatedPoints,A=j(e.onArea,!!t.area),S=t.labelBySeries,v=!S,P=e.minFontSize,C=e.maxFontSize,L="highcharts-color-"+j(t.colorIndex,"none");if(A&&!m&&(s=[t.xAxis.toPixels(t.xData[0]),t.xAxis.toPixels(t.xData[t.xData.length-1])],l=Math.min.apply(Math,s),c=Math.max.apply(Math,s)),t.visible&&!t.isSeriesBoosting&&M){for(S||(p=t.name,"string"==typeof e.format?p=D(e.format,t,k):e.formatter&&(p=e.formatter.call(t)),t.labelBySeries=S=k.renderer.label(p,0,-9999,"connector").addClass("highcharts-series-label highcharts-series-label-"+t.index+" "+(t.options.className||"")+" "+L),k.renderer.styledMode||(S.css(B({color:A?k.renderer.getContrast(t.color):t.color},e.style||{})),S.attr({opacity:k.renderer.forExport?1:0,stroke:t.color,"stroke-width":1})),P&&C&&S.css({fontSize:t.labelFontSize(P,C)}),S.attr({padding:0,zIndex:3}).add()),(o=S.getBBox()).width=Math.round(o.width),h=M.length-1;0<h;--h)A?T(r=M[h].chartX-o.width/2,i=M[h].chartCenterY-o.height/2,o)&&(n=t.checkClearPoint(r,i,o)):(T(r=M[h].chartX+3,i=M[h].chartY-o.height-3,o)&&(n=t.checkClearPoint(r,i,o,!0)),n&&g.push(n),T(r=M[h].chartX+3,i=M[h].chartY+3,o)&&(n=t.checkClearPoint(r,i,o,!0)),n&&g.push(n),T(r=M[h].chartX-o.width-3,i=M[h].chartY+3,o)&&(n=t.checkClearPoint(r,i,o,!0)),n&&g.push(n),T(r=M[h].chartX-o.width-3,i=M[h].chartY-o.height-3,o)&&(n=t.checkClearPoint(r,i,o,!0))),n&&g.push(n);if(e.connectorAllowed&&!g.length&&!A)for(r=y+X-o.width;y<=r;r-=16)for(i=Y;i<Y+w-o.height;i+=16)(a=t.checkClearPoint(r,i,o,!0))&&g.push(a);g.length?(g.sort(function(t,e){return e.weight-t.weight}),n=g[0],k.boxesToAvoid.push({left:n.x,right:n.x+o.width,top:n.y,bottom:n.y+o.height}),(d=Math.sqrt(Math.pow(Math.abs(n.x-(S.x||0)),2)+Math.pow(Math.abs(n.y-(S.y||0)),2)))&&t.labelBySeries&&(u={opacity:k.renderer.forExport?1:0,x:n.x,y:n.y},f={opacity:1},d<=10&&(f={x:u.x,y:u.y},u={}),x=void 0,v&&((x=z(t.options.animation)).duration*=.2),t.labelBySeries.attr(B(u,{anchorX:n.connectorPoint&&n.connectorPoint.plotX+y,anchorY:n.connectorPoint&&n.connectorPoint.plotY+Y})).animate(f,x),t.options.kdNow=!0,t.buildKDTree(),(b=t.searchPoint({chartX:n.x,chartY:n.y},!0))&&(S.closest=[b,n.x-(b.plotX||0),n.y-(b.plotY||0)]))):E()}else E()}function T(t,e,o){var r=Math.max(y,j(l,-1/0)),i=Math.min(y+X,j(c,1/0));return r<t&&t<=i-o.width&&Y<=e&&e<=Y+w-o.height}function E(){S&&(t.labelBySeries=S.destroy())}}),a(k,"afterDrawSeriesLabels")},i(e,"load",d),i(e,"redraw",d)}),o(e,"masters/modules/series-label.src.js",[],function(){})});