"use strict";!function(t){"object"==typeof module&&module.exports?module.exports=t.default=t:"function"==typeof define&&define.amd?define("highcharts/modules/sankey",["highcharts"],function(o){return t(o),t.Highcharts=o,t}):t("undefined"!=typeof Highcharts?Highcharts:void 0)}(function(o){var t=o?o._modules:{};function e(o,t,e,i){o.hasOwnProperty(t)||(o[t]=i.apply(null,e))}e(t,"Mixins/Nodes.js",[t["Core/Globals.js"],t["Core/Series/Point.js"],t["Core/Utilities.js"]],function(o,i,t){var n=t.defined,s=t.extend,r=t.find,a=t.pick;return o.NodesMixin={createNode:function(o){function t(o,t){return r(o,function(o){return o.id===t})}var e,n=t(this.nodes,o),i=this.pointClass;return n||(e=this.options.nodes&&t(this.options.nodes,o),(n=(new i).init(this,s({className:"highcharts-node",isNode:!0,id:o,y:1},e))).linksTo=[],n.linksFrom=[],n.formatPrefix="node",n.name=n.name||n.options.id||"",n.mass=a(n.options.mass,n.options.marker&&n.options.marker.radius,this.options.marker&&this.options.marker.radius,4),n.getSum=function(){var t=0,e=0;return n.linksTo.forEach(function(o){t+=o.weight}),n.linksFrom.forEach(function(o){e+=o.weight}),Math.max(t,e)},n.offset=function(o,t){for(var e=0,i=0;i<n[t].length;i++){if(n[t][i]===o)return e;e+=n[t][i].weight}},n.hasShape=function(){var t=0;return n.linksTo.forEach(function(o){o.outgoing&&t++}),!n.linksTo.length||t!==n.linksTo.length},this.nodes.push(n)),n},generatePoints:function(){var t=this.chart,e={};o.Series.prototype.generatePoints.call(this),this.nodes||(this.nodes=[]),this.colorCounter=0,this.nodes.forEach(function(o){o.linksFrom.length=0,o.linksTo.length=0,o.level=o.options.level}),this.points.forEach(function(o){n(o.from)&&(e[o.from]||(e[o.from]=this.createNode(o.from)),e[o.from].linksFrom.push(o),o.fromNode=e[o.from],t.styledMode?o.colorIndex=a(o.options.colorIndex,e[o.from].colorIndex):o.color=o.options.color||e[o.from].color),n(o.to)&&(e[o.to]||(e[o.to]=this.createNode(o.to)),e[o.to].linksTo.push(o),o.toNode=e[o.to]),o.name=o.name||o.id},this),this.nodeLookup=e},setData:function(){this.nodes&&(this.nodes.forEach(function(o){o.destroy()}),this.nodes.length=0),o.Series.prototype.setData.apply(this,arguments)},destroy:function(){return this.data=[].concat(this.points||[],this.nodes),o.Series.prototype.destroy.apply(this,arguments)},setNodeState:function(o){var t=arguments,e=this.isNode?this.linksTo.concat(this.linksFrom):[this.fromNode,this.toNode];"select"!==o&&e.forEach(function(o){o&&o.series&&(i.prototype.setState.apply(o,t),o.isNode||(o.fromNode.graphic&&i.prototype.setState.apply(o.fromNode,t),o.toNode&&o.toNode.graphic&&i.prototype.setState.apply(o.toNode,t)))}),i.prototype.setState.apply(this,t)}}}),e(t,"Mixins/TreeSeries.js",[t["Core/Color/Color.js"],t["Core/Utilities.js"]],function(k,o){function p(o){return"boolean"==typeof o}var u=o.extend,l=o.isArray,h=o.isNumber,d=o.isObject,c=o.merge,C=o.pick;return{getColor:function(o,t){var e,i,n,s,r,a,l,h,d=t.index,c=t.mapOptionsToLevel,p=t.parentColor,u=t.parentColorIndex,f=t.series,m=t.colors,g=t.siblings,v=f.points,y=f.chart.options.chart;return o&&(e=v[o.i],i=c[o.level]||{},e&&i.colorByPoint&&(s=e.index%(m?m.length:y.colorCount),n=m&&m[s]),f.chart.styledMode||(r=C(e&&e.options.color,i&&i.color,n,p&&(l=p,(h=i&&i.colorVariation)&&"brightness"===h.key?k.parse(l).brighten(h.to*(d/g)).get():l),f.color)),a=C(e&&e.options.colorIndex,i&&i.colorIndex,s,u,t.colorIndex)),{color:r,colorIndex:a}},getLevelOptions:function(o){var s,t,e,r,i,n,a=null;if(d(o))for(a={},r=h(o.from)?o.from:1,n=o.levels,t={},s=d(o.defaults)?o.defaults:{},l(n)&&(t=n.reduce(function(o,t){var e,i,n;return d(t)&&h(t.level)&&(n=c({},t),i=p(n.levelIsConstant)?n.levelIsConstant:s.levelIsConstant,delete n.levelIsConstant,delete n.level,e=t.level+(i?0:r-1),d(o[e])?u(o[e],n):o[e]=n),o},{})),i=h(o.to)?o.to:1,e=0;e<=i;e++)a[e]=c({},s,d(t[e])?t[e]:{});return a},setTreeValues:function i(n,s){var o,t=s.before,e=s.idRoot,r=s.mapIdToNode[e],a=!p(s.levelIsConstant)||s.levelIsConstant,l=s.points[n.i],h=l&&l.options||{},d=0,c=[];return u(n,{levelDynamic:n.level-(a?0:r.level),name:C(l&&l.name,""),visible:e===n.id||!!p(s.visible)&&s.visible}),"function"==typeof t&&(n=t(n,s)),n.children.forEach(function(o,t){var e=u({},s);u(e,{index:t,siblings:n.children.length,visible:n.visible}),o=i(o,e),c.push(o),o.visible&&(d+=o.val)}),n.visible=0<d||n.visible,o=C(h.value,d),u(n,{children:c,childrenTotal:d,isLeaf:n.visible&&!d,val:o}),n},updateRootId:function(o){var t,e;return d(o)&&(e=d(o.options)?o.options:{},t=C(o.rootNode,e.rootId,""),d(o.userOptions)&&(o.userOptions.rootId=t),o.rootNode=t),t}}}),e(t,"Series/SankeySeries.js",[t["Core/Series/Series.js"],t["Core/Series/CartesianSeries.js"],t["Core/Color/Color.js"],t["Series/ColumnSeries.js"],t["Core/Globals.js"],t["Mixins/Nodes.js"],t["Core/Series/Point.js"],t["Mixins/TreeSeries.js"],t["Core/Utilities.js"]],function(o,t,h,e,i,n,s,r,a){var c=r.getLevelOptions,l=a.defined,d=a.find,g=a.isObject,v=a.merge,y=a.pick,p=a.relativeLength,u=a.stableSort;o.seriesType("sankey","column",{borderWidth:0,colorByPoint:!0,curveFactor:.33,dataLabels:{enabled:!0,backgroundColor:"none",crop:!1,nodeFormat:void 0,nodeFormatter:function(){return this.point.name},format:void 0,formatter:function(){},inside:!0},inactiveOtherPoints:!0,linkOpacity:.5,minLinkWidth:0,nodeWidth:20,nodePadding:10,showInLegend:!1,states:{hover:{linkOpacity:1},inactive:{linkOpacity:.1,opacity:.1,animation:{duration:50}}},tooltip:{followPointer:!0,headerFormat:'<span style="font-size: 10px">{series.name}</span><br/>',pointFormat:"{point.fromNode.name} â†’ {point.toNode.name}: <b>{point.weight}</b><br/>",nodeFormat:"{point.name}: <b>{point.sum}</b><br/>"}},{isCartesian:!1,invertable:!0,forceDL:!0,orderNodes:!0,pointArrayMap:["from","to"],createNode:n.createNode,searchPoint:i.noop,setData:n.setData,destroy:n.destroy,getNodePadding:function(){var o,t=this.options.nodePadding||0;return!this.nodeColumns||(o=this.nodeColumns.reduce(function(o,t){return Math.max(o,t.length)},0))*t>this.chart.plotSizeY&&(t=this.chart.plotSizeY/o),t},createNodeColumn:function(){var l=this,t=this.chart,h=[];return h.sum=function(){return this.reduce(function(o,t){return o+t.getSum()},0)},h.offset=function(o,t){for(var e=0,i=l.nodePadding,n=0;n<h.length;n++){var s=h[n].getSum(),r=Math.max(s*t,l.options.minLinkWidth),a=s?r+i:0;if(h[n]===o)return{relativeTop:e+p(o.options.offset||0,a)};e+=a}},h.top=function(e){var i=l.nodePadding,o=this.reduce(function(o,t){return 0<o&&(o+=i),o+=Math.max(t.getSum()*e,l.options.minLinkWidth)},0);return(t.plotSizeY-o)/2},h},createNodeColumns:function(){var s=[];this.nodes.forEach(function(i){var o,n,t,e=-1;if(!l(i.options.column))if(0===i.linksTo.length)i.column=0;else{for(n=0;n<i.linksTo.length;n++)(t=i.linksTo[0]).fromNode.column>e&&(e=(o=t.fromNode).column);i.column=e+1,o&&"hanging"===o.options.layout&&(i.hangsFrom=o,n=-1,d(o.linksFrom,function(o,t){var e=o.toNode===i;return e&&(n=t),e}),i.column+=n)}s[i.column]||(s[i.column]=this.createNodeColumn()),s[i.column].push(i)},this);for(var o=0;o<s.length;o++)void 0===s[o]&&(s[o]=this.createNodeColumn());return s},hasData:function(){return!!this.processedXData.length},pointAttribs:function(o,t){var e=this,i=o.isNode?o.level:o.fromNode.level,n=e.mapOptionsToLevel[i||0]||{},s=o.options,r=n.states&&n.states[t]||{},a=["colorByPoint","borderColor","borderWidth","linkOpacity"].reduce(function(o,t){return o[t]=y(r[t],s[t],n[t],e.options[t]),o},{}),l=y(r.color,s.color,a.colorByPoint?o.color:n.color);return o.isNode?{fill:l,stroke:a.borderColor,"stroke-width":a.borderWidth}:{fill:h.parse(l).setOpacity(a.linkOpacity).get()}},generatePoints:function(){n.generatePoints.apply(this,arguments),this.orderNodes&&(this.nodes.filter(function(o){return 0===o.linksTo.length}).forEach(function(o){!function t(o,e){void 0===o.level&&(o.level=e,o.linksFrom.forEach(function(o){o.toNode&&t(o.toNode,e+1)}))}(o,0)}),u(this.nodes,function(o,t){return o.level-t.level}))},translateNode:function(o,t){var e,i,n,s=this.translationFactor,r=this.chart,a=this.options,l=o.getSum(),h=Math.max(Math.round(l*s),this.options.minLinkWidth),d=Math.round(a.borderWidth)%2/2,c=t.offset(o,s),p=Math.floor(y(c.absoluteTop,t.top(s)+c.relativeTop))+d,u=Math.floor(this.colDistance*o.column+a.borderWidth/2)+d,f=r.inverted?r.plotSizeX-u:u,m=Math.round(this.nodeWidth);(o.sum=l)?(o.shapeType="rect",o.nodeX=f,o.nodeY=p,r.inverted?o.shapeArgs={x:f-m,y:r.plotSizeY-p-h,width:o.options.height||a.height||m,height:o.options.width||a.width||h}:o.shapeArgs={x:f,y:p,width:o.options.width||a.width||m,height:o.options.height||a.height||h},o.shapeArgs.display=o.hasShape()?"":"none",o.dlOptions=(e={level:this.mapOptionsToLevel[o.level],optionsPoint:o.options},i=g(e.optionsPoint)?e.optionsPoint.dataLabels:{},n=g(e.level)?e.level.dataLabels:{},v({style:{}},n,i)),o.plotY=1,o.tooltipPos=r.inverted?[r.plotSizeY-o.shapeArgs.y-o.shapeArgs.height/2,r.plotSizeX-o.shapeArgs.x-o.shapeArgs.width/2]:[o.shapeArgs.x+o.shapeArgs.width/2,o.shapeArgs.y+o.shapeArgs.height/2]):o.dlOptions={enabled:!1}},translateLink:function(n){function o(o,t){var e,i=o.offset(n,t)*S;return Math.min(o.nodeY+i,o.nodeY+(null===(e=o.shapeArgs)||void 0===e?void 0:e.height)-x)}var t,e,i,s,r,a,l,h,d,c,p,u,f,m,g,v,y,k,C=n.fromNode,b=n.toNode,N=this.chart,S=this.translationFactor,x=Math.max(n.weight*S,this.options.minLinkWidth),L=this.options,P=(N.inverted?-this.colDistance:this.colDistance)*L.curveFactor,T=o(C,"linksFrom"),M=o(b,"linksTo"),O=C.nodeX,w=this.nodeWidth,W=b.column*this.colDistance,j=n.outgoing,F=O+w<W;N.inverted&&(T=N.plotSizeY-T,M=(N.plotSizeY||0)-M,W=N.plotSizeX-W,w=-w,x=-x,F=W<O),n.shapeType="path",n.linkBase=[T,T+x,M,M+x],F&&"number"==typeof M?n.shapeArgs={d:[["M",O+w,T],["C",O+w+P,T,W-P,M,W,M],["L",W+(j?w:0),M+x/2],["L",W,M+x],["C",W-P,M+x,O+w+P,T+x,O+w,T+x],["Z"]]}:"number"==typeof M&&(t=N.plotHeight-T-x,e=W-20-x,i=W-20,a=(r=(s=O+w)+20)+x,p=(c=(d=(h=(l=T+x)+20)+t)+20)+x,f=(u=M+x)+20,m=l-.7*x,g=c+.7*x,v=u-.7*x,y=W-.7*x,k=s+.7*x,n.shapeArgs={d:[["M",s,T],["C",k,T,a,m,a,h],["L",a,d],["C",a,g,k,p,s,p],["L",W,p],["C",y,p,e,g,e,d],["L",e,f],["C",e,v,y,M,W,M],["L",W,u],["C",i,u,i,u,i,f],["L",i,d],["C",i,c,i,c,W,c],["L",s,c],["C",r,c,r,c,r,d],["L",r,h],["C",r,l,r,l,s,l],["Z"]]}),n.dlBox={x:O+(W-O+w)/2,y:T+(M-T)/2,height:x,width:0},n.tooltipPos=N.inverted?[N.plotSizeY-n.dlBox.y-x/2,N.plotSizeX-n.dlBox.x]:[n.dlBox.x,n.dlBox.y+x/2],n.y=n.plotY=1,n.color||(n.color=C.color)},translate:function(){var a=this;this.processedXData||this.processData(),this.generatePoints(),this.nodeColumns=this.createNodeColumns(),this.nodeWidth=p(this.options.nodeWidth,this.chart.plotSizeX);var l=this,h=this.chart,d=this.options,o=this.nodeWidth,t=this.nodeColumns;this.nodePadding=this.getNodePadding(),this.translationFactor=t.reduce(function(o,t){return Math.min(o,function(t){for(var o,e,i=t.slice(),n=a.options.minLinkWidth||0,s=0,r=h.plotSizeY-d.borderWidth-(t.length-1)*l.nodePadding;t.length;){for(s=r/t.sum(),o=!1,e=t.length;e--;)t[e].getSum()*s<n&&(t.splice(e,1),r-=n,o=!0);if(!o)break}return t.length=0,i.forEach(function(o){return t.push(o)}),s}(t))},1/0),this.colDistance=(h.plotSizeX-o-d.borderWidth)/Math.max(1,t.length-1),l.mapOptionsToLevel=c({from:1,levels:d.levels,to:t.length-1,defaults:{borderColor:d.borderColor,borderRadius:d.borderRadius,borderWidth:d.borderWidth,color:l.color,colorByPoint:d.colorByPoint,levelIsConstant:!0,linkColor:d.linkColor,linkLineWidth:d.linkLineWidth,linkOpacity:d.linkOpacity,states:d.states}}),t.forEach(function(t){t.forEach(function(o){l.translateNode(o,t)})},this),this.nodes.forEach(function(o){o.linksFrom.forEach(function(o){(o.weight||o.isNull)&&o.to&&(l.translateLink(o),o.allowShadow=!1)})})},render:function(){var o=this.points;this.points=this.points.concat(this.nodes||[]),e.prototype.render.call(this),this.points=o},animate:t.prototype.animate},{applyOptions:function(o,t){return s.prototype.applyOptions.call(this,o,t),l(this.options.level)&&(this.options.column=this.column=this.options.level),this},setState:n.setNodeState,getClassName:function(){return(this.isNode?"highcharts-node ":"highcharts-link ")+s.prototype.getClassName.call(this)},isValid:function(){return this.isNode||"number"==typeof this.weight}})}),e(t,"masters/modules/sankey.src.js",[],function(){})});