"use strict";!function(e){"object"==typeof module&&module.exports?module.exports=e.default=e:"function"==typeof define&&define.amd?define("highcharts/modules/marker-clusters",["highcharts"],function(t){return e(t),e.Highcharts=t,e}):e("undefined"!=typeof Highcharts?Highcharts:void 0)}(function(t){var e=t?t._modules:{};function a(t,e,a,i){t.hasOwnProperty(e)||(t[e]=i.apply(null,a))}a(e,"Extensions/MarkerClusters.js",[e["Core/Animation/AnimationUtilities.js"],e["Core/Series/Series.js"],e["Core/Chart/Chart.js"],e["Core/Globals.js"],e["Core/Options.js"],e["Core/Series/Point.js"],e["Core/Renderer/SVG/SVGRenderer.js"],e["Core/Utilities.js"],e["Core/Axis/Axis.js"]],function(t,e,a,i,o,r,n,s,l){var I=t.animObject,p=o.defaultOptions,D=s.addEvent,j=s.defined,b=s.error,M=s.isArray,P=s.isFunction,X=s.isObject,Y=s.isNumber,v=s.merge,L=s.objectEach,z=s.relativeLength,k=s.syncTimeout,u=i.Series,d=e.seriesTypes.scatter,E=u.prototype.generatePoints,h=0,c=[],G={enabled:!1,allowOverlap:!0,animation:{duration:500},drillToCluster:!0,minimumClusterSize:2,layoutAlgorithm:{gridSize:50,distance:40,kmeansThreshold:100},marker:{symbol:"cluster",radius:15,lineWidth:0,lineColor:"#ffffff"},dataLabels:{enabled:!0,format:"{point.clusterPointsAmount}",verticalAlign:"middle",align:"center",style:{color:"contrast"},inside:!0}};function V(t){for(var e=t.length,a=0,i=0,o=0;o<e;o++)a+=t[o].x,i+=t[o].y;return{x:a/e,y:i/e}}function f(t,e){var a=[];return a.length=e,t.clusters.forEach(function(t){t.data.forEach(function(t){a[t.dataIndex]=t})}),t.noise.forEach(function(t){a[t.data[0].dataIndex]=t.data[0]}),a}function m(t,e,a){t.attr({opacity:e}).animate({opacity:1},a)}function S(t,e,a,i,o){t.point&&(i&&t.point.graphic&&(t.point.graphic.show(),m(t.point.graphic,e,a)),o&&t.point.dataLabel&&(t.point.dataLabel.show(),m(t.point.dataLabel,e,a)))}function A(t,e,a){t.point&&(e&&t.point.graphic&&t.point.graphic.hide(),a&&t.point.dataLabel&&t.point.dataLabel.hide())}function O(t,e,a,i){S(t,i,a,!0,!0),e.forEach(function(t){t.point&&t.point.destroy&&t.point.destroy()})}function T(){return Math.random().toString(36).substring(2,7)+"-"+h++}(p.plotOptions||{}).series=v((p.plotOptions||{}).series,{cluster:G,tooltip:{clusterFormat:"<span>Clustered points: {point.clusterPointsAmount}</span><br/>"}}),n.prototype.symbols.cluster=function(t,e,a,i){var o=a/2,r=i/2,n=this.arc(t+o,e+r,o-4,r-4,{start:.5*Math.PI,end:2.5*Math.PI,open:!1}),s=this.arc(t+o,e+r,o-3,r-3,{start:.5*Math.PI,end:2.5*Math.PI,innerR:o-2,open:!1});return this.arc(t+o,e+r,o-1,r-1,{start:.5*Math.PI,end:2.5*Math.PI,innerR:o,open:!1}).concat(s,n)},d.prototype.animateClusterPoint=function(t){var e,a,i,o=this,r=o.xAxis,n=o.yAxis,s=o.chart,l=o.options.cluster,p=I((l||{}).animation),u=p.duration||500,d=(o.markerClusterInfo||{}).pointsState,h=(d||{}).newState,c=(d||{}).oldState,f=[],m=0,x=0,g=0,y=!1,C=!1;c&&h&&(i=h[t.stateId],x=r.toPixels(i.x)-s.plotLeft,g=n.toPixels(i.y)-s.plotTop,1===i.parentsId.length?(e=(h||{})[t.stateId].parentsId[0],a=c[e],i.point&&i.point.graphic&&a&&a.point&&a.point.plotX&&a.point.plotY&&a.point.plotX!==i.point.plotX&&a.point.plotY!==i.point.plotY&&(m=i.point.graphic.getBBox().width/2,i.point.graphic.attr({x:a.point.plotX-m,y:a.point.plotY-m}),i.point.graphic.animate({x:x-(i.point.graphic.radius||0),y:g-(i.point.graphic.radius||0)},p,function(){C=!0,a.point&&a.point.destroy&&a.point.destroy()}),i.point.dataLabel&&i.point.dataLabel.alignAttr&&a.point.dataLabel&&a.point.dataLabel.alignAttr&&(i.point.dataLabel.attr({x:a.point.dataLabel.alignAttr.x,y:a.point.dataLabel.alignAttr.y}),i.point.dataLabel.animate({x:i.point.dataLabel.alignAttr.x,y:i.point.dataLabel.alignAttr.y},p)))):0===i.parentsId.length?(A(i,!0,!0),k(function(){S(i,.1,p,!0,!0)},u/2)):(A(i,!0,!0),i.parentsId.forEach(function(t){c&&c[t]&&(a=c[t],f.push(a),a.point&&a.point.graphic&&(y=!0,a.point.graphic.show(),a.point.graphic.animate({x:x-(a.point.graphic.radius||0),y:g-(a.point.graphic.radius||0),opacity:.4},p,function(){C=!0,O(i,f,p,.7)}),a.point.dataLabel&&-9999!==a.point.dataLabel.y&&i.point&&i.point.dataLabel&&i.point.dataLabel.alignAttr&&(a.point.dataLabel.show(),a.point.dataLabel.animate({x:i.point.dataLabel.alignAttr.x,y:i.point.dataLabel.alignAttr.y,opacity:.4},p))))}),k(function(){C||O(i,f,p,.85)},u),y||k(function(){O(i,f,p,.1)},u/2)))},d.prototype.getGridOffset=function(){var t=this,e=t.chart,a=t.xAxis,i=t.yAxis;return{plotLeft:t.dataMinX&&t.dataMaxX?a.reversed?a.toPixels(t.dataMaxX):a.toPixels(t.dataMinX):e.plotLeft,plotTop:t.dataMinY&&t.dataMaxY?i.reversed?i.toPixels(t.dataMinY):i.toPixels(t.dataMaxY):e.plotTop}},d.prototype.getScaledGridSize=function(t){var e,a,i=this.xAxis,o=!0,r=1,n=1,s=t.processedGridSize||G.layoutAlgorithm.gridSize;for(this.gridValueSize||(this.gridValueSize=Math.abs(i.toValue(s)-i.toValue(0))),e=+(s/(i.toPixels(this.gridValueSize)-i.toPixels(0))).toFixed(14);o&&1!=e;)a=Math.pow(2,r),.75<e&&e<1.25?o=!1:1/a<=e&&e<1/a*2?(o=!1,n=a):e<=a&&a/2<e&&(o=!1,n=1/a),r++;return s/n/e},d.prototype.getRealExtremes=function(){var t,e,a=this.chart,i=this.xAxis,o=this.yAxis,r=i?i.toValue(a.plotLeft):0,n=i?i.toValue(a.plotLeft+a.plotWidth):0,s=o?o.toValue(a.plotTop):0,l=o?o.toValue(a.plotTop+a.plotHeight):0;return n<r&&(n=(t=[r,n])[0],r=t[1]),l<s&&(l=(e=[s,l])[0],s=e[1]),{minX:r,maxX:n,minY:s,maxY:l}},d.prototype.onDrillToCluster=function(t){(t.point||t.target).firePointEvent("drillToCluster",t,function(t){var e,a,i,o,r,n,s,l,p,u,d=t.point||t.target,h=d.series,c=d.series.xAxis,f=d.series.yAxis,m=d.series.chart;(h.options.cluster||{}).drillToCluster&&d.clusteredData&&(r=d.clusteredData.map(function(t){return t.x}).sort(function(t,e){return t-e}),n=d.clusteredData.map(function(t){return t.y}).sort(function(t,e){return t-e}),s=r[0],p=r[r.length-1],l=n[0],u=n[n.length-1],i=Math.abs(.1*(p-s)),o=Math.abs(.1*(u-l)),m.pointer.zoomX=!0,m.pointer.zoomY=!0,p<s&&(s=(e=[p,s])[0],p=e[1]),u<l&&(l=(a=[u,l])[0],u=a[1]),m.zoom({originalEvent:t,xAxis:[{axis:c,min:s-i,max:p+i}],yAxis:[{axis:f,min:l-o,max:u+o}]}))})},d.prototype.getClusterDistancesFromPoint=function(t,e,a){for(var i,o=this.xAxis,r=this.yAxis,n=[],s=0;s<t.length;s++)i=Math.sqrt(Math.pow(o.toPixels(e)-o.toPixels(t[s].posX),2)+Math.pow(r.toPixels(a)-r.toPixels(t[s].posY),2)),n.push({clusterIndex:s,distance:i});return n.sort(function(t,e){return t.distance-e.distance})},d.prototype.getPointsState=function(t,e,a){var i,o,r,n=e?f(e,a):[],s=f(t,a),l={};for(c=[],t.clusters.forEach(function(t){l[t.stateId]={x:t.x,y:t.y,id:t.stateId,point:t.point,parentsId:[]}}),t.noise.forEach(function(t){l[t.stateId]={x:t.x,y:t.y,id:t.stateId,point:t.point,parentsId:[]}}),r=0;r<s.length;r++)i=s[r],o=n[r],i&&o&&i.parentStateId&&o.parentStateId&&l[i.parentStateId]&&-1===l[i.parentStateId].parentsId.indexOf(o.parentStateId)&&(l[i.parentStateId].parentsId.push(o.parentStateId),-1===c.indexOf(o.parentStateId)&&c.push(o.parentStateId));return l},d.prototype.markerClusterAlgorithms={grid:function(t,e,a,i){for(var o,r,n,s,l=this.xAxis,p=this.yAxis,u={},d=this.getGridOffset(),h=this.getScaledGridSize(i),c=0;c<t.length;c++)o=l.toPixels(t[c])-d.plotLeft,r=p.toPixels(e[c])-d.plotTop,n=Math.floor(o/h),u[s=Math.floor(r/h)+"-"+n]||(u[s]=[]),u[s].push({dataIndex:a[c],x:t[c],y:e[c]});return u},kmeans:function(t,e,a,i){var o,r,n,s,l,p=this,u=[],d=[],h={},c=i.processedDistance||G.layoutAlgorithm.distance,f=i.iterations,m=0,x=!0,g=0,y=0,C=[];for(n in i.processedGridSize=i.processedDistance,r=p.markerClusterAlgorithms?p.markerClusterAlgorithms.grid.call(p,t,e,a,i):{})1<r[n].length&&(o=V(r[n]),u.push({posX:o.x,posY:o.y,oldX:0,oldY:0,startPointsLen:r[n].length,points:[]}));for(;x;){for(u.map(function(t){return t.points.length=0,t}),s=d.length=0;s<t.length;s++)g=t[s],y=e[s],(C=p.getClusterDistancesFromPoint(u,g,y)).length&&C[0].distance<c?u[C[0].clusterIndex].points.push({x:g,y:y,dataIndex:a[s]}):d.push({x:g,y:y,dataIndex:a[s]});for(l=0;l<u.length;l++)1===u[l].points.length&&(C=p.getClusterDistancesFromPoint(u,u[l].points[0].x,u[l].points[0].y))[1].distance<c&&(u[C[1].clusterIndex].points.push(u[l].points[0]),u[C[0].clusterIndex].points.length=0);for(x=!1,l=0;l<u.length;l++)o=V(u[l].points),u[l].oldX=u[l].posX,u[l].oldY=u[l].posY,u[l].posX=o.x,u[l].posY=o.y,(u[l].posX>u[l].oldX+1||u[l].posX<u[l].oldX-1||u[l].posY>u[l].oldY+1||u[l].posY<u[l].oldY-1)&&(x=!0);f&&(x=m<f-1),m++}return u.forEach(function(t,e){h["cluster"+e]=t.points}),d.forEach(function(t,e){h["noise"+e]=[t]}),h},optimizedKmeans:function(t,e,a,i){var o,r,n=this,s=n.xAxis,l=n.yAxis,p=i.processedDistance||G.layoutAlgorithm.gridSize,u={},d=n.getRealExtremes(),h=(n.options.cluster||{}).marker;return!n.markerClusterInfo||n.initMaxX&&n.initMaxX<d.maxX||n.initMinX&&n.initMinX>d.minX||n.initMaxY&&n.initMaxY<d.maxY||n.initMinY&&n.initMinY>d.minY?(n.initMaxX=d.maxX,n.initMinX=d.minX,n.initMaxY=d.maxY,n.initMinY=d.minY,u=n.markerClusterAlgorithms?n.markerClusterAlgorithms.kmeans.call(n,t,e,a,i):{},n.baseClusters=null):(n.baseClusters||(n.baseClusters={clusters:n.markerClusterInfo.clusters,noise:n.markerClusterInfo.noise}),n.baseClusters.clusters.forEach(function(a){a.pointsOutside=[],a.pointsInside=[],a.data.forEach(function(t){o=Math.sqrt(Math.pow(s.toPixels(t.x)-s.toPixels(a.x),2)+Math.pow(l.toPixels(t.y)-l.toPixels(a.y),2)),(r=a.clusterZone&&a.clusterZone.marker&&a.clusterZone.marker.radius?a.clusterZone.marker.radius:h&&h.radius?h.radius:G.marker.radius)+(0<=p-r?p-r:r)<o&&j(a.pointsOutside)?a.pointsOutside.push(t):j(a.pointsInside)&&a.pointsInside.push(t)}),a.pointsInside.length&&(u[a.id]=a.pointsInside),a.pointsOutside.forEach(function(t,e){u[a.id+"_noise"+e]=[t]})}),n.baseClusters.noise.forEach(function(t){u[t.id]=t.data})),u}},d.prototype.preventClusterCollisions=function(t){var a,i,e,o,r,n,s,l,p,u,d,h,c,f,m,x=this,g=x.xAxis,y=x.yAxis,C=t.key.split("-").map(parseFloat),I=C[0],k=C[1],S=t.gridSize,A=t.groupedData,b=t.defaultRadius,M=t.clusterRadius,D=k*S,P=I*S,X=g.toPixels(t.x),Y=y.toPixels(t.y),v=[],L=0,z=0,E=(x.options.cluster||{}).marker,O=(x.options.cluster||{}).zones,T=x.getGridOffset();for(X-=T.plotLeft,Y-=T.plotTop,s=1;s<5;s++)for(e=s%2?-1:1,o=s<3?-1:1,r=Math.floor((X+e*M)/S),c=[(n=Math.floor((Y+o*M)/S))+"-"+r,n+"-"+k,I+"-"+r],l=0;l<c.length;l++)-1===v.indexOf(c[l])&&c[l]!==t.key&&v.push(c[l]);return v.forEach(function(t){var e;if(A[t]){if(A[t].posX||(d=V(A[t]),A[t].posX=d.x,A[t].posY=d.y),a=g.toPixels(A[t].posX||0)-T.plotLeft,i=y.toPixels(A[t].posY||0)-T.plotTop,e=t.split("-").map(parseFloat),u=e[0],p=e[1],O)for(L=A[t].length,s=0;s<O.length;s++)L>=O[s].from&&L<=O[s].to&&(z=j((O[s].marker||{}).radius)?O[s].marker.radius||0:E&&E.radius?E.radius:G.marker.radius);1<A[t].length&&0===z&&E&&E.radius?z=E.radius:1===A[t].length&&(z=b),h=M+z,z=0,p!==k&&Math.abs(X-a)<h&&(X=p-k<0?D+M:D+S-M),u!==I&&Math.abs(Y-i)<h&&(Y=u-I<0?P+M:P+S-M)}}),f=g.toValue(X+T.plotLeft),m=y.toValue(Y+T.plotTop),{x:A[t.key].posX=f,y:A[t.key].posY=m}},d.prototype.isValidGroupedDataObject=function(t){var e,a=!1;return!!X(t)&&(L(t,function(t){if(a=!0,M(t)&&t.length){for(e=0;e<t.length;e++)if(!X(t[e])||!t[e].x||!t[e].y)return void(a=!1)}else a=!1}),a)},d.prototype.getClusteredData=function(t,e){var a,i,o,r,n,s,l,p,u,d,h,c,f,m,x=this,g=[],y=[],C=[],I=[],k=[],S=0,A=Math.max(2,e.minimumClusterSize||2);if(P(e.layoutAlgorithm.type)&&!x.isValidGroupedDataObject(t))return b("Highcharts marker-clusters module: The custom algorithm result is not valid!",!1,x.chart),!1;for(m in t)if(t[m].length>=A){if(o=t[m],a=T(),n=o.length,e.zones)for(f=0;f<e.zones.length;f++)n>=e.zones[f].from&&n<=e.zones[f].to&&((h=e.zones[f]).zoneIndex=f,d=e.zones[f].marker,c=e.zones[f].className);for(u=V(o),l="grid"!==e.layoutAlgorithm.type||e.allowOverlap?{x:u.x,y:u.y}:(s=x.options.marker||{},x.preventClusterCollisions({x:u.x,y:u.y,key:m,groupedData:t,gridSize:x.getScaledGridSize(e.layoutAlgorithm),defaultRadius:s.radius||3+(s.lineWidth||0),clusterRadius:d&&d.radius?d.radius:(e.marker||{}).radius||G.marker.radius})),f=0;f<n;f++)o[f].parentStateId=a;if(C.push({x:l.x,y:l.y,id:m,stateId:a,index:S,data:o,clusterZone:h,clusterZoneClassName:c}),g.push(l.x),y.push(l.y),k.push({options:{formatPrefix:"cluster",dataLabels:e.dataLabels,marker:v(e.marker,{states:e.states},d||{})}}),x.options.data&&x.options.data.length)for(f=0;f<n;f++)X(x.options.data[o[f].dataIndex])&&(o[f].options=x.options.data[o[f].dataIndex]);S++,d=null}else for(f=0;f<t[m].length;f++)i=t[m][f],a=T(),p=null,r=((x.options||{}).data||[])[i.dataIndex],g.push(i.x),y.push(i.y),i.parentStateId=a,I.push({x:i.x,y:i.y,id:m,stateId:a,index:S,data:t[m]}),p=r&&"object"==typeof r&&!M(r)?v(r,{x:i.x,y:i.y}):{userOptions:r,x:i.x,y:i.y},k.push({options:p}),S++;return{clusters:C,noise:I,groupedXData:g,groupedYData:y,groupMap:k}},d.prototype.destroyClusteredData=function(){(this.markerClusterSeriesData||[]).forEach(function(t){t&&t.destroy&&t.destroy()}),this.markerClusterSeriesData=null},d.prototype.hideClusteredData=function(){var t=this.markerClusterSeriesData,e=((this.markerClusterInfo||{}).pointsState||{}).oldState||{},a=c.map(function(t){return(e[t].point||{}).id||""});(t||[]).forEach(function(t){t&&-1!==a.indexOf(t.id)?(t.graphic&&t.graphic.hide(),t.dataLabel&&t.dataLabel.hide()):t&&t.destroy&&t.destroy()})},d.prototype.generatePoints=function(){var t,e,a,i,o,r,n,s,l,p,u,d,h,c,f,m,x,g=this,y=g.chart,C=g.xAxis,I=g.yAxis,k=g.options.cluster,S=g.getRealExtremes(),A=[],b=[],M=[];if(k&&k.enabled&&g.xData&&g.yData&&!y.polar){for(u=k.layoutAlgorithm.type,(c=k.layoutAlgorithm).processedGridSize=z(c.gridSize||G.layoutAlgorithm.gridSize,y.plotWidth),c.processedDistance=z(c.distance||G.layoutAlgorithm.distance,y.plotWidth),i=c.kmeansThreshold||G.layoutAlgorithm.kmeansThreshold,o=Math.abs(C.toValue(c.processedGridSize/2)-C.toValue(0)),r=Math.abs(I.toValue(c.processedGridSize/2)-I.toValue(0)),m=0;m<g.xData.length;m++)g.dataMaxX||(j(s)&&j(n)&&j(p)&&j(l)?Y(g.yData[m])&&Y(p)&&Y(l)&&(s=Math.max(g.xData[m],s),n=Math.min(g.xData[m],n),p=Math.max(g.yData[m]||p,p),l=Math.min(g.yData[m]||l,l)):(s=n=g.xData[m],p=l=g.yData[m])),g.xData[m]>=S.minX-o&&g.xData[m]<=S.maxX+o&&(g.yData[m]||S.minY)>=S.minY-r&&(g.yData[m]||S.maxY)<=S.maxY+r&&(A.push(g.xData[m]),b.push(g.yData[m]),M.push(m));j(s)&&j(n)&&Y(p)&&Y(l)&&(g.dataMaxX=s,g.dataMinX=n,g.dataMaxY=p,g.dataMinY=l),d=(h=(P(u)?u:g.markerClusterAlgorithms?u&&g.markerClusterAlgorithms[u]?g.markerClusterAlgorithms[u]:A.length<i?g.markerClusterAlgorithms.kmeans:g.markerClusterAlgorithms.grid:function(){return!1}).call(this,A,b,M,c))?g.getClusteredData(h,k):h,t=k.animation&&g.markerClusterInfo&&g.markerClusterInfo.pointsState&&g.markerClusterInfo.pointsState.oldState?((x=g.markerClusterInfo.pointsState.oldState)&&L(x,function(t){t.point&&t.point.destroy&&t.point.destroy()}),g.markerClusterInfo.pointsState.newState):{},e=g.xData.length,a=g.markerClusterInfo,d&&(g.processedXData=d.groupedXData,g.processedYData=d.groupedYData,g.hasGroupedData=!0,g.markerClusterInfo=d,g.groupMap=d.groupMap),E.apply(this),d&&g.markerClusterInfo&&((g.markerClusterInfo.clusters||[]).forEach(function(t){(f=g.points[t.index]).isCluster=!0,f.clusteredData=t.data,f.clusterPointsAmount=t.data.length,t.point=f,D(f,"click",g.onDrillToCluster)}),(g.markerClusterInfo.noise||[]).forEach(function(t){t.point=g.points[t.index]}),k.animation&&g.markerClusterInfo&&(g.markerClusterInfo.pointsState={oldState:t,newState:g.getPointsState(d,a,e)}),k.animation?this.hideClusteredData():this.destroyClusteredData(),this.markerClusterSeriesData=this.hasGroupedData?this.points:null)}else E.apply(this)},D(a,"render",function(){(this.series||[]).forEach(function(e){var t,a;e.markerClusterInfo&&(t=e.options.cluster,a=((e.markerClusterInfo||{}).pointsState||{}).oldState,(t||{}).animation&&e.markerClusterInfo&&0===e.chart.pointer.pinchDown.length&&"pan"!==(e.xAxis.eventArgs||{}).trigger&&a&&Object.keys(a).length&&(e.markerClusterInfo.clusters.forEach(function(t){e.animateClusterPoint(t)}),e.markerClusterInfo.noise.forEach(function(t){e.animateClusterPoint(t)})))})}),D(r,"update",function(){if(this.dataGroup)return b("Highcharts marker-clusters module: Running `Point.update` when point belongs to clustered series is not supported.",!1,this.series.chart),!1}),D(u,"destroy",d.prototype.destroyClusteredData),D(u,"afterRender",function(){var e=(this.options.cluster||{}).drillToCluster;this.markerClusterInfo&&this.markerClusterInfo.clusters&&this.markerClusterInfo.clusters.forEach(function(t){t.point&&t.point.graphic&&(t.point.graphic.addClass("highcharts-cluster-point"),e&&t.point&&(t.point.graphic.css({cursor:"pointer"}),t.point.dataLabel&&t.point.dataLabel.css({cursor:"pointer"})),j(t.clusterZone)&&t.point.graphic.addClass(t.clusterZoneClassName||"highcharts-cluster-zone-"+t.clusterZone.zoneIndex))})}),D(r,"drillToCluster",function(t){var e=(((t.point||t.target).series.options.cluster||{}).events||{}).drillToCluster;P(e)&&e.call(this,t)}),D(l,"setExtremes",function(){var e,t=this.chart,a=0;t.series.forEach(function(t){t.markerClusterInfo&&(e=I((t.options.cluster||{}).animation),a=e.duration||0)}),k(function(){t.tooltip&&t.tooltip.destroy()},a)})}),a(e,"masters/modules/marker-clusters.src.js",[],function(){})});