import BaseSeries from"../Core/Series/Series.js";var seriesTypes=BaseSeries.seriesTypes;import Chart from"../Core/Chart/Chart.js";import H from"../Core/Globals.js";var noop=H.noop;import U from"../Core/Utilities.js";var addEvent=U.addEvent,fireEvent=U.fireEvent,isArray=U.isArray,pick=U.pick;import"../Core/Options.js";import"../Series/LineSeries.js";BaseSeries.seriesType("funnel","pie",{animation:!1,center:["50%","50%"],width:"90%",neckWidth:"30%",height:"100%",neckHeight:"25%",reversed:!1,size:!0,dataLabels:{connectorWidth:1,verticalAlign:"middle"},states:{select:{color:"#cccccc",borderColor:"#000000"}}},{animate:noop,translate:function(){var t,e,i,a,s,o,n,r,l,h,d=0,c=this,p=c.chart,g=c.options,b=g.reversed,f=g.ignoreHiddenPoint,m=p.plotWidth,u=p.plotHeight,v=0,L=g.center,y=H(L[0],m),A=H(L[1],u),W=H(g.width,m),x=H(g.height,u),D=H(g.neckWidth,m),C=H(g.neckHeight,u),k=A-x/2+x-C,S=c.data,E="left"===g.dataLabels.position?1:0;function H(t,e){return/%$/.test(t)?e*parseInt(t,10)/100:parseInt(t,10)}c.getWidthAt=function(t){return t>k||x===C?D:D+(W-D)*(1-(t-(A-x/2))/(x-C))},c.getX=function(t,e,i){return y+(e?-1:1)*(c.getWidthAt(b?2*A-t:t)/2+i.labelDistance)},c.center=[y,A,x],c.centerX=y,S.forEach(function(t){f&&!1===t.visible||(d+=t.y)}),S.forEach(function(p){h=null,i=d?p.y/d:0,r=(s=A-x/2+v*x)+i*x,t=c.getWidthAt(s),o=(a=y-t/2)+t,t=c.getWidthAt(r),l=(n=y-t/2)+t,s>k?(a=n=y-D/2,o=l=y+D/2):r>k&&(h=r,t=c.getWidthAt(k),l=(n=y-t/2)+t,r=k),b&&(s=2*A-s,r=2*A-r,null!==h&&(h=2*A-h)),e=[["M",a,s],["L",o,s],["L",l,r]],null!==h&&e.push(["L",l,h],["L",n,h]),e.push(["L",n,r],["Z"]),p.shapeType="path",p.shapeArgs={d:e},p.percentage=100*i,p.plotX=y,p.plotY=(s+(h||r))/2,p.tooltipPos=[y,p.plotY],p.dlBox={x:n,y:s,topWidth:o-a,bottomWidth:l-n,height:Math.abs(pick(h,r)-s),width:NaN},p.slice=noop,p.half=E,f&&!1===p.visible||(v+=i)}),fireEvent(c,"afterTranslate")},sortByAngle:function(t){t.sort(function(t,e){return t.plotY-e.plotY})},drawDataLabels:function(){var t,e,i,a,s,o=this.data,n=this.options.dataLabels.distance,r=o.length;for(this.center[2]-=2*n;r--;)e=(t=(i=o[r]).half)?1:-1,s=i.plotY,i.labelDistance=pick(i.options.dataLabels&&i.options.dataLabels.distance,n),this.maxLabelDistance=Math.max(i.labelDistance,this.maxLabelDistance||0),a=this.getX(s,t,i),i.labelPosition={natural:{x:0,y:s},final:{},alignment:t?"right":"left",connectorPosition:{breakAt:{x:a+(i.labelDistance-5)*e,y:s},touchingSliceAt:{x:a+i.labelDistance*e,y:s}}};seriesTypes[this.options.dataLabels.inside?"column":"pie"].prototype.drawDataLabels.call(this)},alignDataLabel:function(t,e,i,a,s){var o=t.series,n=o.options.reversed,r=t.dlBox||t.shapeArgs,l=i.align,h=i.verticalAlign,d=((o.options||{}).dataLabels||{}).inside,c=o.center[1],p=n?2*c-t.plotY:t.plotY,g=o.getWidthAt(p-r.height/2+e.height),b="middle"===h?(r.topWidth-r.bottomWidth)/4:(g-r.bottomWidth)/2,f=r.y,m=r.x;"middle"===h?f=r.y-r.height/2+e.height/2:"top"===h&&(f=r.y-r.height+e.height+i.padding),("top"===h&&!n||"bottom"===h&&n||"middle"===h)&&("right"===l?m=r.x-i.padding+b:"left"===l&&(m=r.x+i.padding-b)),a={x:m,y:n?f-r.height:f,width:r.bottomWidth,height:r.height},i.verticalAlign="bottom",d&&!t.visible||Highcharts.Series.prototype.alignDataLabel.call(this,t,e,i,a,s),d&&(!t.visible&&t.dataLabel&&(t.dataLabel.placed=!1),t.contrastColor&&e.css({color:t.contrastColor}))}}),addEvent(Chart,"afterHideAllOverlappingLabels",function(){this.series.forEach(function(t){var e=t.options&&t.options.dataLabels;isArray(e)&&(e=e[0]),t.is("pie")&&t.placeDataLabels&&e&&!e.inside&&t.placeDataLabels()})}),BaseSeries.seriesType("pyramid","funnel",{neckWidth:"0%",neckHeight:"0%",reversed:!0});