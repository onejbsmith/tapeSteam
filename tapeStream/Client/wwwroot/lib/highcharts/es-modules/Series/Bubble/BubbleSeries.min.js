import Axis from"../../Core/Axis/Axis.js";import BaseSeries from"../../Core/Series/Series.js";import Color from"../../Core/Color/Color.js";var color=Color.parse;import H from"../../Core/Globals.js";var noop=H.noop;import Point from"../../Core/Series/Point.js";import U from"../../Core/Utilities.js";var arrayMax=U.arrayMax,arrayMin=U.arrayMin,clamp=U.clamp,extend=U.extend,isNumber=U.isNumber,pick=U.pick,pInt=U.pInt;import"../../Series/LineSeries.js";import"../../Series/ScatterSeries.js";import"./BubbleLegend.js";var Series=H.Series,seriesTypes=BaseSeries.seriesTypes;BaseSeries.seriesType("bubble","scatter",{dataLabels:{formatter:function(){return this.point.z},inside:!0,verticalAlign:"middle"},animationLimit:250,marker:{lineColor:null,lineWidth:1,fillOpacity:.5,radius:null,states:{hover:{radiusPlus:0}},symbol:"circle"},minSize:8,maxSize:"20%",softThreshold:!1,states:{hover:{halo:{size:5}}},tooltip:{pointFormat:"({point.x}, {point.y}), Size: {point.z}"},turboThreshold:0,zThreshold:0,zoneAxis:"z"},{pointArrayMap:["y","z"],parallelArrays:["x","y","z"],trackerGroups:["group","dataLabelsGroup"],specialGroup:"group",bubblePadding:!0,zoneAxis:"z",directTouch:!0,isBubble:!0,pointAttribs:function(i,t){var e=this.options.marker.fillOpacity,r=Series.prototype.pointAttribs.call(this,i,t);return 1!==e&&(r.fill=color(r.fill).setOpacity(e).get("rgba")),r},getRadii:function(i,t,e){var r,a,s,o=this.zData,n=this.yData,l=e.minPxSize,h=e.maxPxSize,p=[];for(a=0,r=o.length;a<r;a++)s=o[a],p.push(this.getRadius(i,t,l,h,s,n[a]));this.radii=p},getRadius:function(i,t,e,r,a,s){var o=this.options,n="width"!==o.sizeBy,l=o.zThreshold,h=t-i,p=.5;if(null===s||null===a)return null;if(isNumber(a)){if(o.sizeByAbsoluteValue&&(a=Math.abs(a-l),t=h=Math.max(t-l,Math.abs(i-l)),i=0),a<i)return e/2-1;h>0&&(p=(a-i)/h)}return n&&p>=0&&(p=Math.sqrt(p)),Math.ceil(e+p*(r-e))/2},animate:function(i){!i&&this.points.length<this.options.animationLimit&&this.points.forEach(function(i){var t=i.graphic;t&&t.width&&(this.hasRendered||t.attr({x:i.plotX,y:i.plotY,width:1,height:1}),t.animate(this.markerAttribs(i),this.options.animation))},this)},hasData:function(){return!!this.processedXData.length},translate:function(){var i,t,e,r=this.data,a=this.radii;for(seriesTypes.scatter.prototype.translate.call(this),i=r.length;i--;)t=r[i],e=a?a[i]:0,isNumber(e)&&e>=this.minPxSize/2?(t.marker=extend(t.marker,{radius:e,width:2*e,height:2*e}),t.dlBox={x:t.plotX-e,y:t.plotY-e,width:2*e,height:2*e}):t.shapeArgs=t.plotY=t.dlBox=void 0},alignDataLabel:seriesTypes.column.prototype.alignDataLabel,buildKDTree:noop,applyZones:noop},{haloPath:function(i){return Point.prototype.haloPath.call(this,0===i?0:(this.marker&&this.marker.radius||0)+i)},ttBelow:!1}),Axis.prototype.beforePadding=function(){var i=this,t=this.len,e=this.chart,r=0,a=t,s=this.isXAxis,o=s?"xData":"yData",n=this.min,l={},h=Math.min(e.plotWidth,e.plotHeight),p=Number.MAX_VALUE,m=-Number.MAX_VALUE,u=this.max-n,d=t/u,c=[];this.series.forEach(function(t){var r,a=t.options;!t.bubblePadding||!t.visible&&e.options.chart.ignoreHiddenSeries||(i.allowZoomOutside=!0,c.push(t),s&&(["minSize","maxSize"].forEach(function(i){var t=a[i],e=/%$/.test(t);t=pInt(t),l[i]=e?h*t/100:t}),t.minPxSize=l.minSize,t.maxPxSize=Math.max(l.maxSize,l.minSize),(r=t.zData.filter(isNumber)).length&&(p=pick(a.zMin,clamp(arrayMin(r),!1===a.displayNegative?a.zThreshold:-Number.MAX_VALUE,p)),m=pick(a.zMax,Math.max(m,arrayMax(r))))))}),c.forEach(function(t){var e,l=t[o],h=l.length;if(s&&t.getRadii(p,m,t),u>0)for(;h--;)isNumber(l[h])&&i.dataMin<=l[h]&&l[h]<=i.max&&(e=t.radii?t.radii[h]:0,r=Math.min((l[h]-n)*d-e,r),a=Math.max((l[h]-n)*d+e,a))}),c.length&&u>0&&!this.logarithmic&&(a-=t,d*=(t+Math.max(0,r)-Math.min(a,t))/t,[["min","userMin",r],["max","userMax",a]].forEach(function(t){void 0===pick(i.options[t[0]],i[t[1]])&&(i[t[0]]+=t[2]/d)}))};