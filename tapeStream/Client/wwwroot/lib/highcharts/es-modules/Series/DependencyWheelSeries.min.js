import A from"../Core/Animation/AnimationUtilities.js";var animObject=A.animObject;import BaseSeries from"../Core/Series/Series.js";import H from"../Core/Globals.js";import NodesMixin from"../Mixins/Nodes.js";import"./SankeySeries.js";import"../Core/Options.js";var base=BaseSeries.seriesTypes.sankey.prototype;BaseSeries.seriesType("dependencywheel","sankey",{center:[null,null],curveFactor:.6,startAngle:0},{orderNodes:!1,getCenter:BaseSeries.seriesTypes.pie.prototype.getCenter,createNodeColumns:function(){var e=[this.createNodeColumn()];return this.nodes.forEach(function(t){t.column=0,e[0].push(t)}),e},getNodePadding:function(){return this.options.nodePadding/Math.PI},createNode:function(e){var t=base.createNode.call(this,e);return t.index=this.nodes.length-1,t.getSum=function(){return t.linksFrom.concat(t.linksTo).reduce(function(e,t){return e+t.weight},0)},t.offset=function(e){var i,n,a=0,r=t.linksFrom.concat(t.linksTo);function s(e){return e.fromNode===t?e.toNode:e.fromNode}for(r.sort(function(e,t){return s(e).index-s(t).index}),i=0;i<r.length;i++)if(s(r[i]).index>t.index){r=r.slice(0,i).reverse().concat(r.slice(i).reverse()),n=!0;break}for(n||r.reverse(),i=0;i<r.length;i++){if(r[i]===e)return a;a+=r[i].weight}},t},translate:function(){var e=this.options,t=2*Math.PI/(this.chart.plotHeight+this.getNodePadding()),i=this.getCenter(),n=(e.startAngle-90)*H.deg2rad;base.translate.call(this),this.nodeColumns[0].forEach(function(a){if(a.sum){var r=a.shapeArgs,s=i[0],o=i[1],c=i[2]/2,h=c-e.nodeWidth,d=n+t*r.y,p=n+t*(r.y+r.height);a.angle=d+(p-d)/2,a.shapeType="arc",a.shapeArgs={x:s,y:o,r:c,innerR:h,start:d,end:p},a.dlBox={x:s+Math.cos((d+p)/2)*(c+h)/2,y:o+Math.sin((d+p)/2)*(c+h)/2,width:1,height:1},a.linksFrom.forEach(function(i){if(i.linkBase){var a,r=i.linkBase.map(function(r,c){var d=t*r,p=Math.cos(n+d)*(h+1),l=Math.sin(n+d)*(h+1),u=e.curveFactor;return(a=Math.abs(i.linkBase[3-c]*t-d))>Math.PI&&(a=2*Math.PI-a),(a*=h)<h&&(u*=a/h),{x:s+p,y:o+l,cpX:s+(1-u)*p,cpY:o+(1-u)*l}});i.shapeArgs={d:[["M",r[0].x,r[0].y],["A",h,h,0,0,1,r[1].x,r[1].y],["C",r[1].cpX,r[1].cpY,r[2].cpX,r[2].cpY,r[2].x,r[2].y],["A",h,h,0,0,1,r[3].x,r[3].y],["C",r[3].cpX,r[3].cpY,r[0].cpX,r[0].cpY,r[0].x,r[0].y]]}}})}})},animate:function(e){if(!e){var t=animObject(this.options.animation).duration/2/this.nodes.length;this.nodes.forEach(function(e,i){var n=e.graphic;n&&(n.attr({opacity:0}),setTimeout(function(){n.animate({opacity:1},{duration:t})},t*i))},this),this.points.forEach(function(e){var t=e.graphic;!e.isNode&&t&&t.attr({opacity:0}).animate({opacity:1},this.options.animation)},this)}}},{setState:NodesMixin.setNodeState,getDataLabelPath:function(e){var t=this.series.chart.renderer,i=this.shapeArgs,n=this.angle<0||this.angle>Math.PI,a=i.start,r=i.end;return this.dataLabelPath||(this.dataLabelPath=t.arc({open:!0}).add(e)),this.dataLabelPath.attr({x:i.x,y:i.y,r:i.r+(this.dataLabel.options.distance||0),start:n?a:r,end:n?r:a,clockwise:+n}),this.dataLabelPath},isValid:function(){return!0}});