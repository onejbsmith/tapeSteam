import BaseSeries from"../Core/Series/Series.js";import H from"../Core/Globals.js";import O from"../Core/Options.js";var defaultOptions=O.defaultOptions;import U from"../Core/Utilities.js";var defined=U.defined,extend=U.extend,fireEvent=U.fireEvent,isNumber=U.isNumber,merge=U.merge,objectEach=U.objectEach,pick=U.pick;import"./PieSeries.js";var piePoint=BaseSeries.seriesTypes.pie.prototype.pointClass.prototype;BaseSeries.seriesType("item","pie",{endAngle:void 0,innerSize:"40%",itemPadding:.1,layout:"vertical",marker:merge(defaultOptions.plotOptions.line.marker,{radius:null}),rows:void 0,crisp:!1,showInLegend:!0,startAngle:void 0},{markerAttribs:void 0,translate:function(t){0===this.total&&(this.center=this.getCenter()),this.slots||(this.slots=[]),isNumber(this.options.startAngle)&&isNumber(this.options.endAngle)?(H.seriesTypes.pie.prototype.translate.apply(this,arguments),this.slots=this.getSlots()):(this.generatePoints(),fireEvent(this,"afterTranslate"))},getSlots:function(){for(var t,e,i,s,o,r,n,a,h,l,c,p,d,u=this.center,f=u[2],g=u[3],m=this.slots,v=0,y=this.endAngleRad-this.startAngleRad,b=Number.MAX_VALUE,M=this.options.rows,w=(f-g)/f,A=y%(2*Math.PI)==0;b>this.total+(p&&A?p.length:0);)for(c=b,m.length=0,b=0,p=d,d=[],l=f/++v/2,M?(g=(l-M)/l*f)>=0?l=M:(g=0,w=1):l=Math.floor(l*w),t=l;t>0;t--)o=y*(s=(g+t/l*(f-g-v))/2),r=Math.ceil(o/v),d.push({rowRadius:s,rowLength:o,colCount:r}),b+=r+1;if(p){for(var S=c-this.total-(A?p.length:0);S>0;)p.map(function(t){return{angle:t.colCount/t.rowLength,row:t}}).sort(function(t,e){return e.angle-t.angle}).slice(0,Math.min(S,Math.ceil(p.length/2))).forEach(P);return p.forEach(function(t){var s=t.rowRadius,o=t.colCount;for(n=o?y/o:0,h=0;h<=o;h+=1)a=this.startAngleRad+h*n,e=u[0]+Math.cos(a)*s,i=u[1]+Math.sin(a)*s,m.push({x:e,y:i,angle:a})},this),m.sort(function(t,e){return t.angle-e.angle}),this.itemSize=v,m}function P(t){S>0&&(t.row.colCount--,S--)}},getRows:function(){var t,e=this.options.rows;if(!e)if(t=this.chart.plotWidth/this.chart.plotHeight,e=Math.sqrt(this.total),t>1)for(e=Math.ceil(e);e>0&&!(this.total/e/e>t);)e--;else for(e=Math.floor(e);e<this.total&&!(this.total/e/e<t);)e++;return e},drawPoints:function(){var t=this,e=this.options,i=t.chart.renderer,s=e.marker,o=this.borderWidth%2?.5:1,r=0,n=this.getRows(),a=Math.ceil(this.total/n),h=this.chart.plotWidth/a,l=this.chart.plotHeight/n,c=this.itemSize||Math.min(h,l);this.points.forEach(function(p){var d,u,f,g,m,v,y,b=p.marker||{},M=b.symbol||s.symbol,w=pick(b.radius,s.radius),A=defined(w)?2*w:c,S=A*e.itemPadding;if(p.graphics=u=p.graphics||{},t.chart.styledMode||(f=t.pointAttribs(p,p.selected&&"select")),!p.isNull&&p.visible){p.graphic||(p.graphic=i.g("point").add(t.group));for(var P=0;P<p.y;P++){if(t.center&&t.slots){var C=t.slots.shift();g=C.x-c/2,m=C.y-c/2}else"horizontal"===e.layout?(g=h*(r%a),m=l*Math.floor(r/a)):(g=h*Math.floor(r/n),m=l*(r%n));g+=S,m+=S,y=v=Math.round(A-2*S),t.options.crisp&&(g=Math.round(g)-o,m=Math.round(m)+o),d={x:g,y:m,width:v,height:y},void 0!==w&&(d.r=w),u[P]?u[P].animate(d):u[P]=i.symbol(M,null,null,null,null,{backgroundSize:"within"}).attr(extend(d,f)).add(p.graphic),u[P].isActive=!0,r++}}objectEach(u,function(t,e){t.isActive?t.isActive=!1:(t.destroy(),delete u[e])})})},drawDataLabels:function(){this.center&&this.slots?H.seriesTypes.pie.prototype.drawDataLabels.call(this):this.points.forEach(function(t){t.destroyElements({dataLabel:1})})},animate:function(t){t?this.group.attr({opacity:0}):this.group.animate({opacity:1},this.options.animation)}},{connectorShapes:piePoint.connectorShapes,getConnectorPath:piePoint.getConnectorPath,setVisible:piePoint.setVisible,getTranslate:piePoint.getTranslate});