"use strict";import ControllableMixin from"../Mixins/ControllableMixin.js";import MockPoint from"../MockPoint.js";import SVGRenderer from"../../../Core/Renderer/SVG/SVGRenderer.js";import Tooltip from"../../../Core/Tooltip.js";import U from"../../../Core/Utilities.js";var extend=U.extend,format=U.format,isNumber=U.isNumber,pick=U.pick;import"../../../Core/Renderer/SVG/SVGRenderer.js";var ControllableLabel=function(){function t(t,i,o){this.addControlPoints=ControllableMixin.addControlPoints,this.attr=ControllableMixin.attr,this.attrsFromOptions=ControllableMixin.attrsFromOptions,this.destroy=ControllableMixin.destroy,this.getPointsOptions=ControllableMixin.getPointsOptions,this.init=ControllableMixin.init,this.linkPoints=ControllableMixin.linkPoints,this.point=ControllableMixin.point,this.rotate=ControllableMixin.rotate,this.scale=ControllableMixin.scale,this.setControlPointsVisibility=ControllableMixin.setControlPointsVisibility,this.shouldBeDrawn=ControllableMixin.shouldBeDrawn,this.transform=ControllableMixin.transform,this.transformPoint=ControllableMixin.transformPoint,this.translateShape=ControllableMixin.translateShape,this.update=ControllableMixin.update,this.init(t,i,o),this.collection="labels"}return t.alignedPosition=function(t,i){var o,n,e=t.align,r=t.verticalAlign,s=(i.x||0)+(t.x||0),l=(i.y||0)+(t.y||0);return"right"===e?o=1:"center"===e&&(o=2),o&&(s+=(i.width-(t.width||0))/o),"bottom"===r?n=1:"middle"===r&&(n=2),n&&(l+=(i.height-(t.height||0))/n),{x:Math.round(s),y:Math.round(l)}},t.justifiedOptions=function(t,i,o,n){var e,r=o.align,s=o.verticalAlign,l=i.box?0:i.padding||0,a=i.getBBox(),h={align:r,verticalAlign:s,x:o.x,y:o.y,width:i.width,height:i.height},p=n.x-t.plotLeft,d=n.y-t.plotTop;return(e=p+l)<0&&("right"===r?h.align="left":h.x=-e),(e=p+a.width-l)>t.plotWidth&&("left"===r?h.align="right":h.x=t.plotWidth-e),(e=d+l)<0&&("bottom"===s?h.verticalAlign="top":h.y=-e),(e=d+a.height-l)>t.plotHeight&&("top"===s?h.verticalAlign="bottom":h.y=t.plotHeight-e),h},t.prototype.translatePoint=function(t,i){ControllableMixin.translatePoint.call(this,t,i,0)},t.prototype.translate=function(t,i){var o,n=this.annotation.chart,e=this.annotation.userOptions,r=n.annotations.indexOf(this.annotation),s=n.options.annotations[r];n.inverted&&(o=t,t=i,i=o),this.options.x+=t,this.options.y+=i,s[this.collection][this.index].x=this.options.x,s[this.collection][this.index].y=this.options.y,e[this.collection][this.index].x=this.options.x,e[this.collection][this.index].y=this.options.y},t.prototype.render=function(i){var o=this.options,n=this.attrsFromOptions(o),e=o.style;this.graphic=this.annotation.chart.renderer.label("",0,-9999,o.shape,null,null,o.useHTML,null,"annotation-label").attr(n).add(i),this.annotation.chart.styledMode||("contrast"===e.color&&(e.color=this.annotation.chart.renderer.getContrast(t.shapesWithoutBackground.indexOf(o.shape)>-1?"#FFFFFF":o.backgroundColor)),this.graphic.css(o.style).shadow(o.shadow)),o.className&&this.graphic.addClass(o.className),this.graphic.labelrank=o.labelrank,ControllableMixin.render.call(this)},t.prototype.redraw=function(t){var i,o,n=this.options,e=this.text||n.format||n.text,r=this.graphic,s=this.points[0];r.attr({text:e?format(e,s.getLabelConfig(),this.annotation.chart):n.formatter.call(s,this)}),i=this.anchor(s),(o=this.position(i))?(r.alignAttr=o,o.anchorX=i.absolutePosition.x,o.anchorY=i.absolutePosition.y,r[t?"animate":"attr"](o)):r.attr({x:0,y:-9999}),r.placed=!!o,ControllableMixin.redraw.call(this,t)},t.prototype.anchor=function(t){var i=ControllableMixin.anchor.apply(this,arguments),o=this.options.x||0,n=this.options.y||0;return i.absolutePosition.x-=o,i.absolutePosition.y-=n,i.relativePosition.x-=o,i.relativePosition.y-=n,i},t.prototype.position=function(i){var o,n,e,r,s=this.graphic,l=this.annotation.chart,a=this.points[0],h=this.options,p=i.absolutePosition,d=i.relativePosition,c=a.series.visible&&MockPoint.prototype.isInsidePlot.call(a);return c&&(h.distance?o=Tooltip.prototype.getPosition.call({chart:l,distance:pick(h.distance,16)},s.width,s.height,{plotX:d.x,plotY:d.y,negative:a.negative,ttBelow:a.ttBelow,h:d.height||d.width}):h.positioner?o=h.positioner.call(this):(n={x:p.x,y:p.y,width:0,height:0},o=t.alignedPosition(extend(h,{width:s.width,height:s.height}),n),"justify"===this.options.overflow&&(o=t.alignedPosition(t.justifiedOptions(l,s,h,o),n))),h.crop&&(e=o.x-l.plotLeft,r=o.y-l.plotTop,c=l.isInsidePlot(e,r)&&l.isInsidePlot(e+s.width,r+s.height))),c?o:null},t.attrsMap={backgroundColor:"fill",borderColor:"stroke",borderWidth:"stroke-width",zIndex:"zIndex",borderRadius:"r",padding:"padding"},t.shapesWithoutBackground=["connector"],t}();export default ControllableLabel;SVGRenderer.prototype.symbols.connector=function(t,i,o,n,e){var r,s,l=e&&e.anchorX,a=e&&e.anchorY,h=o/2;return isNumber(l)&&isNumber(a)&&(r=[["M",l,a]],(s=i-a)<0&&(s=-n-s),s<o&&(h=l<t+o/2?s:o-s),a>i+n?r.push(["L",t+h,i+n]):a<i?r.push(["L",t+h,i]):l<t?r.push(["L",t,i+n/2]):l>t+o&&r.push(["L",t+o,i+n/2])),r||[]};