import H from"../../../Core/Globals.js";import U from"../../../Core/Utilities.js";var addEvent=U.addEvent,fireEvent=U.fireEvent,objectEach=U.objectEach,pick=U.pick,removeEvent=U.removeEvent,eventEmitterMixin={addEvents:function(){var t=this,e=function(e){addEvent(e,H.isTouchDevice?"touchstart":"mousedown",function(e){t.onMouseDown(e)})};if(e(this.graphic.element),(t.labels||[]).forEach(function(t){t.options.useHTML&&t.graphic.text&&e(t.graphic.text.element)}),objectEach(t.options.events,function(e,r){var a=function(a){"click"===r&&t.cancelClick||e.call(t,t.chart.pointer.normalize(a),t.target)};-1===(t.nonDOMEvents||[]).indexOf(r)?t.graphic.on(r,a):addEvent(t,r,a)}),t.options.draggable&&(addEvent(t,"drag",t.onDrag),!t.graphic.renderer.styledMode)){var r={cursor:{x:"ew-resize",y:"ns-resize",xy:"move"}[t.options.draggable]};t.graphic.css(r),(t.labels||[]).forEach(function(t){t.options.useHTML&&t.graphic.text&&t.graphic.text.css(r)})}t.isUpdating||fireEvent(t,"add")},removeDocEvents:function(){this.removeDrag&&(this.removeDrag=this.removeDrag()),this.removeMouseUp&&(this.removeMouseUp=this.removeMouseUp())},onMouseDown:function(t){var e,r,a=this,o=a.chart.pointer;t.preventDefault&&t.preventDefault(),2!==t.button&&(t=o.normalize(t),e=t.chartX,r=t.chartY,a.cancelClick=!1,a.chart.hasDraggedAnnotation=!0,a.removeDrag=addEvent(H.doc,H.isTouchDevice?"touchmove":"mousemove",function(t){a.hasDragged=!0,(t=o.normalize(t)).prevChartX=e,t.prevChartY=r,fireEvent(a,"drag",t),e=t.chartX,r=t.chartY}),a.removeMouseUp=addEvent(H.doc,H.isTouchDevice?"touchend":"mouseup",function(t){a.cancelClick=a.hasDragged,a.hasDragged=!1,a.chart.hasDraggedAnnotation=!1,fireEvent(pick(a.target,a),"afterUpdate"),a.onMouseUp(t)}))},onMouseUp:function(t){var e=this.chart,r=this.target||this,a=e.options.annotations,o=e.annotations.indexOf(r);this.removeDocEvents(),a[o]=r.options},onDrag:function(t){if(this.chart.isInsidePlot(t.chartX-this.chart.plotLeft,t.chartY-this.chart.plotTop)){var e=this.mouseMoveToTranslation(t);"x"===this.options.draggable&&(e.y=0),"y"===this.options.draggable&&(e.x=0),this.points.length?this.translate(e.x,e.y):(this.shapes.forEach(function(t){t.translate(e.x,e.y)}),this.labels.forEach(function(t){t.translate(e.x,e.y)})),this.redraw(!1)}},mouseMoveToRadians:function(t,e,r){var a,o=t.prevChartY-r,n=t.prevChartX-e,i=t.chartY-r,s=t.chartX-e;return this.chart.inverted&&(a=n,n=o,o=a,a=s,s=i,i=a),Math.atan2(i,s)-Math.atan2(o,n)},mouseMoveToTranslation:function(t){var e,r=t.chartX-t.prevChartX,a=t.chartY-t.prevChartY;return this.chart.inverted&&(e=a,a=r,r=e),{x:r,y:a}},mouseMoveToScale:function(t,e,r){var a,o=t.prevChartX-e,n=t.prevChartY-r,i=(t.chartX-e||1)/(o||1),s=(t.chartY-r||1)/(n||1);return this.chart.inverted&&(a=s,s=i,i=a),{x:i,y:s}},destroy:function(){this.removeDocEvents(),removeEvent(this),this.hcEvents=null}};export default eventEmitterMixin;