"use strict";var __extends=this&&this.__extends||function(){var t=function(n,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var o in n)n.hasOwnProperty(o)&&(t[o]=n[o])})(n,o)};return function(n,o){function e(){this.constructor=n}t(n,o),n.prototype=null===o?Object.create(o):(e.prototype=o.prototype,new e)}}();import Annotation from"../Annotations.js";import MockPoint from"../MockPoint.js";import Tunnel from"./Tunnel.js";import U from"../../../Core/Utilities.js";var merge=U.merge,createPathDGenerator=function(t,n){return function(){var o,e,i=this.annotation,r=this.anchor(i.startRetracements[t]).absolutePosition,s=this.anchor(i.endRetracements[t]).absolutePosition,a=[["M",Math.round(r.x),Math.round(r.y)],["L",Math.round(s.x),Math.round(s.y)]];return n&&(o=this.anchor(i.endRetracements[t-1]).absolutePosition,e=this.anchor(i.startRetracements[t-1]).absolutePosition,a.push(["L",Math.round(o.x),Math.round(o.y)],["L",Math.round(e.x),Math.round(e.y)])),a}},Fibonacci=function(t){function n(n,o){return t.call(this,n,o)||this}return __extends(n,t),n.prototype.linkPoints=function(){t.prototype.linkPoints.call(this),this.linkRetracementsPoints()},n.prototype.linkRetracementsPoints=function(){var t=this.points,o=t[0].y-t[3].y,e=t[1].y-t[2].y,i=t[0].x,r=t[1].x;n.levels.forEach(function(n,s){var a=t[0].y-o*n,c=t[1].y-e*n;this.startRetracements=this.startRetracements||[],this.endRetracements=this.endRetracements||[],this.linkRetracementPoint(s,i,a,this.startRetracements),this.linkRetracementPoint(s,r,c,this.endRetracements)},this)},n.prototype.linkRetracementPoint=function(t,n,o,e){var i=e[t],r=this.options.typeOptions;i?(i.options.x=n,i.options.y=o,i.refresh()):e[t]=new MockPoint(this.chart,this,{x:n,y:o,xAxis:r.xAxis,yAxis:r.yAxis})},n.prototype.addShapes=function(){n.levels.forEach(function(t,n){this.initShape({type:"path",d:createPathDGenerator(n)},!1),n>0&&this.initShape({type:"path",fill:this.options.typeOptions.backgroundColors[n-1],strokeWidth:0,d:createPathDGenerator(n,!0)})},this)},n.prototype.addLabels=function(){n.levels.forEach(function(t,n){var o=this.options.typeOptions,e=this.initLabel(merge(o.labels[n],{point:function(t){return MockPoint.pointToOptions(t.annotation.startRetracements[n])},text:t.toString()}));o.labels[n]=e.options},this)},n.levels=[0,.236,.382,.5,.618,.786,1],n}(Tunnel);Fibonacci.prototype.defaultOptions=merge(Tunnel.prototype.defaultOptions,{typeOptions:{height:2,backgroundColors:["rgba(130, 170, 255, 0.4)","rgba(139, 191, 216, 0.4)","rgba(150, 216, 192, 0.4)","rgba(156, 229, 161, 0.4)","rgba(162, 241, 130, 0.4)","rgba(169, 255, 101, 0.4)"],lineColor:"grey",lineColors:[],labels:[]},labelOptions:{allowOverlap:!0,align:"right",backgroundColor:"none",borderWidth:0,crop:!1,overflow:"none",shape:"rect",style:{color:"grey"},verticalAlign:"middle",y:0}}),Annotation.types.fibonacci=Fibonacci;export default Fibonacci;