"use strict";import Chart from"../../Core/Chart/Chart.js";import Color from"../../Core/Color/Color.js";var color=Color.parse;import H from"../../Core/Globals.js";var deg2rad=H.deg2rad,doc=H.doc,noop=H.noop,svg=H.svg,win=H.win;import Pointer from"../../Core/Pointer.js";import SVGElement from"../../Core/Renderer/SVG/SVGElement.js";import SVGRenderer from"../../Core/Renderer/SVG/SVGRenderer3D.js";import U from"../../Core/Utilities.js";var VMLRenderer,VMLElement,addEvent=U.addEvent,createElement=U.createElement,css=U.css,defined=U.defined,discardElement=U.discardElement,erase=U.erase,extend=U.extend,extendClass=U.extendClass,getOptions=U.getOptions,isArray=U.isArray,isNumber=U.isNumber,isObject=U.isObject,merge=U.merge,offset=U.offset,pick=U.pick,pInt=U.pInt,setOptions=U.setOptions,uniqueKey=U.uniqueKey;import VMLRenderer3D from"./VMLRenderer3D.js";if(getOptions().global.VMLRadialGradientURL="http://code.highcharts.com/8.2.2/gfx/vml-radial-gradient.png",doc&&!doc.defaultView&&(H.getStyle=U.getStyle=function(e,t){var r,i={width:"clientWidth",height:"clientHeight"}[t];return e.style[t]?pInt(e.style[t]):("opacity"===t&&(t="filter"),i?(e.style.zoom=1,Math.max(e[i]-2*U.getStyle(e,"padding"),0)):(r=e.currentStyle[t.replace(/\-(\w)/g,function(e,t){return t.toUpperCase()})],"filter"===t&&(r=r.replace(/alpha\(opacity=([0-9]+)\)/,function(e,t){return t/100})),""===r?1:pInt(r)))}),!svg){addEvent(SVGElement,"afterInit",function(){"text"===this.element.nodeName&&this.css({position:"absolute"})}),Pointer.prototype.normalize=function(e,t){return(e=e||win.event).target||(e.target=e.srcElement),t||(this.chartPosition=t=offset(this.chart.container)),extend(e,{chartX:Math.round(Math.max(e.x,e.clientX-t.left)),chartY:Math.round(e.y)})},Chart.prototype.ieSanitizeSVG=function(e){return e=e.replace(/<IMG /g,"<image ").replace(/<(\/?)TITLE>/g,"<$1title>").replace(/height=([^" ]+)/g,'height="$1"').replace(/width=([^" ]+)/g,'width="$1"').replace(/hc-svg-href="([^"]+)">/g,'xlink:href="$1"/>').replace(/ id=([^" >]+)/g,' id="$1"').replace(/class=([^" >]+)/g,'class="$1"').replace(/ transform /g," ").replace(/:(path|rect)/g,"$1").replace(/style="([^"]+)"/g,function(e){return e.toLowerCase()})},Chart.prototype.isReadyToRender=function(){var e=this;return!(!svg&&win==win.top&&"complete"!==doc.readyState)||(doc.attachEvent("onreadystatechange",function(){doc.detachEvent("onreadystatechange",e.firstRender),"complete"===doc.readyState&&e.firstRender()}),!1)},doc.createElementNS||(doc.createElementNS=function(e,t){return doc.createElement(t)}),H.addEventListenerPolyfill=function(e,t){var r=this;function i(e){e.target=e.srcElement||win,t.call(r,e)}r.attachEvent&&(r.hcEventsIE||(r.hcEventsIE={}),t.hcKey||(t.hcKey=uniqueKey()),r.hcEventsIE[t.hcKey]=i,r.attachEvent("on"+e,i))},H.removeEventListenerPolyfill=function(e,t){this.detachEvent&&(t=this.hcEventsIE[t.hcKey],this.detachEvent("on"+e,t))},(VMLElement={docMode8:doc&&8===doc.documentMode,init:function(e,t){var r=["<",t,' filled="f" stroked="f"'],i=["position: ","absolute",";"],n="div"===t;("shape"===t||n)&&i.push("left:0;top:0;width:1px;height:1px;"),i.push("visibility: ",n?"hidden":"visible"),r.push(' style="',i.join(""),'"/>'),t&&(r=n||"span"===t||"img"===t?r.join(""):e.prepVML(r),this.element=createElement(r)),this.renderer=e},add:function(e){var t=this.renderer,r=this.element,i=t.box,n=e&&e.inverted,o=e?e.element||e:i;return e&&(this.parentGroup=e),n&&t.invertChild(r,o),o.appendChild(r),this.added=!0,this.alignOnAdd&&!this.deferUpdateTransform&&this.updateTransform(),this.onAdd&&this.onAdd(),this.className&&this.attr("class",this.className),this},updateTransform:SVGElement.prototype.htmlUpdateTransform,setSpanRotation:function(){var e=this.rotation,t=Math.cos(e*deg2rad),r=Math.sin(e*deg2rad);css(this.element,{filter:e?["progid:DXImageTransform.Microsoft.Matrix(M11=",t,", M12=",-r,", M21=",r,", M22=",t,", sizingMethod='auto expand')"].join(""):"none"})},getSpanCorrection:function(e,t,r,i,n){var o,s=i?Math.cos(i*deg2rad):1,a=i?Math.sin(i*deg2rad):0,l=pick(this.elemHeight,this.element.offsetHeight),c=n&&"left"!==n;this.xCorr=s<0&&-e,this.yCorr=a<0&&-l,o=s*a<0,this.xCorr+=a*t*(o?1-r:r),this.yCorr-=s*t*(i?o?r:1-r:1),c&&(this.xCorr-=e*r*(s<0?-1:1),i&&(this.yCorr-=l*r*(a<0?-1:1)),css(this.element,{textAlign:n}))},pathToVML:function(e){for(var t=e.length,r=[];t--;)isNumber(e[t])?r[t]=Math.round(10*e[t])-5:"Z"===e[t]?r[t]="x":(r[t]=e[t],!e.isArc||"wa"!==e[t]&&"at"!==e[t]||(r[t+5]===r[t+7]&&(r[t+7]+=e[t+7]>e[t+5]?1:-1),r[t+6]===r[t+8]&&(r[t+8]+=e[t+8]>e[t+6]?1:-1)));return r.join(" ")||"x"},clip:function(e){var t,r,i=this;return e?(t=e.members,erase(t,i),t.push(i),i.destroyClip=function(){erase(t,i)},r=e.getCSS(i)):(i.destroyClip&&i.destroyClip(),r={clip:i.docMode8?"inherit":"rect(auto)"}),i.css(r)},css:SVGElement.prototype.htmlCss,safeRemoveChild:function(e){e.parentNode&&discardElement(e)},destroy:function(){return this.destroyClip&&this.destroyClip(),SVGElement.prototype.destroy.apply(this)},on:function(e,t){return this.element["on"+e]=function(){var e=win.event;e.target=e.srcElement,t(e)},this},cutOffPath:function(e,t){var r;return 9!==(r=(e=e.split(/[ ,]/)).length)&&11!==r||(e[r-4]=e[r-2]=pInt(e[r-2])-10*t),e.join(" ")},shadow:function(e,t,r){var i,n,o,s,a,l,c,h=[],d=this.element,p=this.renderer,f=d.style,u=d.path;if(u&&"string"!=typeof u.value&&(u="x"),a=u,e){for(l=pick(e.width,3),c=(e.opacity||.15)/l,i=1;i<=3;i++)s=2*l+1-2*i,r&&(a=this.cutOffPath(u.value,s+.5)),o=['<shape isShadow="true" strokeweight="',s,'" filled="false" path="',a,'" coordsize="10 10" style="',d.style.cssText,'" />'],n=createElement(p.prepVML(o),null,{left:pInt(f.left)+pick(e.offsetX,1),top:pInt(f.top)+pick(e.offsetY,1)}),r&&(n.cutOff=s+1),o=['<stroke color="',e.color||"#000000",'" opacity="',c*i,'"/>'],createElement(p.prepVML(o),null,null,n),t?t.element.appendChild(n):d.parentNode.insertBefore(n,d),h.push(n);this.shadows=h}return this},updateShadows:noop,setAttr:function(e,t){this.docMode8?this.element[e]=t:this.element.setAttribute(e,t)},getAttr:function(e){return this.docMode8?this.element[e]:this.element.getAttribute(e)},classSetter:function(e){(this.added?this.element:this).className=e},dashstyleSetter:function(e,t,r){(r.getElementsByTagName("stroke")[0]||createElement(this.renderer.prepVML(["<stroke/>"]),null,null,r))[t]=e||"solid",this[t]=e},dSetter:function(e,t,r){var i,n=this.shadows;if(e=e||[],this.d=e.join&&e.join(" "),r.path=e=this.pathToVML(e),n)for(i=n.length;i--;)n[i].path=n[i].cutOff?this.cutOffPath(e,n[i].cutOff):e;this.setAttr(t,e)},fillSetter:function(e,t,r){var i=r.nodeName;"SPAN"===i?r.style.color=e:"IMG"!==i&&(r.filled="none"!==e,this.setAttr("fillcolor",this.renderer.color(e,r,t,this)))},"fill-opacitySetter":function(e,t,r){createElement(this.renderer.prepVML(["<",t.split("-")[0],' opacity="',e,'"/>']),null,null,r)},opacitySetter:noop,rotationSetter:function(e,t,r){var i=r.style;this[t]=i[t]=e,i.left=-Math.round(Math.sin(e*deg2rad)+1)+"px",i.top=Math.round(Math.cos(e*deg2rad))+"px"},strokeSetter:function(e,t,r){this.setAttr("strokecolor",this.renderer.color(e,r,t,this))},"stroke-widthSetter":function(e,t,r){r.stroked=!!e,this[t]=e,isNumber(e)&&(e+="px"),this.setAttr("strokeweight",e)},titleSetter:function(e,t){this.setAttr(t,e)},visibilitySetter:function(e,t,r){"inherit"===e&&(e="visible"),this.shadows&&this.shadows.forEach(function(r){r.style[t]=e}),"DIV"===r.nodeName&&(e="hidden"===e?"-999em":0,this.docMode8||(r.style[t]=e?"visible":"hidden"),t="top"),r.style[t]=e},xSetter:function(e,t,r){this[t]=e,"x"===t?t="left":"y"===t&&(t="top"),this.updateClipping?(this[t]=e,this.updateClipping()):r.style[t]=e},zIndexSetter:function(e,t,r){r.style[t]=e},fillGetter:function(){return this.getAttr("fillcolor")||""},strokeGetter:function(){return this.getAttr("strokecolor")||""},classGetter:function(){return this.getAttr("className")||""}})["stroke-opacitySetter"]=VMLElement["fill-opacitySetter"],H.VMLElement=VMLElement=extendClass(SVGElement,VMLElement),VMLElement.prototype.ySetter=VMLElement.prototype.widthSetter=VMLElement.prototype.heightSetter=VMLElement.prototype.xSetter;var VMLRendererExtension={Element:VMLElement,isIE8:win.navigator.userAgent.indexOf("MSIE 8.0")>-1,init:function(e,t,r){var i,n,o;if(this.crispPolyLine=SVGRenderer.prototype.crispPolyLine,this.alignedObjects=[],n=(i=this.createElement("div").css({position:"relative"})).element,e.appendChild(i.element),this.isVML=!0,this.box=n,this.boxWrapper=i,this.gradients={},this.cache={},this.cacheKeys=[],this.imgCount=0,this.setSize(t,r,!1),!doc.namespaces.hcv){doc.namespaces.add("hcv","urn:schemas-microsoft-com:vml"),o="hcv\\:fill, hcv\\:path, hcv\\:shape, hcv\\:stroke{ behavior:url(#default#VML); display: inline-block; } ";try{doc.createStyleSheet().cssText=o}catch(e){doc.styleSheets[0].cssText+=o}}},isHidden:function(){return!this.box.offsetWidth},clipRect:function(e,t,r,i){var n=this.createElement(),o=isObject(e);return extend(n,{members:[],count:0,left:(o?e.x:e)+1,top:(o?e.y:t)+1,width:(o?e.width:r)-1,height:(o?e.height:i)-1,getCSS:function(e){var t=e.element,r=t.nodeName,i="shape"===r,n=e.inverted,o=this.top-(i?t.offsetTop:0),s=this.left,a=s+this.width,l=o+this.height,c={clip:"rect("+Math.round(n?s:o)+"px,"+Math.round(n?l:a)+"px,"+Math.round(n?a:l)+"px,"+Math.round(n?o:s)+"px)"};return!n&&e.docMode8&&"DIV"===r&&extend(c,{width:a+"px",height:l+"px"}),c},updateClipping:function(){n.members.forEach(function(e){e.element&&e.css(n.getCSS(e))})}})},color:function(e,t,r,i){var n,o,s,a=this,l=/^rgba/,c="none";if(e&&e.linearGradient?s="gradient":e&&e.radialGradient&&(s="pattern"),s){var h,d,p,f,u,m,g,y,v,M,E,x,S=e.linearGradient||e.radialGradient,V="",C=e.stops,L=[],b=function(){o=['<fill colors="'+L.join(",")+'" opacity="',y,'" o:opacity2="',g,'" type="',s,'" ',V,'focus="100%" method="any" />'],createElement(a.prepVML(o),null,null,t)};if(E=C[0],x=C[C.length-1],E[0]>0&&C.unshift([0,E[1]]),x[0]<1&&C.push([1,x[1]]),C.forEach(function(e,t){l.test(e[1])?(n=color(e[1]),h=n.get("rgb"),d=n.get("a")):(h=e[1],d=1),L.push(100*e[0]+"% "+h),t?(y=d,v=h):(g=d,M=h)}),"fill"===r)if("gradient"===s)p=S.x1||S[0]||0,f=S.y1||S[1]||0,u=S.x2||S[2]||0,m=S.y2||S[3]||0,V='angle="'+(90-180*Math.atan((m-f)/(u-p))/Math.PI)+'"',b();else{var w,R=S.r,G=2*R,I=2*R,U=S.cx,A=S.cy,N=t.radialReference,j=function(){N&&(w=i.getBBox(),U+=(N[0]-w.x)/w.width-.5,A+=(N[1]-w.y)/w.height-.5,G*=N[2]/w.width,I*=N[2]/w.height),V='src="'+getOptions().global.VMLRadialGradientURL+'" size="'+G+","+I+'" origin="0.5,0.5" position="'+U+","+A+'" color2="'+M+'" ',b()};i.added?j():i.onAdd=j,c=v}else c=h}else if(l.test(e)&&"IMG"!==t.tagName)n=color(e),i[r+"-opacitySetter"](n.get("a"),r,t),c=n.get("rgb");else{var k=t.getElementsByTagName(r);k.length&&(k[0].opacity=1,k[0].type="solid"),c=e}return c},prepVML:function(e){var t="display:inline-block;behavior:url(#default#VML);",r=this.isIE8;return e=e.join(""),e=r?-1===(e=e.replace("/>",' xmlns="urn:schemas-microsoft-com:vml" />')).indexOf('style="')?e.replace("/>",' style="'+t+'" />'):e.replace('style="','style="'+t):e.replace("<","<hcv:")},text:SVGRenderer.prototype.html,path:function(e){var t={coordsize:"10 10"};return isArray(e)?t.d=e:isObject(e)&&extend(t,e),this.createElement("shape").attr(t)},circle:function(e,t,r){var i=this.symbol("circle");return isObject(e)&&(r=e.r,t=e.y,e=e.x),i.isCircle=!0,i.r=r,i.attr({x:e,y:t})},g:function(e){var t;return e&&(t={className:"highcharts-"+e,class:"highcharts-"+e}),this.createElement("div").attr(t)},image:function(e,t,r,i,n){var o=this.createElement("img").attr({src:e});return arguments.length>1&&o.attr({x:t,y:r,width:i,height:n}),o},createElement:function(e){return"rect"===e?this.symbol(e):SVGRenderer.prototype.createElement.call(this,e)},invertChild:function(e,t){var r=this,i=t.style,n="IMG"===e.tagName&&e.style;css(e,{flip:"x",left:pInt(i.width)-(n?pInt(n.top):1),top:pInt(i.height)-(n?pInt(n.left):1),rotation:-90}),[].forEach.call(e.childNodes,function(t){r.invertChild(t,e)})},symbols:{arc:function(e,t,r,i,n){var o,s=n.start,a=n.end,l=n.r||r||i,c=n.innerR,h=Math.cos(s),d=Math.sin(s),p=Math.cos(a),f=Math.sin(a);return a-s==0?["x"]:(o=["wa",e-l,t-l,e+l,t+l,e+l*h,t+l*d,e+l*p,t+l*f],n.open&&!c&&o.push("e","M",e,t),o.push("at",e-c,t-c,e+c,t+c,e+c*p,t+c*f,e+c*h,t+c*d,"x","e"),o.isArc=!0,o)},circle:function(e,t,r,i,n){return n&&defined(n.r)&&(r=i=2*n.r),n&&n.isCircle&&(e-=r/2,t-=i/2),["wa",e,t,e+r,t+i,e+r,t+i/2,e+r,t+i/2,"e"]},rect:function(e,t,r,i,n){return SVGRenderer.prototype.symbols[defined(n)&&n.r?"callout":"square"].call(0,e,t,r,i,n)}}};H.VMLRenderer=VMLRenderer=function(){this.init.apply(this,arguments)},VMLRenderer.prototype=merge(VMLRenderer.prototype,SVGRenderer.prototype,VMLRendererExtension),H.Renderer=VMLRenderer,VMLRenderer3D.compose(VMLRenderer,SVGRenderer)}SVGRenderer.prototype.getSpanWidth=function(e,t){var r=e.getBBox(!0).width;return!svg&&this.forExport&&(r=this.measureSpanWidth(t.firstChild.data,e.styles)),r},SVGRenderer.prototype.measureSpanWidth=function(e,t){var r,i=doc.createElement("span"),n=doc.createTextNode(e);return i.appendChild(n),css(i,t),this.box.appendChild(i),r=i.offsetWidth,discardElement(i),r};