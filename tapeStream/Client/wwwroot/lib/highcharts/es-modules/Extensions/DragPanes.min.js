"use strict";import H from"../Core/Globals.js";var hasTouch=H.hasTouch;import Axis from"../Core/Axis/Axis.js";import Pointer from"../Core/Pointer.js";import U from"../Core/Utilities.js";var addEvent=U.addEvent,clamp=U.clamp,isNumber=U.isNumber,merge=U.merge,objectEach=U.objectEach,relativeLength=U.relativeLength,wrap=U.wrap,AxisResizer=function(){function t(t){this.axis=void 0,this.controlLine=void 0,this.lastPos=void 0,this.options=void 0,this.init(t)}return t.prototype.init=function(t,e){this.axis=t,this.options=t.options.resize,this.render(),e||this.addMouseEvents()},t.prototype.render=function(){var t,e=this.axis,i=e.chart,o=this.options,s=o.x||0,n=o.y,r=clamp(e.top+e.height+n,i.plotTop,i.plotTop+i.plotHeight),a={};i.styledMode||(a={cursor:o.cursor,stroke:o.lineColor,"stroke-width":o.lineWidth,dashstyle:o.lineDashStyle}),this.lastPos=r-n,this.controlLine||(this.controlLine=i.renderer.path().addClass("highcharts-axis-resizer")),this.controlLine.add(e.axisGroup),t=i.styledMode?this.controlLine.strokeWidth():o.lineWidth,a.d=i.renderer.crispLine([["M",e.left+s,r],["L",e.left+e.width+s,r]],t),this.controlLine.attr(a)},t.prototype.addMouseEvents=function(){var t,e,i,o=this,s=o.controlLine.element,n=o.axis.chart.container,r=[];o.mouseMoveHandler=t=function(t){o.onMouseMove(t)},o.mouseUpHandler=e=function(t){o.onMouseUp(t)},o.mouseDownHandler=i=function(t){o.onMouseDown(t)},r.push(addEvent(n,"mousemove",t),addEvent(n.ownerDocument,"mouseup",e),addEvent(s,"mousedown",i)),hasTouch&&r.push(addEvent(n,"touchmove",t),addEvent(n.ownerDocument,"touchend",e),addEvent(s,"touchstart",i)),o.eventsToUnbind=r},t.prototype.onMouseMove=function(t){t.touches&&0===t.touches[0].pageX||this.grabbed&&(this.hasDragged=!0,this.updateAxes(this.axis.chart.pointer.normalize(t).chartY-this.options.y))},t.prototype.onMouseUp=function(t){this.hasDragged&&this.updateAxes(this.axis.chart.pointer.normalize(t).chartY-this.options.y),this.grabbed=this.hasDragged=this.axis.chart.activeResizer=null},t.prototype.onMouseDown=function(t){this.axis.chart.pointer.reset(!1,0),this.grabbed=this.axis.chart.activeResizer=!0},t.prototype.updateAxes=function(t){var e,i=this,o=i.axis.chart,s=i.options.controlledAxis,n=0===s.next.length?[o.yAxis.indexOf(i.axis)+1]:s.next,r=[i.axis].concat(s.prev),a=[],h=!1,c=o.plotTop,p=o.plotHeight,d=c+p,u=function(t){return 100*t/p+"%"},l=function(t,e,i){return Math.round(clamp(t,e,i))};t=clamp(t,c,d),(e=t-i.lastPos)*e<1||([r,n].forEach(function(s,n){s.forEach(function(s,r){var x,v,f,m,y=isNumber(s)?o.yAxis[s]:n||r?o.get(s):s,g=y&&y.options,z=0;g&&"navigator-y-axis"!==g.id&&(v=y.top,f=Math.round(relativeLength(g.minLength,p)),m=Math.round(relativeLength(g.maxLength,p)),n?(e=t-i.lastPos,x=l(y.len-e,f,m),(v=y.top+e)+x>d&&(t+=z=d-x-v,v+=z),v<c&&(v=c)+x>d&&(x=p),x===f&&(h=!0),a.push({axis:y,options:{top:u(v-c),height:u(x)}})):((x=l(t-v,f,m))===m&&(h=!0),t=v+x,a.push({axis:y,options:{height:u(x)}})))})}),h||(a.forEach(function(t){t.axis.update(t.options,!1)}),o.redraw(!1)))},t.prototype.destroy=function(){var t=this;delete t.axis.resizer,this.eventsToUnbind&&this.eventsToUnbind.forEach(function(t){t()}),t.controlLine.destroy(),objectEach(t,function(e,i){t[i]=null})},t.resizerOptions={minLength:"10%",maxLength:"100%",resize:{controlledAxis:{next:[],prev:[]},enabled:!1,cursor:"ns-resize",lineColor:"#cccccc",lineDashStyle:"Solid",lineWidth:4,x:0,y:0}},t}();Axis.keepProps.push("resizer"),addEvent(Axis,"afterRender",function(){var t,e=this.resizer,i=this.options.resize;i&&(t=!1!==i.enabled,e?t?e.init(this,!0):e.destroy():t&&(this.resizer=new AxisResizer(this)))}),addEvent(Axis,"destroy",function(t){!t.keepEvents&&this.resizer&&this.resizer.destroy()}),wrap(Pointer.prototype,"runPointActions",function(t){this.chart.activeResizer||t.apply(this,Array.prototype.slice.call(arguments,1))}),wrap(Pointer.prototype,"drag",function(t){this.chart.activeResizer||t.apply(this,Array.prototype.slice.call(arguments,1))}),merge(!0,Axis.defaultYAxisOptions,AxisResizer.resizerOptions),H.AxisResizer=AxisResizer;export default H.AxisResizer;