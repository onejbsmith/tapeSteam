"use strict";import H from"../../Core/Globals.js";import U from"../../Core/Utilities.js";var error=U.error,merge=U.merge,pick=U.pick;import utilities from"./Utilities.js";var defaultInstrumentOptions={minDuration:20,maxDuration:2e3,minVolume:.1,maxVolume:1,minPan:-1,maxPan:1,minFrequency:220,maxFrequency:2200};function pointSonify(n){var i,t=this,e=t.series.chart,o=pick(n.masterVolume,null===(i=e.options.sonification)||void 0===i?void 0:i.masterVolume),a=n.dataExtremes||{},s=function(n,i,e){if("function"==typeof n)return i?function(i){return n(t,a,i)}:n(t,a);if("string"==typeof n){var o="-"===n.charAt(0),s=o?n.slice(1):n,r=pick(t[s],t.options[s]);return a[s]=a[s]||utilities.calculateDataExtremes(t.series.chart,s),utilities.virtualAxisTranslate(r,a[s],e,o)}return n};e.sonification.currentlyPlayingPoint=t,t.sonification=t.sonification||{},t.sonification.instrumentsPlaying=t.sonification.instrumentsPlaying||{};var r=t.sonification.signalHandler=t.sonification.signalHandler||new utilities.SignalHandler(["onEnd"]);r.clearSignalCallbacks(),r.registerSignalCallbacks({onEnd:n.onEnd}),!t.isNull&&t.visible&&t.series.visible?n.instruments.forEach(function(n){var i="string"==typeof n.instrument?H.sonification.instruments[n.instrument]:n.instrument,a=n.instrumentMapping||{},l=merge(defaultInstrumentOptions,n.instrumentOptions),u=i.id;i&&i.play?(void 0!==o&&i.setMasterVolume(o),t.sonification.instrumentsPlaying[i.id]=i,i.play({frequency:s(a.frequency,!0,{min:l.minFrequency,max:l.maxFrequency}),duration:s(a.duration,!1,{min:l.minDuration,max:l.maxDuration}),pan:s(a.pan,!0,{min:l.minPan,max:l.maxPan}),volume:s(a.volume,!0,{min:l.minVolume,max:l.maxVolume}),onEnd:function(i){n.onEnd&&n.onEnd.apply(this,arguments),e.sonification&&e.sonification.currentlyPlayingPoint&&delete e.sonification.currentlyPlayingPoint,t.sonification&&t.sonification.instrumentsPlaying&&(delete t.sonification.instrumentsPlaying[u],Object.keys(t.sonification.instrumentsPlaying).length||r.emitSignal("onEnd",i))},minFrequency:l.minFrequency,maxFrequency:l.maxFrequency})):error(30)}):r.emitSignal("onEnd")}function pointCancelSonify(n){var i=this.sonification&&this.sonification.instrumentsPlaying,t=i&&Object.keys(i);t&&t.length&&(t.forEach(function(t){i[t].stop(!n,null,"cancelled")}),this.sonification.instrumentsPlaying={},this.sonification.signalHandler.emitSignal("onEnd","cancelled"))}var pointSonifyFunctions={pointSonify:pointSonify,pointCancelSonify:pointCancelSonify};export default pointSonifyFunctions;