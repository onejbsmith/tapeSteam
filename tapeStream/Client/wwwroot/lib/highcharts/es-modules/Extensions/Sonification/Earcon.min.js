"use strict";import H from"../../Core/Globals.js";import U from"../../Core/Utilities.js";var error=U.error,merge=U.merge,pick=U.pick,uniqueKey=U.uniqueKey;function Earcon(n){this.init(n||{})}Earcon.prototype.init=function(n){this.options=n,this.options.id||(this.options.id=this.id=uniqueKey()),this.instrumentsPlaying={}},Earcon.prototype.sonify=function(n){var t=merge(this.options,n),i=pick(t.volume,1),o=t.pan,e=this,s=n&&n.onEnd,r=e.options.onEnd;t.instruments.forEach(function(n){var t,p,a="string"==typeof n.instrument?H.sonification.instruments[n.instrument]:n.instrument,u=merge(n.playOptions),c="";a&&a.play?n.playOptions&&(u.pan=pick(o,u.pan),t=u.onEnd,u.onEnd=function(){delete e.instrumentsPlaying[c],t&&t.apply(this,arguments),Object.keys(e.instrumentsPlaying).length||(s&&s.apply(this,arguments),r&&r.apply(this,arguments))},(p=a.copy()).setMasterVolume(i),c=p.id,e.instrumentsPlaying[c]=p,p.play(u)):error(30)})},Earcon.prototype.cancelSonify=function(n){var t=this.instrumentsPlaying,i=t&&Object.keys(t);i&&i.length&&(i.forEach(function(i){t[i].stop(!n,null,"cancelled")}),this.instrumentsPlaying={})};export default Earcon;