"use strict";import Chart from"../Core/Chart/Chart.js";import U from"../Core/Utilities.js";var addEvent=U.addEvent,fireEvent=U.fireEvent,isArray=U.isArray,isNumber=U.isNumber,objectEach=U.objectEach,pick=U.pick;addEvent(Chart,"render",function(){var t=[];(this.labelCollectors||[]).forEach(function(a){t=t.concat(a())}),(this.yAxis||[]).forEach(function(a){a.stacking&&a.options.stackLabels&&!a.options.stackLabels.allowOverlap&&objectEach(a.stacking.stacks,function(a){objectEach(a,function(a){t.push(a.label)})})}),(this.series||[]).forEach(function(a){var e=a.options.dataLabels;a.visible&&(!1!==e.enabled||a._hasPointLabels)&&(a.nodes||a.points).forEach(function(a){a.visible&&(isArray(a.dataLabels)?a.dataLabels:a.dataLabel?[a.dataLabel]:[]).forEach(function(e){var i=e.options;e.labelrank=pick(i.labelrank,a.labelrank,a.shapeArgs&&a.shapeArgs.height),i.allowOverlap||t.push(e)})})}),this.hideOverlappingLabels(t)}),Chart.prototype.hideOverlappingLabels=function(t){var a,e,i,r,n,l,o,s=this,h=t.length,c=s.renderer,d=!1,p=function(t,a){return!(a.x>=t.x+t.width||a.x+a.width<=t.x||a.y>=t.y+t.height||a.y+a.height<=t.y)},b=function(t){var a,e,i,r,n,l=t.box?0:t.padding||0,o=0,s=0;if(t&&(!t.alignAttr||t.placed))return a=t.alignAttr||{x:t.attr("x"),y:t.attr("y")},e=t.parentGroup,t.width||(i=t.getBBox(),t.width=i.width,t.height=i.height,o=c.fontMetrics(null,t.element).h),r=t.width-2*l,(n={left:"0",center:"0.5",right:"1"}[t.alignValue])?s=+n*r:isNumber(t.x)&&Math.round(t.x)!==t.translateX&&(s=t.x-t.translateX),{x:a.x+(e.translateX||0)+l-(s||0),y:a.y+(e.translateY||0)+l-o,width:t.width-2*l,height:t.height-2*l}};for(e=0;e<h;e++)(a=t[e])&&(a.oldOpacity=a.opacity,a.newOpacity=1,a.absoluteBox=b(a));for(t.sort(function(t,a){return(a.labelrank||0)-(t.labelrank||0)}),e=0;e<h;e++)for(l=(r=t[e])&&r.absoluteBox,i=e+1;i<h;++i)o=(n=t[i])&&n.absoluteBox,l&&o&&r!==n&&0!==r.newOpacity&&0!==n.newOpacity&&p(l,o)&&((r.labelrank<n.labelrank?r:n).newOpacity=0);t.forEach(function(t){var a,e;t&&(e=t.newOpacity,t.oldOpacity!==e&&(t.alignAttr&&t.placed?(t[e?"removeClass":"addClass"]("highcharts-data-label-hidden"),a=function(){s.styledMode||t.css({pointerEvents:e?"auto":"none"}),t.visibility=e?"inherit":"hidden"},d=!0,t.alignAttr.opacity=e,t[t.isOld?"animate":"attr"](t.alignAttr,null,a),fireEvent(s,"afterHideOverlappingLabel")):t.attr({opacity:e})),t.isOld=!0)}),d&&fireEvent(s,"afterHideAllOverlappingLabels")};