import Axis from"../Axis/Axis.js";import Chart from"../Chart/Chart.js";import H from"../Globals.js";import LineSeries from"../../Series/LineSeries.js";import Point from"../Series/Point.js";import SVGRenderer from"../Renderer/SVG/SVGRenderer.js";import U from"../Utilities.js";var addEvent=U.addEvent,arrayMax=U.arrayMax,arrayMin=U.arrayMin,clamp=U.clamp,defined=U.defined,extend=U.extend,find=U.find,format=U.format,getOptions=U.getOptions,isNumber=U.isNumber,isString=U.isString,merge=U.merge,pick=U.pick,splat=U.splat;import"../Pointer.js";import"../Navigator.js";import"../Scrollbar.js";import"../../Extensions/RangeSelector.js";var seriesProto=LineSeries.prototype,seriesInit=seriesProto.init,seriesProcessData=seriesProto.processData,pointTooltipFormatter=Point.prototype.tooltipFormatter;H.StockChart=H.stockChart=function(i,t,e){var s,r=isString(i)||i.nodeName,a=arguments[r?1:0],o=a,n=a.series,h=getOptions(),l=pick(a.navigator&&a.navigator.enabled,h.navigator.enabled,!0);return a.xAxis=splat(a.xAxis||{}).map(function(i,t){return merge({minPadding:0,maxPadding:0,overscroll:0,ordinal:!0,title:{text:null},labels:{overflow:"justify"},showLastLabel:!0},h.xAxis,h.xAxis&&h.xAxis[t],i,{type:"datetime",categories:null},l?{startOnTick:!1,endOnTick:!1}:null)}),a.yAxis=splat(a.yAxis||{}).map(function(i,t){return s=pick(i.opposite,!0),merge({labels:{y:-2},opposite:s,showLastLabel:!(!i.categories&&"category"!==i.type),title:{text:null}},h.yAxis,h.yAxis&&h.yAxis[t],i)}),a.series=null,(a=merge({chart:{panning:{enabled:!0,type:"x"},pinchType:"x"},navigator:{enabled:l},scrollbar:{enabled:pick(h.scrollbar.enabled,!0)},rangeSelector:{enabled:pick(h.rangeSelector.enabled,!0)},title:{text:null},tooltip:{split:pick(h.tooltip.split,!0),crosshairs:!0},legend:{enabled:!1}},a,{isStock:!0})).series=o.series=n,r?new Chart(i,a,e):new Chart(a,t)},addEvent(LineSeries,"setOptions",function(i){var t;this.chart.options.isStock&&(this.is("column")||this.is("columnrange")?t={borderWidth:0,shadow:!1}:this.is("scatter")||this.is("sma")||(t={marker:{enabled:!1,radius:2}}),t&&(i.plotOptions[this.type]=merge(i.plotOptions[this.type],t)))}),addEvent(Axis,"autoLabelAlign",function(i){var t,e=this.chart,s=this.options,r=e._labelPanes=e._labelPanes||{},a=this.options.labels;this.chart.options.isStock&&"yAxis"===this.coll&&!r[t=s.top+","+s.height]&&a.enabled&&(15===a.x&&(a.x=0),void 0===a.align&&(a.align="right"),r[t]=this,i.align="right",i.preventDefault())}),addEvent(Axis,"destroy",function(){var i=this.chart,t=this.options&&this.options.top+","+this.options.height;t&&i._labelPanes&&i._labelPanes[t]===this&&delete i._labelPanes[t]}),addEvent(Axis,"getPlotLinePath",function(i){var t,e,s,r,a,o,n,h,l,p=this,c=this.isLinked&&!this.series?this.linkedParent.series:this.series,d=p.chart,x=d.renderer,f=p.left,u=p.top,g=[],m=[],y=i.translatedValue,b=i.value,A=i.force;(d.options.isStock&&!1!==i.acrossPanes&&"xAxis"===p.coll||"yAxis"===p.coll)&&(i.preventDefault(),n=p.coll,h="xAxis"===n?"yAxis":"xAxis",l=p.options[h],m=isNumber(l)?[d[h][l]]:isString(l)?[d.get(l)]:c.map(function(i){return i[h]}),(p.isXAxis?d.yAxis:d.xAxis).forEach(function(i){if(!defined(i.options.id)||-1===i.options.id.indexOf("navigator")){var t=i.isXAxis?"yAxis":"xAxis",e=defined(i.options[t])?d[t][i.options[t]]:d[t][0];p===e&&m.push(i)}}),a=m.length?[]:[p.isXAxis?d.yAxis[0]:d.xAxis[0]],m.forEach(function(i){-1!==a.indexOf(i)||find(a,function(t){return t.pos===i.pos&&t.len===i.len})||a.push(i)}),o=pick(y,p.translate(b,null,null,i.old)),isNumber(o)&&(p.horiz?a.forEach(function(i){var a;e=i.pos,r=e+i.len,t=s=Math.round(o+p.transB),"pass"!==A&&(t<f||t>f+p.width)&&(A?t=s=clamp(t,f,f+p.width):a=!0),a||g.push(["M",t,e],["L",s,r])}):a.forEach(function(i){var a;t=i.pos,s=t+i.len,e=r=Math.round(u+p.height-o),"pass"!==A&&(e<u||e>u+p.height)&&(A?e=r=clamp(e,u,u+p.height):a=!0),a||g.push(["M",t,e],["L",s,r])})),i.path=g.length>0?x.crispPolyLine(g,i.lineWidth||1):null)}),SVGRenderer.prototype.crispPolyLine=function(i,t){for(var e=0;e<i.length;e+=2){var s=i[e],r=i[e+1];s[1]===r[1]&&(s[1]=r[1]=Math.round(s[1])-t%2/2),s[2]===r[2]&&(s[2]=r[2]=Math.round(s[2])+t%2/2)}return i},addEvent(Axis,"afterHideCrosshair",function(){this.crossLabel&&(this.crossLabel=this.crossLabel.hide())}),addEvent(Axis,"afterDrawCrosshair",function(i){if(defined(this.crosshair.label)&&this.crosshair.label.enabled&&this.cross){var t,e,s,r,a,o,n=this.chart,h=this.logarithmic,l=this.options.crosshair.label,p=this.horiz,c=this.opposite,d=this.left,x=this.top,f=this.crossLabel,u=l.format,g="",m="inside"===this.options.tickPosition,y=!1!==this.crosshair.snap,b=0,A=i.e||this.cross&&this.cross.e,v=i.point,k=this.min,P=this.max;h&&(k=h.lin2log(k),P=h.lin2log(P)),a=p?"center":c?"right"===this.labelAlign?"right":"left":"left"===this.labelAlign?"left":"center",f||(f=this.crossLabel=n.renderer.label(null,null,null,l.shape||"callout").addClass("highcharts-crosshair-label"+(this.series[0]&&" highcharts-color-"+this.series[0].colorIndex)).attr({align:l.align||a,padding:pick(l.padding,8),r:pick(l.borderRadius,3),zIndex:2}).add(this.labelGroup),n.styledMode||f.attr({fill:l.backgroundColor||this.series[0]&&this.series[0].color||"#666666",stroke:l.borderColor||"","stroke-width":l.borderWidth||0}).css(extend({color:"#ffffff",fontWeight:"normal",fontSize:"11px",textAlign:"center"},l.style))),p?(t=y?v.plotX+d:A.chartX,e=x+(c?0:this.height)):(t=c?this.width+d:0,e=y?v.plotY+x:A.chartY),u||l.formatter||(this.dateTime&&(g="%b %d, %Y"),u="{value"+(g?":"+g:"")+"}"),o=y?v[this.isXAxis?"x":"y"]:this.toValue(p?A.chartX:A.chartY),f.attr({text:u?format(u,{value:o},n):l.formatter.call(this,o),x:t,y:e,visibility:o<k||o>P?"hidden":"visible"}),s=f.getBBox(),isNumber(f.y)&&(p?(m&&!c||!m&&c)&&(e=f.y-s.height):e=f.y-s.height/2),r=p?{left:d-s.x,right:d+this.width-s.x}:{left:"left"===this.labelAlign?d:0,right:"right"===this.labelAlign?d+this.width:n.chartWidth},f.translateX<r.left&&(b=r.left-f.translateX),f.translateX+s.width>=r.right&&(b=-(f.translateX+s.width-r.right)),f.attr({x:t+b,y:e,anchorX:p?t:this.opposite?0:n.chartWidth,anchorY:p?this.opposite?n.chartHeight:0:e+s.height/2})}}),seriesProto.init=function(){seriesInit.apply(this,arguments),this.setCompare(this.options.compare)},seriesProto.setCompare=function(i){this.modifyValue="value"===i||"percent"===i?function(t,e){var s=this.compareValue;return void 0!==t&&void 0!==s?("value"===i?t-=s:t=t/s*100-(100===this.options.compareBase?0:100),e&&(e.change=t),t):0}:null,this.userOptions.compare=i,this.chart.hasRendered&&(this.isDirty=!0)},seriesProto.processData=function(i){var t,e,s,r,a,o=-1,n=!0===this.options.compareStart?0:1;if(seriesProcessData.apply(this,arguments),this.xAxis&&this.processedYData)for(e=this.processedXData,r=(s=this.processedYData).length,this.pointArrayMap&&(o=this.pointArrayMap.indexOf(this.options.pointValKey||this.pointValKey||"y")),t=0;t<r-n;t++)if(a=s[t]&&o>-1?s[t][o]:s[t],isNumber(a)&&e[t+n]>=this.xAxis.min&&0!==a){this.compareValue=a;break}},addEvent(LineSeries,"afterGetExtremes",function(i){var t=i.dataExtremes;if(this.modifyValue&&t){var e=[this.modifyValue(t.dataMin),this.modifyValue(t.dataMax)];t.dataMin=arrayMin(e),t.dataMax=arrayMax(e)}}),Axis.prototype.setCompare=function(i,t){this.isXAxis||(this.series.forEach(function(t){t.setCompare(i)}),pick(t,!0)&&this.chart.redraw())},Point.prototype.tooltipFormatter=function(i){var t=this.series.chart.numberFormatter;return i=i.replace("{point.change}",(this.change>0?"+":"")+t(this.change,pick(this.series.tooltipOptions.changeDecimals,2))),pointTooltipFormatter.apply(this,[i])},addEvent(LineSeries,"render",function(){var i,t=this.chart;if((!t.is3d||!t.is3d())&&!t.polar&&this.xAxis&&!this.xAxis.isRadial){if(i=this.yAxis.len,this.xAxis.axisLine){var e=t.plotTop+t.plotHeight-this.yAxis.pos-this.yAxis.len,s=Math.floor(this.xAxis.axisLine.strokeWidth()/2);e>=0&&(i-=Math.max(s-e,0))}this.clipBox||t.hasRendered?t[this.sharedClipKey]&&(t[this.sharedClipKey].animate({width:this.xAxis.len,height:i}),t[this.sharedClipKey+"m"]&&t[this.sharedClipKey+"m"].animate({width:this.xAxis.len})):(this.clipBox=merge(t.clipBox),this.clipBox.width=this.xAxis.len,this.clipBox.height=i)}}),addEvent(Chart,"update",function(i){var t=i.options;"scrollbar"in t&&this.navigator&&(merge(!0,this.options.scrollbar,t.scrollbar),this.navigator.update({},!1),delete t.scrollbar)});