"use strict";import Axis from"../Axis/Axis.js";import Axis3D from"../Axis/Axis3D.js";import Chart from"./Chart.js";import Fx from"../Animation/Fx.js";import H from"../Globals.js";import Math3D from"../../Extensions/Math3D.js";var perspective=Math3D.perspective,shapeArea3D=Math3D.shapeArea3D;import O from"../Options.js";var genericDefaultOptions=O.defaultOptions;import U from"../Utilities.js";var Chart3D,addEvent=U.addEvent,isArray=U.isArray,merge=U.merge,pick=U.pick,wrap=U.wrap;import ZAxis from"../Axis/ZAxis.js";!function(t){var e=function(){function t(t){this.frame3d=void 0,this.chart=t}return t.prototype.get3dFrame=function(){var t=this.chart,e=t.options.chart.options3d,i=e.frame,r=t.plotLeft,o=t.plotLeft+t.plotWidth,s=t.plotTop,l=t.plotTop+t.plotHeight,a=e.depth,x=function(e){var i=shapeArea3D(e,t);return i>.5?1:i<-.5?-1:0},h=x([{x:r,y:l,z:a},{x:o,y:l,z:a},{x:o,y:l,z:0},{x:r,y:l,z:0}]),n=x([{x:r,y:s,z:0},{x:o,y:s,z:0},{x:o,y:s,z:a},{x:r,y:s,z:a}]),y=x([{x:r,y:s,z:0},{x:r,y:s,z:a},{x:r,y:l,z:a},{x:r,y:l,z:0}]),c=x([{x:o,y:s,z:a},{x:o,y:s,z:0},{x:o,y:l,z:0},{x:o,y:l,z:a}]),z=x([{x:r,y:l,z:0},{x:o,y:l,z:0},{x:o,y:s,z:0},{x:r,y:s,z:0}]),f=x([{x:r,y:s,z:a},{x:o,y:s,z:a},{x:o,y:l,z:a},{x:r,y:l,z:a}]),b=!1,p=!1,d=!1,v=!1;[].concat(t.xAxis,t.yAxis,t.zAxis).forEach(function(t){t&&(t.horiz?t.opposite?p=!0:b=!0:t.opposite?v=!0:d=!0)});var g=function(t,e,i){for(var r=["size","color","visible"],o={},s=0;s<r.length;s++)for(var l=r[s],a=0;a<t.length;a++)if("object"==typeof t[a]){var x=t[a][l];if(null!=x){o[l]=x;break}}var h=i;return!0===o.visible||!1===o.visible?h=o.visible:"auto"===o.visible&&(h=e>0),{size:pick(o.size,1),color:pick(o.color,"none"),frontFacing:e>0,visible:h}},m={axes:{},bottom:g([i.bottom,i.top,i],h,b),top:g([i.top,i.bottom,i],n,p),left:g([i.left,i.right,i.side,i],y,d),right:g([i.right,i.left,i.side,i],c,v),back:g([i.back,i.front,i],f,!0),front:g([i.front,i.back,i],z,!1)};if("auto"===e.axisLabelPosition){var u=function(t,e){return t.visible!==e.visible||t.visible&&e.visible&&t.frontFacing!==e.frontFacing},H=[];u(m.left,m.front)&&H.push({y:(s+l)/2,x:r,z:0,xDir:{x:1,y:0,z:0}}),u(m.left,m.back)&&H.push({y:(s+l)/2,x:r,z:a,xDir:{x:0,y:0,z:-1}}),u(m.right,m.front)&&H.push({y:(s+l)/2,x:o,z:0,xDir:{x:0,y:0,z:1}}),u(m.right,m.back)&&H.push({y:(s+l)/2,x:o,z:a,xDir:{x:-1,y:0,z:0}});var D=[];u(m.bottom,m.front)&&D.push({x:(r+o)/2,y:l,z:0,xDir:{x:1,y:0,z:0}}),u(m.bottom,m.back)&&D.push({x:(r+o)/2,y:l,z:a,xDir:{x:-1,y:0,z:0}});var k=[];u(m.top,m.front)&&k.push({x:(r+o)/2,y:s,z:0,xDir:{x:1,y:0,z:0}}),u(m.top,m.back)&&k.push({x:(r+o)/2,y:s,z:a,xDir:{x:-1,y:0,z:0}});var A=[];u(m.bottom,m.left)&&A.push({z:(0+a)/2,y:l,x:r,xDir:{x:0,y:0,z:-1}}),u(m.bottom,m.right)&&A.push({z:(0+a)/2,y:l,x:o,xDir:{x:0,y:0,z:1}});var E=[];u(m.top,m.left)&&E.push({z:(0+a)/2,y:s,x:r,xDir:{x:0,y:0,z:-1}}),u(m.top,m.right)&&E.push({z:(0+a)/2,y:s,x:o,xDir:{x:0,y:0,z:1}});var M=function(e,i,r){if(0===e.length)return null;if(1===e.length)return e[0];for(var o=0,s=perspective(e,t,!1),l=1;l<s.length;l++)r*s[l][i]>r*s[o][i]?o=l:r*s[l][i]==r*s[o][i]&&s[l].z<s[o].z&&(o=l);return e[o]};m.axes={y:{left:M(H,"x",-1),right:M(H,"x",1)},x:{top:M(k,"y",-1),bottom:M(D,"y",1)},z:{top:M(E,"y",-1),bottom:M(A,"y",1)}}}else m.axes={y:{left:{x:r,z:0,xDir:{x:1,y:0,z:0}},right:{x:o,z:0,xDir:{x:0,y:0,z:1}}},x:{top:{y:s,z:0,xDir:{x:1,y:0,z:0}},bottom:{y:l,z:0,xDir:{x:1,y:0,z:0}}},z:{top:{x:d?o:r,y:s,xDir:d?{x:0,y:0,z:1}:{x:0,y:0,z:-1}},bottom:{x:d?o:r,y:l,xDir:d?{x:0,y:0,z:1}:{x:0,y:0,z:-1}}}};return m},t.prototype.getScale=function(t){var e,i=this.chart,r=i.plotLeft,o=i.plotWidth+r,s=i.plotTop,l=i.plotHeight+s,a=r+i.plotWidth/2,x=s+i.plotHeight/2,h={minX:Number.MAX_VALUE,maxX:-Number.MAX_VALUE,minY:Number.MAX_VALUE,maxY:-Number.MAX_VALUE},n=1;return e=[{x:r,y:s,z:0},{x:r,y:s,z:t}],[0,1].forEach(function(t){e.push({x:o,y:e[t].y,z:e[t].z})}),[0,1,2,3].forEach(function(t){e.push({x:e[t].x,y:l,z:e[t].z})}),(e=perspective(e,i,!1)).forEach(function(t){h.minX=Math.min(h.minX,t.x),h.maxX=Math.max(h.maxX,t.x),h.minY=Math.min(h.minY,t.y),h.maxY=Math.max(h.maxY,t.y)}),r>h.minX&&(n=Math.min(n,1-Math.abs((r+a)/(h.minX+a))%1)),o<h.maxX&&(n=Math.min(n,(o-a)/(h.maxX-a))),s>h.minY&&(n=h.minY<0?Math.min(n,(s+x)/(-h.minY+s+x)):Math.min(n,1-(s+x)/(h.minY+x)%1)),l<h.maxY&&(n=Math.min(n,Math.abs((l-x)/(h.maxY-x)))),n},t}();function i(t){this.is3d()&&"scatter"===t.options.type&&(t.options.type="scatter3d")}function r(){if(this.chart3d&&this.is3d()){var t=this.renderer,e=this.options.chart.options3d,i=this.chart3d.get3dFrame(),r=this.plotLeft,o=this.plotLeft+this.plotWidth,s=this.plotTop,l=this.plotTop+this.plotHeight,a=e.depth,x=r-(i.left.visible?i.left.size:0),h=o+(i.right.visible?i.right.size:0),n=s-(i.top.visible?i.top.size:0),y=l+(i.bottom.visible?i.bottom.size:0),c=0-(i.front.visible?i.front.size:0),z=a+(i.back.visible?i.back.size:0),f=this.hasRendered?"animate":"attr";this.chart3d.frame3d=i,this.frameShapes||(this.frameShapes={bottom:t.polyhedron().add(),top:t.polyhedron().add(),left:t.polyhedron().add(),right:t.polyhedron().add(),back:t.polyhedron().add(),front:t.polyhedron().add()}),this.frameShapes.bottom[f]({class:"highcharts-3d-frame highcharts-3d-frame-bottom",zIndex:i.bottom.frontFacing?-1e3:1e3,faces:[{fill:H.color(i.bottom.color).brighten(.1).get(),vertexes:[{x:x,y:y,z:c},{x:h,y:y,z:c},{x:h,y:y,z:z},{x:x,y:y,z:z}],enabled:i.bottom.visible},{fill:H.color(i.bottom.color).brighten(.1).get(),vertexes:[{x:r,y:l,z:a},{x:o,y:l,z:a},{x:o,y:l,z:0},{x:r,y:l,z:0}],enabled:i.bottom.visible},{fill:H.color(i.bottom.color).brighten(-.1).get(),vertexes:[{x:x,y:y,z:c},{x:x,y:y,z:z},{x:r,y:l,z:a},{x:r,y:l,z:0}],enabled:i.bottom.visible&&!i.left.visible},{fill:H.color(i.bottom.color).brighten(-.1).get(),vertexes:[{x:h,y:y,z:z},{x:h,y:y,z:c},{x:o,y:l,z:0},{x:o,y:l,z:a}],enabled:i.bottom.visible&&!i.right.visible},{fill:H.color(i.bottom.color).get(),vertexes:[{x:h,y:y,z:c},{x:x,y:y,z:c},{x:r,y:l,z:0},{x:o,y:l,z:0}],enabled:i.bottom.visible&&!i.front.visible},{fill:H.color(i.bottom.color).get(),vertexes:[{x:x,y:y,z:z},{x:h,y:y,z:z},{x:o,y:l,z:a},{x:r,y:l,z:a}],enabled:i.bottom.visible&&!i.back.visible}]}),this.frameShapes.top[f]({class:"highcharts-3d-frame highcharts-3d-frame-top",zIndex:i.top.frontFacing?-1e3:1e3,faces:[{fill:H.color(i.top.color).brighten(.1).get(),vertexes:[{x:x,y:n,z:z},{x:h,y:n,z:z},{x:h,y:n,z:c},{x:x,y:n,z:c}],enabled:i.top.visible},{fill:H.color(i.top.color).brighten(.1).get(),vertexes:[{x:r,y:s,z:0},{x:o,y:s,z:0},{x:o,y:s,z:a},{x:r,y:s,z:a}],enabled:i.top.visible},{fill:H.color(i.top.color).brighten(-.1).get(),vertexes:[{x:x,y:n,z:z},{x:x,y:n,z:c},{x:r,y:s,z:0},{x:r,y:s,z:a}],enabled:i.top.visible&&!i.left.visible},{fill:H.color(i.top.color).brighten(-.1).get(),vertexes:[{x:h,y:n,z:c},{x:h,y:n,z:z},{x:o,y:s,z:a},{x:o,y:s,z:0}],enabled:i.top.visible&&!i.right.visible},{fill:H.color(i.top.color).get(),vertexes:[{x:x,y:n,z:c},{x:h,y:n,z:c},{x:o,y:s,z:0},{x:r,y:s,z:0}],enabled:i.top.visible&&!i.front.visible},{fill:H.color(i.top.color).get(),vertexes:[{x:h,y:n,z:z},{x:x,y:n,z:z},{x:r,y:s,z:a},{x:o,y:s,z:a}],enabled:i.top.visible&&!i.back.visible}]}),this.frameShapes.left[f]({class:"highcharts-3d-frame highcharts-3d-frame-left",zIndex:i.left.frontFacing?-1e3:1e3,faces:[{fill:H.color(i.left.color).brighten(.1).get(),vertexes:[{x:x,y:y,z:c},{x:r,y:l,z:0},{x:r,y:l,z:a},{x:x,y:y,z:z}],enabled:i.left.visible&&!i.bottom.visible},{fill:H.color(i.left.color).brighten(.1).get(),vertexes:[{x:x,y:n,z:z},{x:r,y:s,z:a},{x:r,y:s,z:0},{x:x,y:n,z:c}],enabled:i.left.visible&&!i.top.visible},{fill:H.color(i.left.color).brighten(-.1).get(),vertexes:[{x:x,y:y,z:z},{x:x,y:n,z:z},{x:x,y:n,z:c},{x:x,y:y,z:c}],enabled:i.left.visible},{fill:H.color(i.left.color).brighten(-.1).get(),vertexes:[{x:r,y:s,z:a},{x:r,y:l,z:a},{x:r,y:l,z:0},{x:r,y:s,z:0}],enabled:i.left.visible},{fill:H.color(i.left.color).get(),vertexes:[{x:x,y:y,z:c},{x:x,y:n,z:c},{x:r,y:s,z:0},{x:r,y:l,z:0}],enabled:i.left.visible&&!i.front.visible},{fill:H.color(i.left.color).get(),vertexes:[{x:x,y:n,z:z},{x:x,y:y,z:z},{x:r,y:l,z:a},{x:r,y:s,z:a}],enabled:i.left.visible&&!i.back.visible}]}),this.frameShapes.right[f]({class:"highcharts-3d-frame highcharts-3d-frame-right",zIndex:i.right.frontFacing?-1e3:1e3,faces:[{fill:H.color(i.right.color).brighten(.1).get(),vertexes:[{x:h,y:y,z:z},{x:o,y:l,z:a},{x:o,y:l,z:0},{x:h,y:y,z:c}],enabled:i.right.visible&&!i.bottom.visible},{fill:H.color(i.right.color).brighten(.1).get(),vertexes:[{x:h,y:n,z:c},{x:o,y:s,z:0},{x:o,y:s,z:a},{x:h,y:n,z:z}],enabled:i.right.visible&&!i.top.visible},{fill:H.color(i.right.color).brighten(-.1).get(),vertexes:[{x:o,y:s,z:0},{x:o,y:l,z:0},{x:o,y:l,z:a},{x:o,y:s,z:a}],enabled:i.right.visible},{fill:H.color(i.right.color).brighten(-.1).get(),vertexes:[{x:h,y:y,z:c},{x:h,y:n,z:c},{x:h,y:n,z:z},{x:h,y:y,z:z}],enabled:i.right.visible},{fill:H.color(i.right.color).get(),vertexes:[{x:h,y:n,z:c},{x:h,y:y,z:c},{x:o,y:l,z:0},{x:o,y:s,z:0}],enabled:i.right.visible&&!i.front.visible},{fill:H.color(i.right.color).get(),vertexes:[{x:h,y:y,z:z},{x:h,y:n,z:z},{x:o,y:s,z:a},{x:o,y:l,z:a}],enabled:i.right.visible&&!i.back.visible}]}),this.frameShapes.back[f]({class:"highcharts-3d-frame highcharts-3d-frame-back",zIndex:i.back.frontFacing?-1e3:1e3,faces:[{fill:H.color(i.back.color).brighten(.1).get(),vertexes:[{x:h,y:y,z:z},{x:x,y:y,z:z},{x:r,y:l,z:a},{x:o,y:l,z:a}],enabled:i.back.visible&&!i.bottom.visible},{fill:H.color(i.back.color).brighten(.1).get(),vertexes:[{x:x,y:n,z:z},{x:h,y:n,z:z},{x:o,y:s,z:a},{x:r,y:s,z:a}],enabled:i.back.visible&&!i.top.visible},{fill:H.color(i.back.color).brighten(-.1).get(),vertexes:[{x:x,y:y,z:z},{x:x,y:n,z:z},{x:r,y:s,z:a},{x:r,y:l,z:a}],enabled:i.back.visible&&!i.left.visible},{fill:H.color(i.back.color).brighten(-.1).get(),vertexes:[{x:h,y:n,z:z},{x:h,y:y,z:z},{x:o,y:l,z:a},{x:o,y:s,z:a}],enabled:i.back.visible&&!i.right.visible},{fill:H.color(i.back.color).get(),vertexes:[{x:r,y:s,z:a},{x:o,y:s,z:a},{x:o,y:l,z:a},{x:r,y:l,z:a}],enabled:i.back.visible},{fill:H.color(i.back.color).get(),vertexes:[{x:x,y:y,z:z},{x:h,y:y,z:z},{x:h,y:n,z:z},{x:x,y:n,z:z}],enabled:i.back.visible}]}),this.frameShapes.front[f]({class:"highcharts-3d-frame highcharts-3d-frame-front",zIndex:i.front.frontFacing?-1e3:1e3,faces:[{fill:H.color(i.front.color).brighten(.1).get(),vertexes:[{x:x,y:y,z:c},{x:h,y:y,z:c},{x:o,y:l,z:0},{x:r,y:l,z:0}],enabled:i.front.visible&&!i.bottom.visible},{fill:H.color(i.front.color).brighten(.1).get(),vertexes:[{x:h,y:n,z:c},{x:x,y:n,z:c},{x:r,y:s,z:0},{x:o,y:s,z:0}],enabled:i.front.visible&&!i.top.visible},{fill:H.color(i.front.color).brighten(-.1).get(),vertexes:[{x:x,y:n,z:c},{x:x,y:y,z:c},{x:r,y:l,z:0},{x:r,y:s,z:0}],enabled:i.front.visible&&!i.left.visible},{fill:H.color(i.front.color).brighten(-.1).get(),vertexes:[{x:h,y:y,z:c},{x:h,y:n,z:c},{x:o,y:s,z:0},{x:o,y:l,z:0}],enabled:i.front.visible&&!i.right.visible},{fill:H.color(i.front.color).get(),vertexes:[{x:o,y:s,z:0},{x:r,y:s,z:0},{x:r,y:l,z:0},{x:o,y:l,z:0}],enabled:i.front.visible},{fill:H.color(i.front.color).get(),vertexes:[{x:h,y:y,z:c},{x:x,y:y,z:c},{x:x,y:n,z:c},{x:h,y:n,z:c}],enabled:i.front.visible}]})}}function o(){this.styledMode&&(this.renderer.definition({tagName:"style",textContent:".highcharts-3d-top{filter: url(#highcharts-brighter)}\n.highcharts-3d-side{filter: url(#highcharts-darker)}\n"}),[{name:"darker",slope:.6},{name:"brighter",slope:1.4}].forEach(function(t){this.renderer.definition({tagName:"filter",id:"highcharts-"+t.name,children:[{tagName:"feComponentTransfer",children:[{tagName:"feFuncR",type:"linear",slope:t.slope},{tagName:"feFuncG",type:"linear",slope:t.slope},{tagName:"feFuncB",type:"linear",slope:t.slope}]}]})},this))}function s(){var t=this.options;this.is3d()&&(t.series||[]).forEach(function(e){"scatter"===(e.type||t.chart.type||t.chart.defaultSeriesType)&&(e.type="scatter3d")})}function l(){var t=this.options.chart.options3d;if(this.chart3d&&this.is3d()){t&&(t.alpha=t.alpha%360+(t.alpha>=0?0:360),t.beta=t.beta%360+(t.beta>=0?0:360));var e=this.inverted,i=this.clipBox,r=this.margin,o=e?"x":"y",s=e?"height":"width",l=e?"width":"height";i[e?"y":"x"]=-(r[3]||0),i[o]=-(r[0]||0),i[s]=this.chartWidth+(r[3]||0)+(r[1]||0),i[l]=this.chartHeight+(r[0]||0)+(r[2]||0),this.scale3d=1,!0===t.fitToPlot&&(this.scale3d=this.chart3d.getScale(t.depth)),this.chart3d.frame3d=this.chart3d.get3dFrame()}}function a(){this.is3d()&&(this.isDirtyBox=!0)}function x(){this.chart3d&&this.is3d()&&(this.chart3d.frame3d=this.chart3d.get3dFrame())}function h(){this.chart3d||(this.chart3d=new e(this))}function n(t){return this.is3d()||t.apply(this,[].slice.call(arguments,1))}function y(t){var e,i=this.series.length;if(this.is3d())for(;i--;)(e=this.series[i]).translate(),e.render();else t.call(this)}function c(t){t.apply(this,[].slice.call(arguments,1)),this.is3d()&&(this.container.className+=" highcharts-3d-chart")}t.Composition=e,t.defaultOptions={chart:{options3d:{enabled:!1,alpha:0,beta:0,depth:100,fitToPlot:!0,viewDistance:25,axisLabelPosition:null,frame:{visible:"default",size:1,bottom:{},top:{},left:{},right:{},back:{},front:{}}}}},t.compose=function(e,z){var f=e.prototype,b=z.prototype;f.is3d=function(){return this.options.chart.options3d&&this.options.chart.options3d.enabled},f.propsRequireDirtyBox.push("chart.options3d"),f.propsRequireUpdateSeries.push("chart.options3d"),b.matrixSetter=function(){var t;if(this.pos<1&&(isArray(this.start)||isArray(this.end))){var e=this.start||[1,0,0,1,0,0],i=this.end||[1,0,0,1,0,0];t=[];for(var r=0;r<6;r++)t.push(this.pos*i[r]+(1-this.pos)*e[r])}else t=this.end;this.elem.attr(this.prop,t,null,!0)},merge(!0,genericDefaultOptions,t.defaultOptions),addEvent(e,"init",h),addEvent(e,"addSeries",i),addEvent(e,"afterDrawChartBox",r),addEvent(e,"afterGetContainer",o),addEvent(e,"afterInit",s),addEvent(e,"afterSetChartSize",l),addEvent(e,"beforeRedraw",a),addEvent(e,"beforeRender",x),wrap(H.Chart.prototype,"isInsidePlot",n),wrap(e,"renderSeries",y),wrap(e,"setClassName",c)}}(Chart3D||(Chart3D={})),Chart3D.compose(Chart,Fx),ZAxis.ZChartComposition.compose(Chart),Axis3D.compose(Axis);export default Chart3D;