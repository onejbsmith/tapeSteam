import H from"../../Globals.js";import SVGElement from"../SVG/SVGElement.js";import U from"../../Utilities.js";var css=U.css,defined=U.defined,extend=U.extend,pick=U.pick,pInt=U.pInt,HTMLElement=SVGElement,isFirefox=H.isFirefox;extend(HTMLElement.prototype,{htmlCss:function(t){var e,i="SPAN"===this.element.tagName&&t&&"width"in t,s=pick(i&&t.width,void 0);return i&&(delete t.width,this.textWidth=s,e=!0),t&&"ellipsis"===t.textOverflow&&(t.whiteSpace="nowrap",t.overflow="hidden"),this.styles=extend(this.styles,t),css(this.element,t),e&&this.htmlUpdateTransform(),this},htmlGetBBox:function(){var t=this.element;return{x:t.offsetLeft,y:t.offsetTop,width:t.offsetWidth,height:t.offsetHeight}},htmlUpdateTransform:function(){if(this.added){var t=this.renderer,e=this.element,i=this.translateX||0,s=this.translateY||0,n=this.x||0,h=this.y||0,o=this.textAlign||"left",r={left:0,center:.5,right:1}[o],d=this.styles,l=d&&d.whiteSpace;if(css(e,{marginLeft:i,marginTop:s}),!t.styledMode&&this.shadows&&this.shadows.forEach(function(t){css(t,{marginLeft:i+1,marginTop:s+1})}),this.inverted&&[].forEach.call(e.childNodes,function(i){t.invertChild(i,e)}),"SPAN"===e.tagName){var a,f=this.rotation,x=this.textWidth&&pInt(this.textWidth),p=[f,o,e.innerHTML,this.textWidth,this.textAlign].join(",");x!==this.oldTextWidth&&(x>this.oldTextWidth||(this.textPxLength||(css(e,{width:"",whiteSpace:l||"nowrap"}),e.offsetWidth))>x)&&(/[ \-]/.test(e.textContent||e.innerText)||"ellipsis"===e.style.textOverflow)?(css(e,{width:x+"px",display:"block",whiteSpace:l||"normal"}),this.oldTextWidth=x,this.hasBoxWidthChanged=!0):this.hasBoxWidthChanged=!1,p!==this.cTT&&(a=t.fontMetrics(e.style.fontSize,e).b,!defined(f)||f===(this.oldRotation||0)&&o===this.oldAlign||this.setSpanRotation(f,r,a),this.getSpanCorrection(!defined(f)&&this.textPxLength||e.offsetWidth,a,r,f,o)),css(e,{left:n+(this.xCorr||0)+"px",top:h+(this.yCorr||0)+"px"}),this.cTT=p,this.oldRotation=f,this.oldAlign=o}}else this.alignOnAdd=!0},setSpanRotation:function(t,e,i){var s={},n=this.renderer.getTransformKey();s[n]=s.transform="rotate("+t+"deg)",s[n+(isFirefox?"Origin":"-origin")]=s.transformOrigin=100*e+"% "+i+"px",css(this.element,s)},getSpanCorrection:function(t,e,i){this.xCorr=-t*i,this.yCorr=-e}});export default HTMLElement;