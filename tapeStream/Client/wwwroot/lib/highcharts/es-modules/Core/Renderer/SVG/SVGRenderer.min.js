import Color from"../../Color/Color.js";import H from"../../Globals.js";import SVGElement from"./SVGElement.js";import SVGLabel from"./SVGLabel.js";import U from"../../Utilities.js";var addEvent=U.addEvent,attr=U.attr,createElement=U.createElement,css=U.css,defined=U.defined,destroyObjectProperties=U.destroyObjectProperties,extend=U.extend,isArray=U.isArray,isNumber=U.isNumber,isObject=U.isObject,isString=U.isString,merge=U.merge,objectEach=U.objectEach,pick=U.pick,pInt=U.pInt,splat=U.splat,uniqueKey=U.uniqueKey,charts=H.charts,deg2rad=H.deg2rad,doc=H.doc,isFirefox=H.isFirefox,isMS=H.isMS,isWebKit=H.isWebKit,noop=H.noop,svg=H.svg,SVG_NS=H.SVG_NS,symbolSizes=H.symbolSizes,win=H.win,SVGRenderer=function(){function t(t,e,i,r,n,s,o){this.alignedObjects=void 0,this.box=void 0,this.boxWrapper=void 0,this.cache=void 0,this.cacheKeys=void 0,this.chartIndex=void 0,this.defs=void 0,this.globalAnimation=void 0,this.gradients=void 0,this.height=void 0,this.imgCount=void 0,this.isSVG=void 0,this.style=void 0,this.url=void 0,this.width=void 0,this.init(t,e,i,r,n,s,o)}return t.prototype.init=function(t,e,i,r,n,s,o){var a,h,l,c;a=this.createElement("svg").attr({version:"1.1",class:"highcharts-root"}),o||a.css(this.getStyle(r)),h=a.element,t.appendChild(h),attr(t,"dir","ltr"),-1===t.innerHTML.indexOf("xmlns")&&attr(h,"xmlns",this.SVG_NS),this.isSVG=!0,this.box=h,this.boxWrapper=a,this.alignedObjects=[],this.url=(isFirefox||isWebKit)&&doc.getElementsByTagName("base").length?win.location.href.split("#")[0].replace(/<[^>]*>/g,"").replace(/([\('\)])/g,"\\$1").replace(/ /g,"%20"):"",this.createElement("desc").add().element.appendChild(doc.createTextNode("Created with Highcharts 8.2.2")),this.defs=this.createElement("defs").add(),this.allowHTML=s,this.forExport=n,this.styledMode=o,this.gradients={},this.cache={},this.cacheKeys=[],this.imgCount=0,this.setSize(e,i,!1),isFirefox&&t.getBoundingClientRect&&((l=function(){css(t,{left:0,top:0}),c=t.getBoundingClientRect(),css(t,{left:Math.ceil(c.left)-c.left+"px",top:Math.ceil(c.top)-c.top+"px"})})(),this.unSubPixelFix=addEvent(win,"resize",l))},t.prototype.definition=function(t){var e=this;return function t(i,r){var n;return splat(i).forEach(function(i){var s=e.createElement(i.tagName),o={};objectEach(i,function(t,e){"tagName"!==e&&"children"!==e&&"textContent"!==e&&(o[e]=t)}),s.attr(o),s.add(r||e.defs),i.textContent&&s.element.appendChild(doc.createTextNode(i.textContent)),t(i.children||[],s),n=s}),n}(t)},t.prototype.getStyle=function(t){return this.style=extend({fontFamily:'"Lucida Grande", "Lucida Sans Unicode", Arial, Helvetica, sans-serif',fontSize:"12px"},t),this.style},t.prototype.setStyle=function(t){this.boxWrapper.css(this.getStyle(t))},t.prototype.isHidden=function(){return!this.boxWrapper.getBBox().width},t.prototype.destroy=function(){var t=this.defs;return this.box=null,this.boxWrapper=this.boxWrapper.destroy(),destroyObjectProperties(this.gradients||{}),this.gradients=null,t&&(this.defs=t.destroy()),this.unSubPixelFix&&this.unSubPixelFix(),this.alignedObjects=null,null},t.prototype.createElement=function(t){var e=new this.Element;return e.init(this,t),e},t.prototype.getRadialAttr=function(t,e){return{cx:t[0]-t[2]/2+e.cx*t[2],cy:t[1]-t[2]/2+e.cy*t[2],r:e.r*t[2]}},t.prototype.truncate=function(t,e,i,r,n,s,o){var a,h,l,c=this,d=t.rotation,p=r?1:0,u=(i||r).length,g=u,f=[],m=function(t){e.firstChild&&e.removeChild(e.firstChild),t&&e.appendChild(doc.createTextNode(t))},y=function(s,a){var h=a||s;if(void 0===f[h])if(e.getSubStringLength)try{f[h]=n+e.getSubStringLength(0,r?h+1:h)}catch(t){}else c.getSpanWidth&&(m(o(i||r,s)),f[h]=n+c.getSpanWidth(t,e));return f[h]};if(t.rotation=0,h=y(e.textContent.length),l=n+h>s){for(;p<=u;)g=Math.ceil((p+u)/2),r&&(a=o(r,g)),h=y(g,a&&a.length-1),p===u?p=u+1:h>s?u=g-1:p=g;0===u?m(""):i&&u===i.length-1||m(a||o(i||r,g))}return r&&r.splice(0,g),t.actualWidth=h,t.rotation=d,l},t.prototype.buildText=function(t){var e,i,r,n=t.element,s=this,o=s.forExport,a=pick(t.textStr,"").toString(),h=-1!==a.indexOf("<"),l=n.childNodes,c=attr(n,"x"),d=t.styles,p=t.textWidth,u=d&&d.lineHeight,g=d&&d.textOutline,f=d&&"ellipsis"===d.textOverflow,m=d&&"nowrap"===d.whiteSpace,y=d&&d.fontSize,x=l.length,b=p&&!t.added&&this.box,S=function(t){var e;return s.styledMode||(e=/(px|em)$/.test(t&&t.style.fontSize)?t.style.fontSize:y||s.style.fontSize||12),u?pInt(u):s.fontMetrics(e,t.getAttribute("style")?t:n).h},v=function(t,e){return objectEach(s.escapes,function(i,r){e&&-1!==e.indexOf(i)||(t=t.toString().replace(new RegExp(i,"g"),r))}),t},w=function(t,e){var i,r;if(i=t.indexOf("<"),-1!==(i=(t=t.substring(i,t.indexOf(">")-i)).indexOf(e+"="))&&(i=i+e.length+1,'"'===(r=t.charAt(i))||"'"===r))return(t=t.substring(i+1)).substring(0,t.indexOf(r))},M=/<br.*?>/g;if((i=[a,f,m,u,g,y,p].join(","))!==t.textCache){for(t.textCache=i;x--;)n.removeChild(l[x]);h||g||f||p||-1!==a.indexOf(" ")&&(!m||M.test(a))?(b&&b.appendChild(n),(h?(s.styledMode?a.replace(/<(b|strong)>/g,'<span class="highcharts-strong">').replace(/<(i|em)>/g,'<span class="highcharts-emphasized">'):a.replace(/<(b|strong)>/g,'<span style="font-weight:bold">').replace(/<(i|em)>/g,'<span style="font-style:italic">')).replace(/<a/g,"<span").replace(/<\/(b|strong|i|em|a)>/g,"</span>").split(M):[a]).filter(function(t){return""!==t}).forEach(function(i,a){var h,l=0,d=0;i=i.replace(/^\s+|\s+$/g,"").replace(/<span/g,"|||<span").replace(/<\/span>/g,"</span>|||"),(h=i.split("|||")).forEach(function(i){if(""!==i||1===h.length){var u,g,x,b,M={},L=doc.createElementNS(s.SVG_NS,"tspan");if((g=w(i,"class"))&&attr(L,"class",g),(x=w(i,"style"))&&(x=x.replace(/(;| |^)color([ :])/,"$1fill$2"),attr(L,"style",x)),(b=w(i,"href"))&&!o&&-1===b.split(":")[0].toLowerCase().indexOf("javascript")&&(u=doc.createElementNS(s.SVG_NS,"a"),attr(u,"href",b),attr(L,"class","highcharts-anchor"),u.appendChild(L),s.styledMode||css(L,{cursor:"pointer"}))," "!==(i=v(i.replace(/<[a-zA-Z\/](.|\n)*?>/g,"")||" "))){if(L.appendChild(doc.createTextNode(i)),l?M.dx=0:a&&null!==c&&(M.x=c),attr(L,M),n.appendChild(u||L),!l&&r&&(!svg&&o&&css(L,{display:"block"}),attr(L,"dy",S(L))),p){var C=i.replace(/([^\^])-/g,"$1- ").split(" "),E=!m&&(h.length>1||a||C.length>1),A=0,N=S(L);if(f)e=s.truncate(t,L,i,void 0,0,Math.max(0,p-parseInt(y||12,10)),function(t,e){return t.substring(0,e)+"â€¦"});else if(E)for(;C.length;)C.length&&!m&&A>0&&(L=doc.createElementNS(SVG_NS,"tspan"),attr(L,{dy:N,x:c}),x&&attr(L,"style",x),L.appendChild(doc.createTextNode(C.join(" ").replace(/- /g,"-"))),n.appendChild(L)),s.truncate(t,L,null,C,0===A?d:0,p,function(t,e){return C.slice(0,e).join(" ").replace(/- /g,"-")}),d=t.actualWidth,A++}l++}}}),r=r||n.childNodes.length}),f&&e&&t.attr("title",v(t.textStr||"",["&lt;","&gt;"])),b&&b.removeChild(n),isString(g)&&t.applyTextOutline&&t.applyTextOutline(g)):n.appendChild(doc.createTextNode(v(a)))}},t.prototype.getContrast=function(t){return(t=Color.parse(t).rgba)[0]*=1,t[1]*=1.2,t[2]*=.5,t[0]+t[1]+t[2]>459?"#000000":"#FFFFFF"},t.prototype.button=function(t,e,i,r,n,s,o,a,h,l){var c,d,p,u,g=this.label(t,e,i,h,void 0,void 0,l,void 0,"button"),f=0,m=this.styledMode,y=(n=n?merge(n):n)&&n.style||{};(n&&n.style&&delete n.style,g.attr(merge({padding:8,r:2},n)),m)||(n=merge({fill:"#f7f7f7",stroke:"#cccccc","stroke-width":1,style:{color:"#333333",cursor:"pointer",fontWeight:"normal"}},{style:y},n),c=n.style,delete n.style,s=merge(n,{fill:"#e6e6e6"},s),d=s.style,delete s.style,o=merge(n,{fill:"#e6ebf5",style:{color:"#000000",fontWeight:"bold"}},o),p=o.style,delete o.style,a=merge(n,{style:{color:"#cccccc"}},a),u=a.style,delete a.style);return addEvent(g.element,isMS?"mouseover":"mouseenter",function(){3!==f&&g.setState(1)}),addEvent(g.element,isMS?"mouseout":"mouseleave",function(){3!==f&&g.setState(f)}),g.setState=function(t){1!==t&&(g.state=f=t),g.removeClass(/highcharts-button-(normal|hover|pressed|disabled)/).addClass("highcharts-button-"+["normal","hover","pressed","disabled"][t||0]),m||g.attr([n,s,o,a][t||0]).css([c,d,p,u][t||0])},m||g.attr(n).css(extend({cursor:"default"},c)),g.on("click",function(t){3!==f&&r.call(g,t)})},t.prototype.crispLine=function(t,e,i){void 0===i&&(i="round");var r=t[0],n=t[1];return r[1]===n[1]&&(r[1]=n[1]=Math[i](r[1])-e%2/2),r[2]===n[2]&&(r[2]=n[2]=Math[i](r[2])+e%2/2),t},t.prototype.path=function(t){var e=this.styledMode?{}:{fill:"none"};return isArray(t)?e.d=t:isObject(t)&&extend(e,t),this.createElement("path").attr(e)},t.prototype.circle=function(t,e,i){var r=isObject(t)?t:void 0===t?{}:{x:t,y:e,r:i},n=this.createElement("circle");return n.xSetter=n.ySetter=function(t,e,i){i.setAttribute("c"+e,t)},n.attr(r)},t.prototype.arc=function(t,e,i,r,n,s){var o,a;return isObject(t)?(e=(a=t).y,i=a.r,r=a.innerR,n=a.start,s=a.end,t=a.x):a={innerR:r,start:n,end:s},(o=this.symbol("arc",t,e,i,i,a)).r=i,o},t.prototype.rect=function(t,e,i,r,n,s){n=isObject(t)?t.r:n;var o=this.createElement("rect"),a=isObject(t)?t:void 0===t?{}:{x:t,y:e,width:Math.max(i,0),height:Math.max(r,0)};return this.styledMode||(void 0!==s&&(a.strokeWidth=s,a=o.crisp(a)),a.fill="none"),n&&(a.r=n),o.rSetter=function(t,e,i){o.r=t,attr(i,{rx:t,ry:t})},o.rGetter=function(){return o.r},o.attr(a)},t.prototype.setSize=function(t,e,i){var r=this.alignedObjects,n=r.length;for(this.width=t,this.height=e,this.boxWrapper.animate({width:t,height:e},{step:function(){this.attr({viewBox:"0 0 "+this.attr("width")+" "+this.attr("height")})},duration:pick(i,!0)?void 0:0});n--;)r[n].align()},t.prototype.g=function(t){var e=this.createElement("g");return t?e.attr({class:"highcharts-"+t}):e},t.prototype.image=function(t,e,i,r,n,s){var o,a,h={preserveAspectRatio:"none"},l=function(t,e){t.setAttributeNS?t.setAttributeNS("http://www.w3.org/1999/xlink","href",e):t.setAttribute("hc-svg-href",e)},c=function(e){l(o.element,t),s.call(o,e)};return arguments.length>1&&extend(h,{x:e,y:i,width:r,height:n}),o=this.createElement("image").attr(h),s?(l(o.element,"data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="),a=new win.Image,addEvent(a,"load",c),a.src=t,a.complete&&c({})):l(o.element,t),o},t.prototype.symbol=function(t,e,i,r,n,s){var o,a,h,l,c=this,d=/^url\((.*?)\)$/,p=d.test(t),u=!p&&(this.symbols[t]?t:"circle"),g=u&&this.symbols[u];return g?("number"==typeof e&&(a=g.call(this.symbols,Math.round(e||0),Math.round(i||0),r||0,n||0,s)),o=this.path(a),c.styledMode||o.attr("fill","none"),extend(o,{symbolName:u,x:e,y:i,width:r,height:n}),s&&extend(o,s)):p&&(h=t.match(d)[1],(o=this.image(h)).imgwidth=pick(symbolSizes[h]&&symbolSizes[h].width,s&&s.width),o.imgheight=pick(symbolSizes[h]&&symbolSizes[h].height,s&&s.height),l=function(){o.attr({width:o.width,height:o.height})},["width","height"].forEach(function(t){o[t+"Setter"]=function(t,e){var i={},r=this["img"+e],n="width"===e?"translateX":"translateY";this[e]=t,defined(r)&&(s&&"within"===s.backgroundSize&&this.width&&this.height&&(r=Math.round(r*Math.min(this.width/this.imgwidth,this.height/this.imgheight))),this.element&&this.element.setAttribute(e,r),this.alignByTranslate||(i[n]=((this[e]||0)-r)/2,this.attr(i)))}}),defined(e)&&o.attr({x:e,y:i}),o.isImg=!0,defined(o.imgwidth)&&defined(o.imgheight)?l():(o.attr({width:0,height:0}),createElement("img",{onload:function(){var t=charts[c.chartIndex];0===this.width&&(css(this,{position:"absolute",top:"-999em"}),doc.body.appendChild(this)),symbolSizes[h]={width:this.width,height:this.height},o.imgwidth=this.width,o.imgheight=this.height,o.element&&l(),this.parentNode&&this.parentNode.removeChild(this),c.imgCount--,c.imgCount||!t||t.hasLoaded||t.onload()},src:h}),this.imgCount++)),o},t.prototype.clipRect=function(t,e,i,r){var n,s=uniqueKey()+"-",o=this.createElement("clipPath").attr({id:s}).add(this.defs);return(n=this.rect(t,e,i,r,0).add(o)).id=s,n.clipPath=o,n.count=0,n},t.prototype.text=function(t,e,i,r){var n,s={};return!r||!this.allowHTML&&this.forExport?(s.x=Math.round(e||0),i&&(s.y=Math.round(i)),defined(t)&&(s.text=t),n=this.createElement("text").attr(s),r||(n.xSetter=function(t,e,i){var r,n,s=i.getElementsByTagName("tspan"),o=i.getAttribute(e);for(n=0;n<s.length;n++)(r=s[n]).getAttribute(e)===o&&r.setAttribute(e,t);i.setAttribute(e,t)}),n):this.html(t,e,i)},t.prototype.fontMetrics=function(t,e){var i;return t=!this.styledMode&&/px/.test(t)||!win.getComputedStyle?t||e&&e.style&&e.style.fontSize||this.style&&this.style.fontSize:e&&SVGElement.prototype.getStyle.call(e,"font-size"),{h:i=(t=/px/.test(t)?pInt(t):12)<24?t+3:Math.round(1.2*t),b:Math.round(.8*i),f:t}},t.prototype.rotCorr=function(t,e,i){var r=t;return e&&i&&(r=Math.max(r*Math.cos(e*deg2rad),4)),{x:-t/3*Math.sin(e*deg2rad),y:r}},t.prototype.pathToSegments=function(t){for(var e=[],i=[],r={A:8,C:7,H:2,L:3,M:3,Q:5,S:5,T:3,V:2},n=0;n<t.length;n++)isString(i[0])&&isNumber(t[n])&&i.length===r[i[0].toUpperCase()]&&t.splice(n,0,i[0].replace("M","L").replace("m","l")),"string"==typeof t[n]&&(i.length&&e.push(i.slice(0)),i.length=0),i.push(t[n]);return e.push(i.slice(0)),e},t.prototype.label=function(t,e,i,r,n,s,o,a,h){return new SVGLabel(this,t,e,i,r,n,s,o,a,h)},t}();SVGRenderer.prototype.Element=SVGElement,SVGRenderer.prototype.SVG_NS=SVG_NS,SVGRenderer.prototype.draw=noop,SVGRenderer.prototype.escapes={"&":"&amp;","<":"&lt;",">":"&gt;","'":"&#39;",'"':"&quot;"},SVGRenderer.prototype.symbols={circle:function(t,e,i,r){return this.arc(t+i/2,e+r/2,i/2,r/2,{start:.5*Math.PI,end:2.5*Math.PI,open:!1})},square:function(t,e,i,r){return[["M",t,e],["L",t+i,e],["L",t+i,e+r],["L",t,e+r],["Z"]]},triangle:function(t,e,i,r){return[["M",t+i/2,e],["L",t+i,e+r],["L",t,e+r],["Z"]]},"triangle-down":function(t,e,i,r){return[["M",t,e],["L",t+i,e],["L",t+i/2,e+r],["Z"]]},diamond:function(t,e,i,r){return[["M",t+i/2,e],["L",t+i,e+r/2],["L",t+i/2,e+r],["L",t,e+r/2],["Z"]]},arc:function(t,e,i,r,n){var s=[];if(n){var o=n.start||0,a=n.end||0,h=n.r||i,l=n.r||r||i,c=Math.abs(a-o-2*Math.PI)<.001,d=(a=a-.001,n.innerR),p=pick(n.open,c),u=Math.cos(o),g=Math.sin(o),f=Math.cos(a),m=Math.sin(a),y=pick(n.longArc,a-o-Math.PI<.001?0:1);s.push(["M",t+h*u,e+l*g],["A",h,l,0,y,pick(n.clockwise,1),t+h*f,e+l*m]),defined(d)&&s.push(p?["M",t+d*f,e+d*m]:["L",t+d*f,e+d*m],["A",d,d,0,y,defined(n.clockwise)?1-n.clockwise:0,t+d*u,e+d*g]),p||s.push(["Z"])}return s},callout:function(t,e,i,r,n){var s,o=Math.min(n&&n.r||0,i,r),a=o+6,h=n&&n.anchorX||0,l=n&&n.anchorY||0;return s=[["M",t+o,e],["L",t+i-o,e],["C",t+i,e,t+i,e,t+i,e+o],["L",t+i,e+r-o],["C",t+i,e+r,t+i,e+r,t+i-o,e+r],["L",t+o,e+r],["C",t,e+r,t,e+r,t,e+r-o],["L",t,e+o],["C",t,e,t,e,t+o,e]],h&&h>i?l>e+a&&l<e+r-a?s.splice(3,1,["L",t+i,l-6],["L",t+i+6,l],["L",t+i,l+6],["L",t+i,e+r-o]):s.splice(3,1,["L",t+i,r/2],["L",h,l],["L",t+i,r/2],["L",t+i,e+r-o]):h&&h<0?l>e+a&&l<e+r-a?s.splice(7,1,["L",t,l+6],["L",t-6,l],["L",t,l-6],["L",t,e+o]):s.splice(7,1,["L",t,r/2],["L",h,l],["L",t,r/2],["L",t,e+o]):l&&l>r&&h>t+a&&h<t+i-a?s.splice(5,1,["L",h+6,e+r],["L",h,e+r+6],["L",h-6,e+r],["L",t+o,e+r]):l&&l<0&&h>t+a&&h<t+i-a&&s.splice(1,1,["L",h-6,e],["L",h,e-6],["L",h+6,e],["L",i-o,e]),s}},H.SVGRenderer=SVGRenderer,H.Renderer=H.SVGRenderer;export default H.Renderer;