var __extends=this&&this.__extends||function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function o(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(o.prototype=i.prototype,new o)}}();import SVGElement from"./SVGElement.js";import U from"../../Utilities.js";var defined=U.defined,extend=U.extend,isNumber=U.isNumber,merge=U.merge,removeEvent=U.removeEvent,SVGLabel=function(t){function e(i,o,s,n,h,r,d,a,x,p){var l,c=t.call(this)||this;return c.init(i,"g"),c.textStr=o,c.x=s,c.y=n,c.anchorX=r,c.anchorY=d,c.baseline=x,c.className=p,"button"!==p&&c.addClass("highcharts-label"),p&&c.addClass("highcharts-"+p),c.text=i.text("",0,0,a).attr({zIndex:1}),"string"==typeof h&&(l=/^url\((.*?)\)$/.test(h),(c.renderer.symbols[h]||l)&&(c.symbolKey=h)),c.bBox=e.emptyBBox,c.padding=3,c.paddingLeft=0,c.baselineOffset=0,c.needsBox=i.styledMode||l,c.deferredAttr={},c.alignFactor=0,c}return __extends(e,t),e.prototype.alignSetter=function(t){var e={left:0,center:.5,right:1}[t];e!==this.alignFactor&&(this.alignFactor=e,this.bBox&&isNumber(this.xSetting)&&this.attr({x:this.xSetting}))},e.prototype.anchorXSetter=function(t,e){this.anchorX=t,this.boxAttr(e,Math.round(t)-this.getCrispAdjust()-this.xSetting)},e.prototype.anchorYSetter=function(t,e){this.anchorY=t,this.boxAttr(e,t-this.ySetting)},e.prototype.boxAttr=function(t,e){this.box?this.box.attr(t,e):this.deferredAttr[t]=e},e.prototype.css=function(t){if(t){var i,o={};t=merge(t),e.textProps.forEach(function(e){void 0!==t[e]&&(o[e]=t[e],delete t[e])}),this.text.css(o),i="fontSize"in o||"fontWeight"in o,("width"in o||i)&&(this.updateBoxSize(),i&&this.updateTextPadding())}return SVGElement.prototype.css.call(this,t)},e.prototype.destroy=function(){removeEvent(this.element,"mouseenter"),removeEvent(this.element,"mouseleave"),this.text&&this.text.destroy(),this.box&&(this.box=this.box.destroy()),SVGElement.prototype.destroy.call(this)},e.prototype.fillSetter=function(t,e){t&&(this.needsBox=!0),this.fill=t,this.boxAttr(e,t)},e.prototype.getBBox=function(){var t=this.bBox,e=this.padding;return{width:t.width+2*e,height:t.height+2*e,x:t.x-e,y:t.y-e}},e.prototype.getCrispAdjust=function(){return this.renderer.styledMode&&this.box?this.box.strokeWidth()%2/2:(this["stroke-width"]?parseInt(this["stroke-width"],10):0)%2/2},e.prototype.heightSetter=function(t){this.heightSetting=t},e.prototype.on=function(t,e){var i,o=this,s=o.text,n=s&&"SPAN"===s.element.tagName?s:void 0;return n&&(i=function(i){("mouseenter"===t||"mouseleave"===t)&&i.relatedTarget instanceof Element&&(o.element.contains(i.relatedTarget)||n.element.contains(i.relatedTarget))||e.call(o.element,i)},n.on(t,i)),SVGElement.prototype.on.call(o,t,i||e),o},e.prototype.onAdd=function(){var t=this.textStr;this.text.add(this),this.attr({text:defined(t)?t:"",x:this.x,y:this.y}),this.box&&defined(this.anchorX)&&this.attr({anchorX:this.anchorX,anchorY:this.anchorY})},e.prototype.paddingSetter=function(t){defined(t)&&t!==this.padding&&(this.padding=t,this.updateTextPadding())},e.prototype.paddingLeftSetter=function(t){defined(t)&&t!==this.paddingLeft&&(this.paddingLeft=t,this.updateTextPadding())},e.prototype.rSetter=function(t,e){this.boxAttr(e,t)},e.prototype.shadow=function(t){return t&&!this.renderer.styledMode&&(this.updateBoxSize(),this.box&&this.box.shadow(t)),this},e.prototype.strokeSetter=function(t,e){this.stroke=t,this.boxAttr(e,t)},e.prototype["stroke-widthSetter"]=function(t,e){t&&(this.needsBox=!0),this["stroke-width"]=t,this.boxAttr(e,t)},e.prototype["text-alignSetter"]=function(t){this.textAlign=t},e.prototype.textSetter=function(t){void 0!==t&&this.text.attr({text:t}),this.updateBoxSize(),this.updateTextPadding()},e.prototype.updateBoxSize=function(){var t,i=this.text.element.style,o={},s=this.padding,n=this.paddingLeft,h=isNumber(this.widthSetting)&&isNumber(this.heightSetting)&&!this.textAlign||!defined(this.text.textStr)?e.emptyBBox:this.text.getBBox();if(this.width=(this.widthSetting||h.width||0)+2*s+n,this.height=(this.heightSetting||h.height||0)+2*s,this.baselineOffset=s+Math.min(this.renderer.fontMetrics(i&&i.fontSize,this.text).b,h.height||1/0),this.needsBox){if(!this.box){var r=this.box=this.symbolKey?this.renderer.symbol(this.symbolKey):this.renderer.rect();r.addClass(("button"===this.className?"":"highcharts-label-box")+(this.className?" highcharts-"+this.className+"-box":"")),r.add(this),t=this.getCrispAdjust(),o.x=t,o.y=(this.baseline?-this.baselineOffset:0)+t}o.width=Math.round(this.width),o.height=Math.round(this.height),this.box.attr(extend(o,this.deferredAttr)),this.deferredAttr={}}this.bBox=h},e.prototype.updateTextPadding=function(){var t=this.text,e=this.baseline?0:this.baselineOffset,i=this.paddingLeft+this.padding;defined(this.widthSetting)&&this.bBox&&("center"===this.textAlign||"right"===this.textAlign)&&(i+={center:.5,right:1}[this.textAlign]*(this.widthSetting-this.bBox.width)),i===t.x&&e===t.y||(t.attr("x",i),t.hasBoxWidthChanged&&(this.bBox=t.getBBox(!0),this.updateBoxSize()),void 0!==e&&t.attr("y",e)),t.x=i,t.y=e},e.prototype.widthSetter=function(t){this.widthSetting=isNumber(t)?t:void 0},e.prototype.xSetter=function(t){this.x=t,this.alignFactor&&(t-=this.alignFactor*((this.widthSetting||this.bBox.width)+2*this.padding),this["forceAnimate:x"]=!0),this.xSetting=Math.round(t),this.attr("translateX",this.xSetting)},e.prototype.ySetter=function(t){this.ySetting=this.y=Math.round(t),this.attr("translateY",this.ySetting)},e.emptyBBox={width:0,height:0,x:0,y:0},e.textProps=["color","cursor","direction","fontFamily","fontSize","fontStyle","fontWeight","lineHeight","textAlign","textDecoration","textOutline","textOverflow","width"],e}(SVGElement);export default SVGLabel;