"use strict";import H from"../Globals.js";import U from"../Utilities.js";var clamp=U.clamp,correctFloat=U.correctFloat,defined=U.defined,destroyObjectProperties=U.destroyObjectProperties,extend=U.extend,fireEvent=U.fireEvent,isNumber=U.isNumber,merge=U.merge,objectEach=U.objectEach,pick=U.pick,deg2rad=H.deg2rad,Tick=function(){function t(t,e,i,a,s){this.isNew=!0,this.isNewLabel=!0,this.axis=t,this.pos=e,this.type=i||"",this.parameters=s||{},this.tickmarkOffset=this.parameters.tickmarkOffset,this.options=this.parameters.options,fireEvent(this,"init"),i||a||this.addLabel()}return t.prototype.addLabel=function(){var t,e,i,a,s,r=this,o=r.axis,l=o.options,h=o.chart,n=o.categories,d=o.logarithmic,c=o.names,p=r.pos,f=pick(r.options&&r.options.labels,l.labels),b=o.tickPositions,x=p===b[0],m=p===b[b.length-1],y=this.parameters.category||(n?pick(n[p],c[p],p):p),k=r.label,g=(!f.step||1===f.step)&&1===o.tickInterval,L=b.info;o.dateTime&&L&&(e=(i=h.time.resolveDTLFormat(l.dateTimeLabelFormats[!l.grid&&L.higherRanks[p]||L.unitName])).main),r.isFirst=x,r.isLast=m,r.formatCtx={axis:o,chart:h,isFirst:x,isLast:m,dateTimeLabelFormat:e,tickPositionInfo:L,value:d?correctFloat(d.lin2log(y)):y,pos:p},t=o.labelFormatter.call(r.formatCtx,this.formatCtx),(s=i&&i.list)&&(r.shortenLabel=function(){for(a=0;a<s.length;a++)if(k.attr({text:o.labelFormatter.call(extend(r.formatCtx,{dateTimeLabelFormat:s[a]}))}),k.getBBox().width<o.getSlotWidth(r)-2*pick(f.padding,5))return;k.attr({text:""})}),g&&o._addedPlotLB&&r.moveLabel(t,f),defined(k)||r.movedLabel?k&&k.textStr!==t&&!g&&(!k.textWidth||f.style&&f.style.width||k.styles.width||k.css({width:null}),k.attr({text:t}),k.textPxLength=k.getBBox().width):(r.label=k=r.createLabel({x:0,y:0},t,f),r.rotation=0)},t.prototype.createLabel=function(t,e,i){var a=this.axis,s=a.chart,r=defined(e)&&i.enabled?s.renderer.text(e,t.x,t.y,i.useHTML).add(a.labelGroup):null;return r&&(s.styledMode||r.css(merge(i.style)),r.textPxLength=r.getBBox().width),r},t.prototype.destroy=function(){destroyObjectProperties(this,this.axis)},t.prototype.getPosition=function(t,e,i,a){var s,r=this.axis,o=r.chart,l=a&&o.oldChartHeight||o.chartHeight;return(s={x:t?correctFloat(r.translate(e+i,null,null,a)+r.transB):r.left+r.offset+(r.opposite?(a&&o.oldChartWidth||o.chartWidth)-r.right-r.left:0),y:t?l-r.bottom+r.offset-(r.opposite?r.height:0):correctFloat(l-r.translate(e+i,null,null,a)-r.transB)}).y=clamp(s.y,-1e5,1e5),fireEvent(this,"afterGetPosition",{pos:s}),s},t.prototype.getLabelPosition=function(t,e,i,a,s,r,o,l){var h,n=this.axis,d=n.transA,c=n.isLinked&&n.linkedParent?n.linkedParent.reversed:n.reversed,p=n.staggerLines,f=n.tickRotCorr||{x:0,y:0},b=s.y,x=a||n.reserveSpaceDefault?0:-n.labelOffset*("center"===n.labelAlign?.5:1),m={};return defined(b)||(b=0===n.side?i.rotation?-8:-i.getBBox().height:2===n.side?f.y+8:Math.cos(i.rotation*deg2rad)*(f.y-i.getBBox(!1,0).height/2)),t=t+s.x+x+f.x-(r&&a?r*d*(c?-1:1):0),e=e+b-(r&&!a?r*d*(c?1:-1):0),p&&(h=o/(l||1)%p,n.opposite&&(h=p-h-1),e+=h*(n.labelOffset/p)),m.x=t,m.y=Math.round(e),fireEvent(this,"afterGetLabelPosition",{pos:m,tickmarkOffset:r,index:o}),m},t.prototype.getLabelSize=function(){return this.label?this.label.getBBox()[this.axis.horiz?"height":"width"]:0},t.prototype.getMarkPath=function(t,e,i,a,s,r){return r.crispLine([["M",t,e],["L",t+(s?0:-i),e+(s?i:0)]],a)},t.prototype.handleOverflow=function(t){var e,i,a=this.axis,s=a.options.labels,r=t.x,o=a.chart.chartWidth,l=a.chart.spacing,h=pick(a.labelLeft,Math.min(a.pos,l[3])),n=pick(a.labelRight,Math.max(a.isRadial?0:a.pos+a.len,o-l[1])),d=this.label,c=this.rotation,p={left:0,center:.5,right:1}[a.labelAlign||d.attr("align")],f=d.getBBox().width,b=a.getSlotWidth(this),x=b,m=p,y=1,k={};c||"justify"!==pick(s.overflow,"justify")?c<0&&r-p*f<h?i=Math.round(r/Math.cos(c*deg2rad)-h):c>0&&r+p*f>n&&(i=Math.round((o-r)/Math.cos(c*deg2rad))):(e=r+(1-p)*f,r-p*f<h?x=t.x+x*(1-p)-h:e>n&&(x=n-t.x+x*p,y=-1),(x=Math.min(b,x))<b&&"center"===a.labelAlign&&(t.x+=y*(b-x-m*(b-Math.min(f,x)))),(f>x||a.autoRotation&&(d.styles||{}).width)&&(i=x)),i&&(this.shortenLabel?this.shortenLabel():(k.width=Math.floor(i)+"px",(s.style||{}).textOverflow||(k.textOverflow="ellipsis"),d.css(k)))},t.prototype.moveLabel=function(t,e){var i,a,s,r=this,o=r.label,l=!1,h=r.axis,n=h.reversed;o&&o.textStr===t?(r.movedLabel=o,l=!0,delete r.label):objectEach(h.ticks,function(e){l||e.isNew||e===r||!e.label||e.label.textStr!==t||(r.movedLabel=e.label,l=!0,e.labelPos=r.movedLabel.xy,delete e.label)}),l||!r.labelPos&&!o||(i=r.labelPos||o.xy,a=h.horiz?n?0:h.width+h.left:i.x,s=h.horiz?i.y:n?h.width+h.left:0,r.movedLabel=r.createLabel({x:a,y:s},t,e),r.movedLabel&&r.movedLabel.attr({opacity:0}))},t.prototype.render=function(t,e,i){var a=this.axis,s=a.horiz,r=this.pos,o=pick(this.tickmarkOffset,a.tickmarkOffset),l=this.getPosition(s,r,o,e),h=l.x,n=l.y,d=s&&h===a.pos+a.len||!s&&n===a.pos?-1:1;i=pick(i,1),this.isActive=!0,this.renderGridLine(e,i,d),this.renderMark(l,i,d),this.renderLabel(l,e,i,t),this.isNew=!1,fireEvent(this,"afterRender")},t.prototype.renderGridLine=function(t,e,i){var a,s=this.axis,r=s.options,o=this.gridLine,l={},h=this.pos,n=this.type,d=pick(this.tickmarkOffset,s.tickmarkOffset),c=s.chart.renderer,p=n?n+"Grid":"grid",f=r[p+"LineWidth"],b=r[p+"LineColor"],x=r[p+"LineDashStyle"];o||(s.chart.styledMode||(l.stroke=b,l["stroke-width"]=f,x&&(l.dashstyle=x)),n||(l.zIndex=1),t&&(e=0),this.gridLine=o=c.path().attr(l).addClass("highcharts-"+(n?n+"-":"")+"grid-line").add(s.gridGroup)),o&&(a=s.getPlotLinePath({value:h+d,lineWidth:o.strokeWidth()*i,force:"pass",old:t}))&&o[t||this.isNew?"attr":"animate"]({d:a,opacity:e})},t.prototype.renderMark=function(t,e,i){var a=this.axis,s=a.options,r=a.chart.renderer,o=this.type,l=o?o+"Tick":"tick",h=a.tickSize(l),n=this.mark,d=!n,c=t.x,p=t.y,f=pick(s[l+"Width"],!o&&a.isXAxis?1:0),b=s[l+"Color"];h&&(a.opposite&&(h[0]=-h[0]),d&&(this.mark=n=r.path().addClass("highcharts-"+(o?o+"-":"")+"tick").add(a.axisGroup),a.chart.styledMode||n.attr({stroke:b,"stroke-width":f})),n[d?"attr":"animate"]({d:this.getMarkPath(c,p,h[0],n.strokeWidth()*i,a.horiz,r),opacity:e}))},t.prototype.renderLabel=function(t,e,i,a){var s=this.axis,r=s.horiz,o=s.options,l=this.label,h=o.labels,n=h.step,d=pick(this.tickmarkOffset,s.tickmarkOffset),c=!0,p=t.x,f=t.y;l&&isNumber(p)&&(l.xy=t=this.getLabelPosition(p,f,l,r,h,d,a,n),this.isFirst&&!this.isLast&&!pick(o.showFirstLabel,1)||this.isLast&&!this.isFirst&&!pick(o.showLastLabel,1)?c=!1:!r||h.step||h.rotation||e||0===i||this.handleOverflow(t),n&&a%n&&(c=!1),c&&isNumber(t.y)?(t.opacity=i,l[this.isNewLabel?"attr":"animate"](t),this.isNewLabel=!1):(l.attr("y",-9999),this.isNewLabel=!0))},t.prototype.replaceMovedLabel=function(){var t,e,i=this.label,a=this.axis,s=a.reversed;i&&!this.isNew&&(t=a.horiz?s?a.left:a.width+a.left:i.xy.x,e=a.horiz?i.xy.y:s?a.width+a.top:a.top,i.animate({x:t,y:e,opacity:0},void 0,i.destroy),delete this.label),a.isDirty=!0,this.label=this.movedLabel,delete this.movedLabel},t}();H.Tick=Tick;export default H.Tick;