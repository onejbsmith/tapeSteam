"use strict";import Axis from"./Axis.js";import H from"../Globals.js";import U from"../Utilities.js";var arrayMax=U.arrayMax,arrayMin=U.arrayMin,defined=U.defined,destroyObjectProperties=U.destroyObjectProperties,erase=U.erase,extend=U.extend,merge=U.merge,objectEach=U.objectEach,pick=U.pick,PlotLineOrBand=function(){function t(t,e){this.axis=t,e&&(this.options=e,this.id=e.id)}return t.prototype.render=function(){H.fireEvent(this,"render");var t,e=this,i=e.axis,n=i.horiz,r=i.logarithmic,s=e.options,a=s.label,o=e.label,d=s.to,l=s.from,h=s.value,c=defined(l)&&defined(d),p=defined(h),f=e.svgElem,u=!f,L=[],P=s.color,g=pick(s.zIndex,0),x=s.events,m={class:"highcharts-plot-"+(c?"band ":"line ")+(s.className||"")},y={},v=i.chart.renderer,B=c?"bands":"lines";if(r&&(l=r.log2lin(l),d=r.log2lin(d),h=r.log2lin(h)),i.chart.styledMode||(p?(m.stroke=P||"#999999",m["stroke-width"]=pick(s.width,1),s.dashStyle&&(m.dashstyle=s.dashStyle)):c&&(m.fill=P||"#e6ebf5",s.borderWidth&&(m.stroke=s.borderColor,m["stroke-width"]=s.borderWidth))),y.zIndex=g,B+="-"+g,(t=i.plotLinesAndBandsGroups[B])||(i.plotLinesAndBandsGroups[B]=t=v.g("plot-"+B).attr(y).add()),u&&(e.svgElem=f=v.path().attr(m).add(t)),p)L=i.getPlotLinePath({value:h,lineWidth:f.strokeWidth(),acrossPanes:s.acrossPanes});else{if(!c)return;L=i.getPlotBandPath(l,d,s)}return!e.eventsAdded&&x&&(objectEach(x,function(t,i){f.on(i,function(t){x[i].apply(e,[t])})}),e.eventsAdded=!0),(u||!f.d)&&L&&L.length?f.attr({d:L}):f&&(L?(f.show(!0),f.animate({d:L})):f.d&&(f.hide(),o&&(e.label=o=o.destroy()))),a&&(defined(a.text)||defined(a.formatter))&&L&&L.length&&i.width>0&&i.height>0&&!L.isFlat?(a=merge({align:n&&c&&"center",x:n?!c&&4:10,verticalAlign:!n&&c&&"middle",y:n?c?16:10:c?6:-4,rotation:n&&!c&&90},a),this.renderLabel(a,L,c,g)):o&&o.hide(),e},t.prototype.renderLabel=function(t,e,i,n){var r,s,a,o,d,l,h=this.label,c=this.axis.chart.renderer;h||((r={align:t.textAlign||t.align,rotation:t.rotation,class:"highcharts-plot-"+(i?"band":"line")+"-label "+(t.className||"")}).zIndex=n,l=this.getLabelText(t),this.label=h=c.text(l,0,0,t.useHTML).attr(r).add(),this.axis.chart.styledMode||h.css(t.style)),s=e.xBounds||[e[0][1],e[1][1],i?e[2][1]:e[0][1]],a=e.yBounds||[e[0][2],e[1][2],i?e[2][2]:e[0][2]],o=arrayMin(s),d=arrayMin(a),h.align(t,!1,{x:o,y:d,width:arrayMax(s)-o,height:arrayMax(a)-d}),h.show(!0)},t.prototype.getLabelText=function(t){return defined(t.formatter)?t.formatter.call(this):t.text},t.prototype.destroy=function(){erase(this.axis.plotLinesAndBands,this),delete this.axis,destroyObjectProperties(this)},t}();extend(Axis.prototype,{getPlotBandPath:function(t,e,i){void 0===i&&(i=this.options);var n,r,s=this.getPlotLinePath({value:e,force:!0,acrossPanes:i.acrossPanes}),a=this.getPlotLinePath({value:t,force:!0,acrossPanes:i.acrossPanes}),o=[],d=this.horiz,l=1,h=t<this.min&&e<this.min||t>this.max&&e>this.max;if(a&&s)for(h&&(r=a.toString()===s.toString(),l=0),n=0;n<a.length;n+=2){var c=a[n],p=a[n+1],f=s[n],u=s[n+1];"M"!==c[0]&&"L"!==c[0]||"M"!==p[0]&&"L"!==p[0]||"M"!==f[0]&&"L"!==f[0]||"M"!==u[0]&&"L"!==u[0]||(d&&f[1]===c[1]?(f[1]+=l,u[1]+=l):d||f[2]!==c[2]||(f[2]+=l,u[2]+=l),o.push(["M",c[1],c[2]],["L",p[1],p[2]],["L",u[1],u[2]],["L",f[1],f[2]],["Z"])),o.isFlat=r}else a=null;return o},addPlotBand:function(t){return this.addPlotBandOrLine(t,"plotBands")},addPlotLine:function(t){return this.addPlotBandOrLine(t,"plotLines")},addPlotBandOrLine:function(t,e){var i=new H.PlotLineOrBand(this,t),n=this.userOptions;if(this.visible&&(i=i.render()),i){if(e){var r=n[e]||[];r.push(t),n[e]=r}this.plotLinesAndBands.push(i),this._addedPlotLB=!0}return i},removePlotBandOrLine:function(t){for(var e=this.plotLinesAndBands,i=this.options,n=this.userOptions,r=e.length;r--;)e[r].id===t&&e[r].destroy();[i.plotLines||[],n.plotLines||[],i.plotBands||[],n.plotBands||[]].forEach(function(e){for(r=e.length;r--;)(e[r]||{}).id===t&&erase(e,e[r])})},removePlotBand:function(t){this.removePlotBandOrLine(t)},removePlotLine:function(t){this.removePlotBandOrLine(t)}}),H.PlotLineOrBand=PlotLineOrBand;export default H.PlotLineOrBand;