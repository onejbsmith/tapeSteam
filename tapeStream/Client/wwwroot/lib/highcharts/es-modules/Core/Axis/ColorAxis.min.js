"use strict";var __extends=this&&this.__extends||function(){var t=function(o,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,o){t.__proto__=o}||function(t,o){for(var e in o)o.hasOwnProperty(e)&&(t[e]=o[e])})(o,e)};return function(o,e){function i(){this.constructor=o}t(o,e),o.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}}();import Axis from"./Axis.js";import Chart from"../Chart/Chart.js";import Color from"../Color/Color.js";var color=Color.parse;import ColorSeriesModule from"../../Mixins/ColorSeries.js";var colorPointMixin=ColorSeriesModule.colorPointMixin,colorSeriesMixin=ColorSeriesModule.colorSeriesMixin;import Fx from"../Animation/Fx.js";import H from"../Globals.js";var noop=H.noop;import Legend from"../Legend.js";import LegendSymbolMixin from"../../Mixins/LegendSymbol.js";import LineSeries from"../../Series/LineSeries.js";import Point from"../Series/Point.js";import U from"../Utilities.js";var addEvent=U.addEvent,erase=U.erase,extend=U.extend,isNumber=U.isNumber,merge=U.merge,pick=U.pick,splat=U.splat;extend(LineSeries.prototype,colorSeriesMixin),extend(Point.prototype,colorPointMixin),Chart.prototype.collectionsWithUpdate.push("colorAxis"),Chart.prototype.collectionsWithInit.colorAxis=[Chart.prototype.addColorAxis];var ColorAxis=function(t){function o(o,e){var i=t.call(this,o,e)||this;return i.beforePadding=!1,i.chart=void 0,i.coll="colorAxis",i.dataClasses=void 0,i.legendItem=void 0,i.legendItems=void 0,i.name="",i.options=void 0,i.stops=void 0,i.visible=!0,i.init(o,e),i}return __extends(o,t),o.buildOptions=function(t,o,e){var i=t.options.legend||{},s=e.layout?"vertical"!==e.layout:"vertical"!==i.layout;return merge(o,{side:s?2:1,reversed:!s},e,{opposite:!s,showEmpty:!1,title:null,visible:i.enabled&&(!e||!1!==e.visible)})},o.prototype.init=function(e,i){var s=o.buildOptions(e,o.defaultOptions,i);this.coll="colorAxis",t.prototype.init.call(this,e,s),i.dataClasses&&this.initDataClasses(i),this.initStops(),this.horiz=!s.opposite,this.zoomEnabled=!1},o.prototype.initDataClasses=function(t){var o,e=this.chart,i=0,s=e.options.chart.colorCount,r=this.options,n=t.dataClasses.length;this.dataClasses=o=[],this.legendItems=[],t.dataClasses.forEach(function(t,a){var l;t=merge(t),o.push(t),!e.styledMode&&t.color||("category"===r.dataClassColor?(e.styledMode||(l=e.options.colors,s=l.length,t.color=l[i]),t.colorIndex=i,++i===s&&(i=0)):t.color=color(r.minColor).tweenTo(color(r.maxColor),n<2?.5:a/(n-1)))})},o.prototype.hasData=function(){return!!(this.tickPositions||[]).length},o.prototype.setTickPositions=function(){if(!this.dataClasses)return t.prototype.setTickPositions.call(this)},o.prototype.initStops=function(){this.stops=this.options.stops||[[0,this.options.minColor],[1,this.options.maxColor]],this.stops.forEach(function(t){t.color=color(t[1])})},o.prototype.setOptions=function(o){t.prototype.setOptions.call(this,o),this.options.crosshair=this.options.marker},o.prototype.setAxisSize=function(){var t,e,i,s,r=this.legendSymbol,n=this.chart,a=n.options.legend||{};r?(this.left=t=r.attr("x"),this.top=e=r.attr("y"),this.width=i=r.attr("width"),this.height=s=r.attr("height"),this.right=n.chartWidth-t-i,this.bottom=n.chartHeight-e-s,this.len=this.horiz?i:s,this.pos=this.horiz?t:e):this.len=(this.horiz?a.symbolWidth:a.symbolHeight)||o.defaultLegendLength},o.prototype.normalizedValue=function(t){return this.logarithmic&&(t=this.logarithmic.log2lin(t)),1-(this.max-t)/(this.max-this.min||1)},o.prototype.toColor=function(t,o){var e,i,s,r,n,a,l=this.dataClasses,h=this.stops;if(l){for(a=l.length;a--;)if(i=(n=l[a]).from,s=n.to,(void 0===i||t>=i)&&(void 0===s||t<=s)){r=n.color,o&&(o.dataClass=a,o.colorIndex=n.colorIndex);break}}else{for(e=this.normalizedValue(t),a=h.length;a--&&!(e>h[a][0]););i=h[a]||h[a+1],e=1-((s=h[a+1]||i)[0]-e)/(s[0]-i[0]||1),r=i.color.tweenTo(s.color,e)}return r},o.prototype.getOffset=function(){var o=this.legendGroup,e=this.chart.axisOffset[this.side];o&&(this.axisParent=o,t.prototype.getOffset.call(this),this.added||(this.added=!0,this.labelLeft=0,this.labelRight=this.width),this.chart.axisOffset[this.side]=e)},o.prototype.setLegendColor=function(){var t=this.horiz,o=this.reversed,e=o?1:0,i=o?0:1,s=t?[e,0,i,0]:[0,i,0,e];this.legendColor={linearGradient:{x1:s[0],y1:s[1],x2:s[2],y2:s[3]},stops:this.stops}},o.prototype.drawLegendSymbol=function(t,e){var i=t.padding,s=t.options,r=this.horiz,n=pick(s.symbolWidth,r?o.defaultLegendLength:12),a=pick(s.symbolHeight,r?12:o.defaultLegendLength),l=pick(s.labelPadding,r?16:30),h=pick(s.itemDistance,10);this.setLegendColor(),e.legendSymbol=this.chart.renderer.rect(0,t.baseline-11,n,a).attr({zIndex:1}).add(e.legendGroup),this.legendItemWidth=n+i+(r?h:l),this.legendItemHeight=a+i+(r?l:0)},o.prototype.setState=function(t){this.series.forEach(function(o){o.setState(t)})},o.prototype.setVisible=function(){},o.prototype.getSeriesExtremes=function(){var t,o,e,i,s,r,n,a,l=this.series,h=l.length;for(this.dataMin=1/0,this.dataMax=-1/0;h--;){if(o=(r=l[h]).colorKey=pick(r.options.colorKey,r.colorKey,r.pointValKey,r.zoneAxis,"y"),i=r.pointArrayMap,s=r[o+"Min"]&&r[o+"Max"],r[o+"Data"])t=r[o+"Data"];else if(i){if(t=[],e=i.indexOf(o),n=r.yData,e>=0&&n)for(a=0;a<n.length;a++)t.push(pick(n[a][e],n[a]))}else t=r.yData;if(s)r.minColorValue=r[o+"Min"],r.maxColorValue=r[o+"Max"];else{var d=LineSeries.prototype.getExtremes.call(r,t);r.minColorValue=d.dataMin,r.maxColorValue=d.dataMax}void 0!==r.minColorValue&&(this.dataMin=Math.min(this.dataMin,r.minColorValue),this.dataMax=Math.max(this.dataMax,r.maxColorValue)),s||LineSeries.prototype.applyExtremes.call(r)}},o.prototype.drawCrosshair=function(o,e){var i,s=e&&e.plotX,r=e&&e.plotY,n=this.pos,a=this.len;e&&((i=this.toPixels(e.getNestedProperty(e.series.colorKey)))<n?i=n-2:i>n+a&&(i=n+a+2),e.plotX=i,e.plotY=this.len-i,t.prototype.drawCrosshair.call(this,o,e),e.plotX=s,e.plotY=r,this.cross&&!this.cross.addedToColorAxis&&this.legendGroup&&(this.cross.addClass("highcharts-coloraxis-marker").add(this.legendGroup),this.cross.addedToColorAxis=!0,!this.chart.styledMode&&this.crosshair&&this.cross.attr({fill:this.crosshair.color})))},o.prototype.getPlotLinePath=function(o){var e=this.left,i=o.translatedValue,s=this.top;return isNumber(i)?this.horiz?[["M",i-4,s-6],["L",i+4,s-6],["L",i,s],["Z"]]:[["M",e,i],["L",e-6,i+6],["L",e-6,i-6],["Z"]]:t.prototype.getPlotLinePath.call(this,o)},o.prototype.update=function(e,i){var s=this.chart,r=s.legend,n=o.buildOptions(s,{},e);this.series.forEach(function(t){t.isDirtyData=!0}),(e.dataClasses&&r.allItems||this.dataClasses)&&this.destroyItems(),s.options[this.coll]=merge(this.userOptions,n),t.prototype.update.call(this,n,i),this.legendItem&&(this.setLegendColor(),r.colorizeItem(this,!0))},o.prototype.destroyItems=function(){var t=this.chart;this.legendItem?t.legend.destroyItem(this):this.legendItems&&this.legendItems.forEach(function(o){t.legend.destroyItem(o)}),t.isDirtyLegend=!0},o.prototype.remove=function(o){this.destroyItems(),t.prototype.remove.call(this,o)},o.prototype.getDataClassLegendSymbols=function(){var t,o=this,e=o.chart,i=o.legendItems,s=e.options.legend,r=s.valueDecimals,n=s.valueSuffix||"";return i.length||o.dataClasses.forEach(function(s,a){var l=!0,h=s.from,d=s.to,p=e.numberFormatter;t="",void 0===h?t="< ":void 0===d&&(t="> "),void 0!==h&&(t+=p(h,r)+n),void 0!==h&&void 0!==d&&(t+=" - "),void 0!==d&&(t+=p(d,r)+n),i.push(extend({chart:e,name:t,options:{},drawLegendSymbol:LegendSymbolMixin.drawRectangle,visible:!0,setState:noop,isDataClass:!0,setVisible:function(){l=o.visible=!l,o.series.forEach(function(t){t.points.forEach(function(t){t.dataClass===a&&t.setVisible(l)})}),e.legend.colorizeItem(this,l)}},s))}),i},o.defaultLegendLength=200,o.defaultOptions={lineWidth:0,minPadding:0,maxPadding:0,gridLineWidth:1,tickPixelInterval:72,startOnTick:!0,endOnTick:!0,offset:0,marker:{animation:{duration:50},width:.01,color:"#999999"},labels:{overflow:"justify",rotation:0},minColor:"#e6ebf5",maxColor:"#003399",tickLength:5,showInLegend:!0},o.keepProps=["legendGroup","legendItemHeight","legendItemWidth","legendItem","legendSymbol"],o}(Axis);Array.prototype.push.apply(Axis.keepProps,ColorAxis.keepProps),H.ColorAxis=ColorAxis,["fill","stroke"].forEach(function(t){Fx.prototype[t+"Setter"]=function(){this.elem.attr(t,color(this.start).tweenTo(color(this.end),this.pos),null,!0)}}),addEvent(Chart,"afterGetAxes",function(){var t=this,o=t.options;this.colorAxis=[],o.colorAxis&&(o.colorAxis=splat(o.colorAxis),o.colorAxis.forEach(function(o,e){o.index=e,new ColorAxis(t,o)}))}),addEvent(LineSeries,"bindAxes",function(){var t=this.axisTypes;t?-1===t.indexOf("colorAxis")&&t.push("colorAxis"):this.axisTypes=["colorAxis"]}),addEvent(Legend,"afterGetAllItems",function(t){var o,e,i=[];for((this.chart.colorAxis||[]).forEach(function(e){(o=e.options)&&o.showInLegend&&(o.dataClasses&&o.visible?i=i.concat(e.getDataClassLegendSymbols()):o.visible&&i.push(e),e.series.forEach(function(e){e.options.showInLegend&&!o.dataClasses||("point"===e.options.legendType?e.points.forEach(function(o){erase(t.allItems,o)}):erase(t.allItems,e))}))}),e=i.length;e--;)t.allItems.unshift(i[e])}),addEvent(Legend,"afterColorizeItem",function(t){t.visible&&t.item.legendColor&&t.item.legendSymbol.attr({fill:t.item.legendColor})}),addEvent(Legend,"afterUpdate",function(){var t=this.chart.colorAxis;t&&t.forEach(function(t){t.update({},arguments[2])})}),addEvent(LineSeries,"afterTranslate",function(){(this.chart.colorAxis&&this.chart.colorAxis.length||this.colorAttribs)&&this.translateColors()});export default ColorAxis;