"use strict";import Axis from"./Axis.js";import LineSeries from"../../Series/LineSeries.js";import StackItem from"../../Extensions/Stacking.js";import U from"../Utilities.js";var addEvent=U.addEvent,find=U.find,fireEvent=U.fireEvent,isArray=U.isArray,isNumber=U.isNumber,pick=U.pick,BrokenAxisAdditions=function(){function i(i){this.hasBreaks=!1,this.axis=i}return i.isInBreak=function(i,t){var n=i.repeat||1/0,e=i.from,r=i.to-i.from,s=t>=e?(t-e)%n:n-(e-t)%n;return i.inclusive?s<=r:s<r&&0!==s},i.lin2Val=function(t){var n=this.brokenAxis,e=n&&n.breakArray;if(!e)return t;var r,s,o=t;for(s=0;s<e.length&&!((r=e[s]).from>=o);s++)r.to<o?o+=r.len:i.isInBreak(r,o)&&(o+=r.len);return o},i.val2Lin=function(t){var n=this.brokenAxis,e=n&&n.breakArray;if(!e)return t;var r,s,o=t;for(s=0;s<e.length;s++)if((r=e[s]).to<=t)o-=r.len;else{if(r.from>=t)break;if(i.isInBreak(r,t)){o-=t-r.from;break}}return o},i.prototype.findBreakAt=function(i,t){return find(t,function(t){return t.from<i&&i<t.to})},i.prototype.isInAnyBreak=function(t,n){var e,r,s,o=this.axis,a=o.options.breaks,f=a&&a.length;if(f){for(;f--;)i.isInBreak(a[f],t)&&(e=!0,r||(r=pick(a[f].showPoints,!o.isXAxis)));s=e&&n?e&&!r:e}return s},i.prototype.setBreaks=function(t,n){var e=this,r=e.axis,s=isArray(t)&&!!t.length;r.isDirty=e.hasBreaks!==s,e.hasBreaks=s,r.options.breaks=r.userOptions.breaks=t,r.forceRedraw=!0,r.series.forEach(function(i){i.isDirty=!0}),s||r.val2lin!==i.val2Lin||(delete r.val2lin,delete r.lin2val),s&&(r.userOptions.ordinal=!1,r.lin2val=i.lin2Val,r.val2lin=i.val2Lin,r.setExtremes=function(i,t,n,r,s){if(e.hasBreaks){for(var o,a=this.options.breaks;o=e.findBreakAt(i,a);)i=o.to;for(;o=e.findBreakAt(t,a);)t=o.from;t<i&&(t=i)}Axis.prototype.setExtremes.call(this,i,t,n,r,s)},r.setAxisTranslation=function(t){if(Axis.prototype.setAxisTranslation.call(this,t),e.unitLength=null,e.hasBreaks){var n,s,o,a,f=r.options.breaks||[],k=[],u=[],h=0,c=r.userMin||r.min,l=r.userMax||r.max,p=pick(r.pointRangePadding,0);f.forEach(function(t){s=t.repeat||1/0,i.isInBreak(t,c)&&(c+=t.to%s-c%s),i.isInBreak(t,l)&&(l-=l%s-t.from%s)}),f.forEach(function(i){for(o=i.from,s=i.repeat||1/0;o-s>c;)o-=s;for(;o<c;)o+=s;for(a=o;a<l;a+=s)k.push({value:a,move:"in"}),k.push({value:a+(i.to-i.from),move:"out",size:i.breakSize})}),k.sort(function(i,t){return i.value===t.value?("in"===i.move?0:1)-("in"===t.move?0:1):i.value-t.value}),n=0,o=c,k.forEach(function(i){1===(n+="in"===i.move?1:-1)&&"in"===i.move&&(o=i.value),0===n&&(u.push({from:o,to:i.value,len:i.value-o-(i.size||0)}),h+=i.value-o-(i.size||0))}),r.breakArray=e.breakArray=u,e.unitLength=l-c-h+p,fireEvent(r,"afterBreaks"),r.staticScale?r.transA=r.staticScale:e.unitLength&&(r.transA*=(l-r.min+p)/e.unitLength),p&&(r.minPixelPadding=r.transA*r.minPointOffset),r.min=c,r.max=l}}),pick(n,!0)&&r.chart.redraw()},i}(),BrokenAxis=function(){function i(){}return i.compose=function(i,t){i.keepProps.push("brokenAxis");var n=LineSeries.prototype;n.drawBreaks=function(i,t){var n,e,r,s,o=this,a=o.points;if(i&&i.brokenAxis&&i.brokenAxis.hasBreaks){var f=i.brokenAxis;t.forEach(function(t){n=f&&f.breakArray||[],e=i.isXAxis?i.min:pick(o.options.threshold,i.min),a.forEach(function(o){s=pick(o["stack"+t.toUpperCase()],o[t]),n.forEach(function(t){isNumber(e)&&isNumber(s)&&(r=!1,e<t.from&&s>t.to||e>t.from&&s<t.from?r="pointBreak":(e<t.from&&s>t.from&&s<t.to||e>t.from&&s>t.to&&s<t.from)&&(r="pointInBreak"),r&&fireEvent(i,r,{point:o,brk:t}))})})})}},n.gappedPath=function(){var i=this.currentDataGrouping,t=i&&i.gapSize,n=this.options.gapSize,e=this.points.slice(),r=e.length-1,s=this.yAxis;if(n&&r>0){"value"!==this.options.gapUnit&&(n*=this.basePointRange),t&&t>n&&t>=this.basePointRange&&(n=t);for(var o=void 0,a=void 0;r--;)if(a&&!1!==a.visible||(a=e[r+1]),o=e[r],!1!==a.visible&&!1!==o.visible){if(a.x-o.x>n){var f=(o.x+a.x)/2;e.splice(r+1,0,{isNull:!0,x:f}),s.stacking&&this.options.stacking&&((s.stacking.stacks[this.stackKey][f]=new StackItem(s,s.options.stackLabels,!1,f,this.stack)).total=0)}a=o}}return this.getGraphPath(e)},addEvent(i,"init",function(){this.brokenAxis||(this.brokenAxis=new BrokenAxisAdditions(this))}),addEvent(i,"afterInit",function(){void 0!==this.brokenAxis&&this.brokenAxis.setBreaks(this.options.breaks,!1)}),addEvent(i,"afterSetTickPositions",function(){var i=this.brokenAxis;if(i&&i.hasBreaks){var t,n=this.tickPositions,e=this.tickPositions.info,r=[];for(t=0;t<n.length;t++)i.isInAnyBreak(n[t])||r.push(n[t]);this.tickPositions=r,this.tickPositions.info=e}}),addEvent(i,"afterSetOptions",function(){this.brokenAxis&&this.brokenAxis.hasBreaks&&(this.options.ordinal=!1)}),addEvent(t,"afterGeneratePoints",function(){var i=this,t=i.isDirty,n=i.options.connectNulls,e=i.points,r=i.xAxis,s=i.yAxis;if(t)for(var o=e.length;o--;){var a=e[o],f=!(null===a.y&&!1===n)&&(r&&r.brokenAxis&&r.brokenAxis.isInAnyBreak(a.x,!0)||s&&s.brokenAxis&&s.brokenAxis.isInAnyBreak(a.y,!0));a.visible=!f&&!1!==a.options.visible}}),addEvent(t,"afterRender",function(){this.drawBreaks(this.xAxis,["x"]),this.drawBreaks(this.yAxis,pick(this.pointArrayMap,["y"]))})},i}();BrokenAxis.compose(Axis,LineSeries);export default BrokenAxis;