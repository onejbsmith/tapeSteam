"use strict";import Axis from"./Axis.js";import Tick from"./Tick.js";import HiddenAxis from"./HiddenAxis.js";import U from"../Utilities.js";var addEvent=U.addEvent,correctFloat=U.correctFloat,defined=U.defined,extend=U.extend,fireEvent=U.fireEvent,isNumber=U.isNumber,merge=U.merge,pick=U.pick,pInt=U.pInt,relativeLength=U.relativeLength,wrap=U.wrap,RadialAxis=function(){function t(){}return t.init=function(t){var i=Axis.prototype;t.setOptions=function(i){var e=this.options=merge(t.constructor.defaultOptions,this.defaultPolarOptions,i);e.plotBands||(e.plotBands=[]),fireEvent(this,"afterSetOptions")},t.getOffset=function(){i.getOffset.call(this),this.chart.axisOffset[this.side]=0},t.getLinePath=function(t,i,e){var s,a,n=this.pane.center,r=this.chart,o=pick(i,n[2]/2-this.offset);return void 0===e&&(e=this.horiz?0:this.center&&-this.center[3]/2),e&&(o+=e),this.isCircular||void 0!==i?((a=this.chart.renderer.symbols.arc(this.left+n[0],this.top+n[1],o,o,{start:this.startAngleRad,end:this.endAngleRad,open:!0,innerR:0})).xBounds=[this.left+n[0]],a.yBounds=[this.top+n[1]-o]):(s=this.postTranslate(this.angleRad,o),a=[["M",this.center[0]+r.plotLeft,this.center[1]+r.plotTop],["L",s.x,s.y]]),a},t.setAxisTranslation=function(){i.setAxisTranslation.call(this),this.center&&(this.isCircular?this.transA=(this.endAngleRad-this.startAngleRad)/(this.max-this.min||1):this.transA=(this.center[2]-this.center[3])/2/(this.max-this.min||1),this.isXAxis?this.minPixelPadding=this.transA*this.minPointOffset:this.minPixelPadding=0)},t.beforeSetTickPositions=function(){this.autoConnect=this.isCircular&&void 0===pick(this.userMax,this.options.max)&&correctFloat(this.endAngleRad-this.startAngleRad)===correctFloat(2*Math.PI),!this.isCircular&&this.chart.inverted&&this.max++,this.autoConnect&&(this.max+=(this.categories?1:this.pointRange)||this.closestPointRange||0)},t.setAxisSize=function(){var t,e;i.setAxisSize.call(this),this.isRadial&&(this.pane.updateCenter(this),t=this.center=extend([],this.pane.center),this.isCircular?this.sector=this.endAngleRad-this.startAngleRad:(e=this.postTranslate(this.angleRad,t[3]/2),t[0]=e.x-this.chart.plotLeft,t[1]=e.y-this.chart.plotTop),this.len=this.width=this.height=(t[2]-t[3])*pick(this.sector,1)/2)},t.getPosition=function(t,i){var e=this.translate(t);return this.postTranslate(this.isCircular?e:this.angleRad,pick(this.isCircular?i:e<0?0:e,this.center[2]/2)-this.offset)},t.postTranslate=function(t,i){var e=this.chart,s=this.center;return t=this.startAngleRad+t,{x:e.plotLeft+s[0]+Math.cos(t)*i,y:e.plotTop+s[1]+Math.sin(t)*i}},t.getPlotBandPath=function(t,i,e){var s,a,n,r,o,h,l=function(t){if("string"==typeof t){var i=parseInt(t,10);return g.test(t)&&(i=i*p/100),i}return t},c=this.center,d=this.startAngleRad,p=c[2]/2,u=Math.min(this.offset,0),g=/%$/,f=this.isCircular,x=pick(l(e.outerRadius),p),v=l(e.innerRadius),P=pick(l(e.thickness),10);if("polygon"===this.options.gridLineInterpolation)h=this.getPlotLinePath({value:t}).concat(this.getPlotLinePath({value:i,reverse:!0}));else{t=Math.max(t,this.min),i=Math.min(i,this.max);var A=this.translate(t),m=this.translate(i);f||(x=A||0,v=m||0),"circle"!==e.shape&&f?(s=d+(A||0),a=d+(m||0)):(s=-Math.PI/2,a=1.5*Math.PI,o=!0),x-=u,P-=u,h=this.chart.renderer.symbols.arc(this.left+c[0],this.top+c[1],x,x,{start:Math.min(s,a),end:Math.max(s,a),innerR:pick(v,x-P),open:o}),f&&(n=(a+s)/2,r=this.left+c[0]+c[2]/2*Math.cos(n),h.xBounds=n>-Math.PI/2&&n<Math.PI/2?[r,this.chart.plotWidth]:[0,r],h.yBounds=[this.top+c[1]+c[2]/2*Math.sin(n)],h.yBounds[0]+=n>-Math.PI&&n<0||n>Math.PI?-10:10)}return h},t.getCrosshairPosition=function(t,i,e){var s,a,n,r=t.value,o=this.pane.center;return this.isCircular?(defined(r)?t.point&&(t.point.shapeArgs||{}).start&&(r=this.chart.inverted?this.translate(t.point.rectPlotY,!0):t.point.x):(a=t.chartX||0,n=t.chartY||0,r=this.translate(Math.atan2(n-e,a-i)-this.startAngleRad,!0)),a=(s=this.getPosition(r)).x,n=s.y):(defined(r)||(a=t.chartX,n=t.chartY),defined(a)&&defined(n)&&(e=o[1]+this.chart.plotTop,r=this.translate(Math.min(Math.sqrt(Math.pow(a-i,2)+Math.pow(n-e,2)),o[2]/2)-o[3]/2,!0))),[r,a||0,n||0]},t.getPlotLinePath=function(t){var i,e,s,a,n,r,o,h,l,c=this,d=c.pane.center,p=c.chart,u=p.inverted,g=t.value,f=t.reverse,x=c.getPosition(g),v=c.pane.options.background?c.pane.options.background[0]||c.pane.options.background:{},P=v.innerRadius||"0%",A=v.outerRadius||"100%",m=d[0]+p.plotLeft,R=d[1]+p.plotTop,k=x.x,L=x.y,M=c.height,b=t.isCrosshair,y=d[3]/2;if(b&&(g=(h=this.getCrosshairPosition(t,m,R))[0],k=h[1],L=h[2]),c.isCircular)e=Math.sqrt(Math.pow(k-m,2)+Math.pow(L-R,2)),s="string"==typeof P?relativeLength(P,1):P/e,a="string"==typeof A?relativeLength(A,1):A/e,d&&y&&(s<(i=y/e)&&(s=i),a<i&&(a=i)),l=[["M",m+s*(k-m),R-s*(R-L)],["L",k-(1-a)*(k-m),L+(1-a)*(R-L)]];else if((g=c.translate(g))&&(g<0||g>M)&&(g=0),"circle"===c.options.gridLineInterpolation)l=c.getLinePath(0,g,y);else if(l=[],p[u?"yAxis":"xAxis"].forEach(function(t){t.pane===c.pane&&(n=t)}),n){o=n.tickPositions,n.autoConnect&&(o=o.concat([o[0]])),f&&(o=o.slice().reverse()),g&&(g+=y);for(var C=0;C<o.length;C++)r=n.getPosition(o[C],g),l.push(C?["L",r.x,r.y]:["M",r.x,r.y])}return l},t.getTitlePosition=function(){var t=this.center,i=this.chart,e=this.options.title;return{x:i.plotLeft+t[0]+(e.x||0),y:i.plotTop+t[1]-{high:.5,middle:.25,low:0}[e.align]*t[2]+(e.y||0)}},t.createLabelCollector=function(){var t=this;return function(){if(t.isRadial&&t.tickPositions&&!0!==t.options.labels.allowOverlap)return t.tickPositions.map(function(i){return t.ticks[i]&&t.ticks[i].label}).filter(function(t){return Boolean(t)})}}},t.compose=function(i,e){addEvent(i,"init",function(e){var s,a=this.chart,n=a.inverted,r=a.angular,o=a.polar,h=this.isXAxis,l=this.coll,c=r&&h,d=a.options,p=e.userOptions.pane||0,u=this.pane=a.pane&&a.pane[p];"colorAxis"!==l?(r?(c?HiddenAxis.init(this):t.init(this),(s=!h)&&(this.defaultPolarOptions=t.defaultRadialGaugeOptions)):o&&(t.init(this),s=this.horiz,this.defaultPolarOptions=s?t.defaultCircularOptions:merge("xAxis"===l?i.defaultOptions:i.defaultYAxisOptions,t.defaultRadialOptions),n&&"yAxis"===l&&(this.defaultPolarOptions.stackLabels=i.defaultYAxisOptions.stackLabels)),r||o?(this.isRadial=!0,d.chart.zoomType=null,this.labelCollector||(this.labelCollector=this.createLabelCollector()),this.labelCollector&&a.labelCollectors.push(this.labelCollector)):this.isRadial=!1,u&&s&&(u.axis=this),this.isCircular=s):this.isRadial=!1}),addEvent(i,"afterInit",function(){var t=this.chart,i=this.options,e=t.angular&&this.isXAxis,s=this.pane,a=s&&s.options;!e&&s&&(t.angular||t.polar)&&(this.angleRad=(i.angle||0)*Math.PI/180,this.startAngleRad=(a.startAngle-90)*Math.PI/180,this.endAngleRad=(pick(a.endAngle,a.startAngle+360)-90)*Math.PI/180,this.offset=i.offset||0)}),addEvent(i,"autoLabelAlign",function(t){this.isRadial&&(t.align=void 0,t.preventDefault())}),addEvent(i,"destroy",function(){if(this.chart&&this.chart.labelCollectors){var t=this.labelCollector?this.chart.labelCollectors.indexOf(this.labelCollector):-1;t>=0&&this.chart.labelCollectors.splice(t,1)}}),addEvent(i,"initialAxisTranslation",function(){this.isRadial&&this.beforeSetTickPositions()}),addEvent(e,"afterGetPosition",function(t){this.axis.getPosition&&extend(t.pos,this.axis.getPosition(this.pos))}),addEvent(e,"afterGetLabelPosition",function(t){var i=this.axis,e=this.label;if(e){var s,a=e.getBBox(),n=i.options.labels,r=n.y,o=20,h=n.align,l=(i.translate(this.pos)+i.startAngleRad+Math.PI/2)/Math.PI*180%360,c=Math.round(l),d="end",p=c<0?c+360:c,u=p,g=0,f=0,x=null===n.y?.3*-a.height:0;i.isRadial&&(s=i.getPosition(this.pos,i.center[2]/2+relativeLength(pick(n.distance,-25),i.center[2]/2,-i.center[2]/2)),"auto"===n.rotation?e.attr({rotation:l}):null===r&&(r=i.chart.renderer.fontMetrics(e.styles&&e.styles.fontSize).b-a.height/2),null===h&&(i.isCircular?(a.width>i.len*i.tickInterval/(i.max-i.min)&&(o=0),h=l>o&&l<180-o?"left":l>180+o&&l<360-o?"right":"center"):h="center",e.attr({align:h})),"auto"===h&&2===i.tickPositions.length&&i.isCircular&&(p>90&&p<180?p=180-p:p>270&&p<=360&&(p=540-p),u>180&&u<=360&&(u=360-u),i.pane.options.startAngle!==c&&i.pane.options.startAngle!==c+360&&i.pane.options.startAngle!==c-360||(d="start"),h=c>=-90&&c<=90||c>=-360&&c<=-270||c>=270&&c<=360?"start"===d?"right":"left":"start"===d?"left":"right",u>70&&u<110&&(h="center"),p<15||p>=180&&p<195?g=.3*a.height:p>=15&&p<=35?g="start"===d?0:.75*a.height:p>=195&&p<=215?g="start"===d?.75*a.height:0:p>35&&p<=90?g="start"===d?.25*-a.height:a.height:p>215&&p<=270&&(g="start"===d?a.height:.25*-a.height),u<15?f="start"===d?.15*-a.height:.15*a.height:u>165&&u<=180&&(f="start"===d?.15*a.height:.15*-a.height),e.attr({align:h}),e.translate(f,g+x)),t.pos.x=s.x+n.x,t.pos.y=s.y+r)}}),wrap(e.prototype,"getMarkPath",function(t,i,e,s,a,n,r){var o,h=this.axis;return h.isRadial?["M",i,e,"L",(o=h.getPosition(this.pos,h.center[2]/2+s)).x,o.y]:t.call(this,i,e,s,a,n,r)})},t.defaultCircularOptions={gridLineWidth:1,labels:{align:null,distance:15,x:0,y:null,style:{textOverflow:"none"}},maxPadding:0,minPadding:0,showLastLabel:!1,tickLength:0},t.defaultRadialGaugeOptions={labels:{align:"center",x:0,y:null},minorGridLineWidth:0,minorTickInterval:"auto",minorTickLength:10,minorTickPosition:"inside",minorTickWidth:1,tickLength:10,tickPosition:"inside",tickWidth:2,title:{rotation:0},zIndex:2},t.defaultRadialOptions={gridLineInterpolation:"circle",gridLineWidth:1,labels:{align:"right",x:-3,y:-2},showLastLabel:!1,title:{x:4,text:null,rotation:90}},t}();RadialAxis.compose(Axis,Tick);export default RadialAxis;