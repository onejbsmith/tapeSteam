"use strict";import A from"./Animation/AnimationUtilities.js";var animate=A.animate,setAnimation=A.setAnimation;import Axis from"./Axis/Axis.js";import BaseSeries from"./Series/Series.js";var seriesTypes=BaseSeries.seriesTypes;import Chart from"./Chart/Chart.js";import H from"./Globals.js";import LineSeries from"../Series/LineSeries.js";import O from"./Options.js";var time=O.time;import Point from"../Core/Series/Point.js";import Time from"./Time.js";import U from"./Utilities.js";var addEvent=U.addEvent,createElement=U.createElement,css=U.css,defined=U.defined,erase=U.erase,error=U.error,extend=U.extend,fireEvent=U.fireEvent,isArray=U.isArray,isNumber=U.isNumber,isObject=U.isObject,isString=U.isString,merge=U.merge,objectEach=U.objectEach,pick=U.pick,relativeLength=U.relativeLength,splat=U.splat;H.cleanRecursively=function(t,e){var i={};return objectEach(t,function(s,o){var a;isObject(t[o],!0)&&!t.nodeType&&e[o]?(a=H.cleanRecursively(t[o],e[o]),Object.keys(a).length&&(i[o]=a)):(isObject(t[o])||t[o]!==e[o])&&(i[o]=t[o])}),i},extend(Chart.prototype,{addSeries:function(t,e,i){var s,o=this;return t&&(e=pick(e,!0),fireEvent(o,"addSeries",{options:t},function(){s=o.initSeries(t),o.isDirtyLegend=!0,o.linkSeries(),s.enabledDataSorting&&s.setData(t.data,!1),fireEvent(o,"afterAddSeries",{series:s}),e&&o.redraw(i)})),s},addAxis:function(t,e,i,s){return this.createAxis(e?"xAxis":"yAxis",{axis:t,redraw:i,animation:s})},addColorAxis:function(t,e,i){return this.createAxis("colorAxis",{axis:t,redraw:e,animation:i})},createAxis:function(t,e){var i,s=this.options,o="colorAxis"===t,a=e.axis,n=e.redraw,r=e.animation,p=merge(a,{index:this[t].length,isX:"xAxis"===t});return i=o?new H.ColorAxis(this,p):new Axis(this,p),s[t]=splat(s[t]||{}),s[t].push(p),o&&(this.isDirtyLegend=!0,this.axes.forEach(function(t){t.series=[]}),this.series.forEach(function(t){t.bindAxes(),t.isDirtyData=!0})),pick(n,!0)&&this.redraw(r),i},showLoading:function(t){var e=this,i=e.options,s=e.loadingDiv,o=i.loading,a=function(){s&&css(s,{left:e.plotLeft+"px",top:e.plotTop+"px",width:e.plotWidth+"px",height:e.plotHeight+"px"})};s||(e.loadingDiv=s=createElement("div",{className:"highcharts-loading highcharts-loading-hidden"},null,e.container),e.loadingSpan=createElement("span",{className:"highcharts-loading-inner"},null,s),addEvent(e,"redraw",a)),s.className="highcharts-loading",e.loadingSpan.innerHTML=pick(t,i.lang.loading,""),e.styledMode||(css(s,extend(o.style,{zIndex:10})),css(e.loadingSpan,o.labelStyle),e.loadingShown||(css(s,{opacity:0,display:""}),animate(s,{opacity:o.style.opacity||.5},{duration:o.showDuration||0}))),e.loadingShown=!0,a()},hideLoading:function(){var t=this.options,e=this.loadingDiv;e&&(e.className="highcharts-loading highcharts-loading-hidden",this.styledMode||animate(e,{opacity:0},{duration:t.loading.hideDuration||100,complete:function(){css(e,{display:"none"})}})),this.loadingShown=!1},propsRequireDirtyBox:["backgroundColor","borderColor","borderWidth","borderRadius","plotBackgroundColor","plotBackgroundImage","plotBorderColor","plotBorderWidth","plotShadow","shadow"],propsRequireReflow:["margin","marginTop","marginRight","marginBottom","marginLeft","spacing","spacingTop","spacingRight","spacingBottom","spacingLeft"],propsRequireUpdateSeries:["chart.inverted","chart.polar","chart.ignoreHiddenSeries","chart.type","colors","plotOptions","time","tooltip"],collectionsWithUpdate:["xAxis","yAxis","zAxis","series"],update:function(t,e,i,s){var o,a,n,r,p,d,c=this,h={credits:"addCredits",title:"setTitle",subtitle:"setSubtitle",caption:"setCaption"},l=t.isResponsiveOptions,u=[];fireEvent(c,"update",{options:t}),l||c.setResponsive(!1,!0),t=H.cleanRecursively(t,c.options),merge(!0,c.userOptions,t),(o=t.chart)&&(merge(!0,c.options.chart,o),"className"in o&&c.setClassName(o.className),"reflow"in o&&c.setReflow(o.reflow),("inverted"in o||"polar"in o||"type"in o)&&(c.propFromSeries(),a=!0),"alignTicks"in o&&(a=!0),objectEach(o,function(t,e){-1!==c.propsRequireUpdateSeries.indexOf("chart."+e)&&(n=!0),-1!==c.propsRequireDirtyBox.indexOf(e)&&(c.isDirtyBox=!0),-1!==c.propsRequireReflow.indexOf(e)&&(l?c.isDirtyBox=!0:d=!0)}),!c.styledMode&&"style"in o&&c.renderer.setStyle(o.style)),!c.styledMode&&t.colors&&(this.options.colors=t.colors),t.time&&(this.time===time&&(this.time=new Time(t.time)),merge(!0,c.options.time,t.time)),objectEach(t,function(e,i){c[i]&&"function"==typeof c[i].update?c[i].update(e,!1):"function"==typeof c[h[i]]?c[h[i]](e):"color"!==i&&-1===c.collectionsWithUpdate.indexOf(i)&&merge(!0,c.options[i],t[i]),"chart"!==i&&-1!==c.propsRequireUpdateSeries.indexOf(i)&&(n=!0)}),this.collectionsWithUpdate.forEach(function(e){var s;t[e]&&("series"===e&&(s=[],c[e].forEach(function(t,e){t.options.isInternal||s.push(pick(t.options.index,e))})),splat(t[e]).forEach(function(t,o){var a,n=defined(t.id);n&&(a=c.get(t.id)),a||(a=c[e][s?s[o]:o])&&n&&defined(a.options.id)&&(a=void 0),a&&a.coll===e&&(a.update(t,!1),i&&(a.touched=!0)),!a&&i&&c.collectionsWithInit[e]&&(c.collectionsWithInit[e][0].apply(c,[t].concat(c.collectionsWithInit[e][1]||[]).concat([!1])).touched=!0)}),i&&c[e].forEach(function(t){t.touched||t.options.isInternal?delete t.touched:u.push(t)}))}),u.forEach(function(t){t.remove&&t.remove(!1)}),a&&c.axes.forEach(function(t){t.update({},!1)}),n&&c.getSeriesOrderByLinks().forEach(function(t){t.chart&&t.update({},!1)},this),r=o&&o.width,p=o&&o.height,isString(p)&&(p=relativeLength(p,r||c.chartWidth)),d||isNumber(r)&&r!==c.chartWidth||isNumber(p)&&p!==c.chartHeight?c.setSize(r,p,s):pick(e,!0)&&c.redraw(s),fireEvent(c,"afterUpdate",{options:t,redraw:e,animation:s})},setSubtitle:function(t,e){this.applyDescription("subtitle",t),this.layOutTitles(e)},setCaption:function(t,e){this.applyDescription("caption",t),this.layOutTitles(e)}}),Chart.prototype.collectionsWithInit={xAxis:[Chart.prototype.addAxis,[!0]],yAxis:[Chart.prototype.addAxis,[!1]],series:[Chart.prototype.addSeries]},extend(Point.prototype,{update:function(t,e,i,s){var o,a=this,n=a.series,r=a.graphic,p=n.chart,d=n.options;function c(){a.applyOptions(t);var s=r&&a.hasDummyGraphic,c=null===a.y?!s:s;r&&c&&(a.graphic=r.destroy(),delete a.hasDummyGraphic),isObject(t,!0)&&(r&&r.element&&t&&t.marker&&void 0!==t.marker.symbol&&(a.graphic=r.destroy()),t&&t.dataLabels&&a.dataLabel&&(a.dataLabel=a.dataLabel.destroy()),a.connector&&(a.connector=a.connector.destroy())),o=a.index,n.updateParallelArrays(a,o),d.data[o]=isObject(d.data[o],!0)||isObject(t,!0)?a.options:pick(t,d.data[o]),n.isDirty=n.isDirtyData=!0,!n.fixedBox&&n.hasCartesianSeries&&(p.isDirtyBox=!0),"point"===d.legendType&&(p.isDirtyLegend=!0),e&&p.redraw(i)}e=pick(e,!0),!1===s?c():a.firePointEvent("update",{options:t},c)},remove:function(t,e){this.series.removePoint(this.series.data.indexOf(this),t,e)}}),extend(LineSeries.prototype,{addPoint:function(t,e,i,s,o){var a,n,r,p,d=this.options,c=this.data,h=this.chart,l=this.xAxis,u=l&&l.hasNames&&l.names,m=d.data,f=this.xData;if(e=pick(e,!0),a={series:this},this.pointClass.prototype.applyOptions.apply(a,[t]),p=a.x,r=f.length,this.requireSorting&&p<f[r-1])for(n=!0;r&&f[r-1]>p;)r--;this.updateParallelArrays(a,"splice",r,0,0),this.updateParallelArrays(a,r),u&&a.name&&(u[p]=a.name),m.splice(r,0,t),n&&(this.data.splice(r,0,null),this.processData()),"point"===d.legendType&&this.generatePoints(),i&&(c[0]&&c[0].remove?c[0].remove(!1):(c.shift(),this.updateParallelArrays(a,"shift"),m.shift())),!1!==o&&fireEvent(this,"addPoint",{point:a}),this.isDirty=!0,this.isDirtyData=!0,e&&h.redraw(s)},removePoint:function(t,e,i){var s=this,o=s.data,a=o[t],n=s.points,r=s.chart,p=function(){n&&n.length===o.length&&n.splice(t,1),o.splice(t,1),s.options.data.splice(t,1),s.updateParallelArrays(a||{series:s},"splice",t,1),a&&a.destroy(),s.isDirty=!0,s.isDirtyData=!0,e&&r.redraw()};setAnimation(i,r),e=pick(e,!0),a?a.firePointEvent("remove",null,p):p()},remove:function(t,e,i,s){var o=this,a=o.chart;function n(){o.destroy(s),o.remove=null,a.isDirtyLegend=a.isDirtyBox=!0,a.linkSeries(),pick(t,!0)&&a.redraw(e)}!1!==i?fireEvent(o,"remove",null,n):n()},update:function(t,e){t=H.cleanRecursively(t,this.userOptions),fireEvent(this,"update",{options:t});var i,s,o=this,a=o.chart,n=o.userOptions,r=o.initialType||o.type,p=a.options.plotOptions,d=t.type||n.type||a.options.chart.type,c=!(this.hasDerivedData||d&&d!==this.type||void 0!==t.pointStart||void 0!==t.pointInterval||o.hasOptionChanged("dataGrouping")||o.hasOptionChanged("pointStart")||o.hasOptionChanged("pointInterval")||o.hasOptionChanged("pointIntervalUnit")||o.hasOptionChanged("keys")),h=seriesTypes[r].prototype,l=["eventOptions","navigatorSeries","baseSeries"],u=o.finishedAnimating&&{animation:!1},m={};for(s in c&&(l.push("data","isDirtyData","points","processedXData","processedYData","xIncrement","cropped","_hasPointMarkers","_hasPointLabels","mapMap","mapData","minY","maxY","minX","maxX"),!1!==t.visible&&l.push("area","graph"),o.parallelArrays.forEach(function(t){l.push(t+"Data")}),t.data&&(t.dataSorting&&extend(o.options.dataSorting,t.dataSorting),this.setData(t.data,!1))),t=merge(n,u,{index:void 0===n.index?o.index:n.index,pointStart:pick(p&&p.series&&p.series.pointStart,n.pointStart,o.xData[0])},!c&&{data:o.options.data},t),c&&t.data&&(t.data=o.options.data),(l=["group","markerGroup","dataLabelsGroup","transformGroup"].concat(l)).forEach(function(t){l[t]=o[t],delete o[t]}),o.remove(!1,null,!1,!0),h)o[s]=void 0;if(seriesTypes[d||r]?extend(o,seriesTypes[d||r].prototype):error(17,!0,a,{missingModuleFor:d||r}),l.forEach(function(t){o[t]=l[t]}),o.init(a,t),c&&this.points){if(!1===(i=o.options).visible)m.graphic=1,m.dataLabel=1;else if(!o._hasPointLabels){var f=i.marker,y=i.dataLabels;f&&(!1===f.enabled||"symbol"in f)&&(m.graphic=1),y&&!1===y.enabled&&(m.dataLabel=1)}this.points.forEach(function(t){t&&t.series&&(t.resolveColor(),Object.keys(m).length&&t.destroyElements(m),!1===i.showInLegend&&t.legendItem&&a.legend.destroyItem(t))},this)}o.initialType=r,a.linkSeries(),fireEvent(this,"afterUpdate"),pick(e,!0)&&a.redraw(!!c&&void 0)},setName:function(t){this.name=this.options.name=this.userOptions.name=t,this.chart.isDirtyLegend=!0},hasOptionChanged:function(t){var e=this.chart,i=this.options[t],s=e.options.plotOptions,o=this.userOptions[t];return o?i!==o:i!==pick(s&&s[this.type]&&s[this.type][t],s&&s.series&&s.series[t],i)}}),extend(Axis.prototype,{update:function(t,e){var i=this.chart,s=t&&t.events||{};t=merge(this.userOptions,t),i.options[this.coll].indexOf&&(i.options[this.coll][i.options[this.coll].indexOf(this.userOptions)]=t),objectEach(i.options[this.coll].events,function(t,e){void 0===s[e]&&(s[e]=void 0)}),this.destroy(!0),this.init(i,extend(t,{events:s})),i.isDirtyBox=!0,pick(e,!0)&&i.redraw()},remove:function(t){for(var e=this.chart,i=this.coll,s=this.series,o=s.length;o--;)s[o]&&s[o].remove(!1);erase(e.axes,this),erase(e[i],this),isArray(e.options[i])?e.options[i].splice(this.options.index,1):delete e.options[i],e[i].forEach(function(t,e){t.options.index=t.userOptions.index=e}),this.destroy(),e.isDirtyBox=!0,pick(t,!0)&&e.redraw()},setTitle:function(t,e){this.update({title:t},e)},setCategories:function(t,e){this.update({categories:t},e)}});