"use strict";import BaseSeries from"./Series/Series.js";var seriesTypes=BaseSeries.seriesTypes;import Chart from"./Chart/Chart.js";import H from"./Globals.js";var hasTouch=H.hasTouch,svg=H.svg;import Legend from"./Legend.js";import LineSeries from"../Series/LineSeries.js";import O from"./Options.js";var defaultOptions=O.defaultOptions;import Point from"../Core/Series/Point.js";import U from"./Utilities.js";var addEvent=U.addEvent,createElement=U.createElement,css=U.css,defined=U.defined,extend=U.extend,fireEvent=U.fireEvent,isArray=U.isArray,isFunction=U.isFunction,isNumber=U.isNumber,isObject=U.isObject,merge=U.merge,objectEach=U.objectEach,pick=U.pick,TrackerMixin=H.TrackerMixin={drawTrackerPoint:function(){var t,e=this,i=e.chart,o=i.pointer,s=function(t){var e=o.getPointFromEvent(t);void 0!==e&&(o.isDirectTouch=!0,e.onMouseOver(t))};e.points.forEach(function(e){t=isArray(e.dataLabels)?e.dataLabels:e.dataLabel?[e.dataLabel]:[],e.graphic&&(e.graphic.element.point=e),t.forEach(function(t){t.div?t.div.point=e:t.element.point=e})}),e._hasTracking||(e.trackerGroups.forEach(function(t){e[t]&&(e[t].addClass("highcharts-tracker").on("mouseover",s).on("mouseout",function(t){o.onTrackerMouseOut(t)}),hasTouch&&e[t].on("touchstart",s),!i.styledMode&&e.options.cursor&&e[t].css(css).css({cursor:e.options.cursor}))}),e._hasTracking=!0),fireEvent(this,"afterDrawTracker")},drawTrackerGraph:function(){var t=this,e=t.options,i=e.trackByArea,o=[].concat(i?t.areaPath:t.graphPath),s=t.chart,r=s.pointer,a=s.renderer,n=s.options.tooltip.snap,c=t.tracker,h=function(e){s.hoverSeries!==t&&t.onMouseOver()},l="rgba(192,192,192,"+(svg?1e-4:.002)+")";c?c.attr({d:o}):t.graph&&(t.tracker=a.path(o).attr({visibility:t.visible?"visible":"hidden",zIndex:2}).addClass(i?"highcharts-tracker-area":"highcharts-tracker-line").add(t.group),s.styledMode||t.tracker.attr({"stroke-linecap":"round","stroke-linejoin":"round",stroke:l,fill:i?l:"none","stroke-width":t.graph.strokeWidth()+(i?0:2*n)}),[t.tracker,t.markerGroup].forEach(function(t){t.addClass("highcharts-tracker").on("mouseover",h).on("mouseout",function(t){r.onTrackerMouseOut(t)}),e.cursor&&!s.styledMode&&t.css({cursor:e.cursor}),hasTouch&&t.on("touchstart",h)})),fireEvent(this,"afterDrawTracker")}};seriesTypes.column&&(seriesTypes.column.prototype.drawTracker=TrackerMixin.drawTrackerPoint),seriesTypes.pie&&(seriesTypes.pie.prototype.drawTracker=TrackerMixin.drawTrackerPoint),seriesTypes.scatter&&(seriesTypes.scatter.prototype.drawTracker=TrackerMixin.drawTrackerPoint),extend(Legend.prototype,{setItemEvents:function(t,e,i){var o=this,s=o.chart.renderer.boxWrapper,r=t instanceof Point,a="highcharts-legend-"+(r?"point":"series")+"-active",n=o.chart.styledMode;(i?[e,t.legendSymbol]:[t.legendGroup]).forEach(function(i){i&&i.on("mouseover",function(){t.visible&&o.allItems.forEach(function(e){t!==e&&e.setState("inactive",!r)}),t.setState("hover"),t.visible&&s.addClass(a),n||e.css(o.options.itemHoverStyle)}).on("mouseout",function(){o.chart.styledMode||e.css(merge(t.visible?o.itemStyle:o.itemHiddenStyle)),o.allItems.forEach(function(e){t!==e&&e.setState("",!r)}),s.removeClass(a),t.setState()}).on("click",function(e){var i=function(){t.setVisible&&t.setVisible(),o.allItems.forEach(function(e){t!==e&&e.setState(t.visible?"inactive":"",!r)})};s.removeClass(a),e={browserEvent:e},t.firePointEvent?t.firePointEvent("legendItemClick",e,i):fireEvent(t,"legendItemClick",e,i)})})},createCheckboxForItem:function(t){t.checkbox=createElement("input",{type:"checkbox",className:"highcharts-legend-checkbox",checked:t.selected,defaultChecked:t.selected},this.options.itemCheckboxStyle,this.chart.container),addEvent(t.checkbox,"click",function(e){var i=e.target;fireEvent(t.series||t,"checkboxClick",{checked:i.checked,item:t},function(){t.select()})})}}),extend(Chart.prototype,{showResetZoom:function(){var t=this,e=defaultOptions.lang,i=t.options.chart.resetZoomButton,o=i.theme,s=o.states,r="chart"===i.relativeTo||"spaceBox"===i.relativeTo?null:"plotBox";function a(){t.zoomOut()}fireEvent(this,"beforeShowResetZoom",null,function(){t.resetZoomButton=t.renderer.button(e.resetZoom,null,null,a,o,s&&s.hover).attr({align:i.position.align,title:e.resetZoomTitle}).addClass("highcharts-reset-zoom").add().align(i.position,!1,r)}),fireEvent(this,"afterShowResetZoom")},zoomOut:function(){fireEvent(this,"selection",{resetSelection:!0},this.zoom)},zoom:function(t){var e,i,o=this,s=o.pointer,r=!1,a=o.inverted?s.mouseDownX:s.mouseDownY;!t||t.resetSelection?(o.axes.forEach(function(t){e=t.zoom()}),s.initiated=!1):t.xAxis.concat(t.yAxis).forEach(function(t){var i=t.axis,n=o.inverted?i.left:i.top,c=o.inverted?n+i.width:n+i.height,h=i.isXAxis,l=!1;(!h&&a>=n&&a<=c||h||!defined(a))&&(l=!0),s[h?"zoomX":"zoomY"]&&l&&(e=i.zoom(t.min,t.max),i.displayBtn&&(r=!0))}),i=o.resetZoomButton,r&&!i?o.showResetZoom():!r&&isObject(i)&&(o.resetZoomButton=i.destroy()),e&&o.redraw(pick(o.options.chart.animation,t&&t.animation,o.pointCount<100))},pan:function(t,e){var i,o,s,r=this,a=r.hoverPoints,n=r.options.chart,c=r.options.mapNavigation&&r.options.mapNavigation.enabled;i="object"==typeof e?e:{enabled:e,type:"x"},n&&n.panning&&(n.panning=i),s=i.type,fireEvent(this,"pan",{originalEvent:t},function(){a&&a.forEach(function(t){t.setState()});var e=[1];"xy"===s?e=[1,0]:"y"===s&&(e=[0]),e.forEach(function(e){var i,a,n,h=r[e?"xAxis":"yAxis"][0],l=h.horiz,d=t[l?"chartX":"chartY"],p=l?"mouseDownX":"mouseDownY",u=r[p],m=(h.pointRange||0)/2,f=h.reversed&&!r.inverted||!h.reversed&&r.inverted?-1:1,v=h.getExtremes(),g=h.toValue(u-d,!0)+m*f,k=h.toValue(u+h.len-d,!0)-m*f,b=k<g,y=b?k:g,x=b?g:k,E=h.hasVerticalPanning(),S=h.panningState;h.series.forEach(function(t){if(E&&!e&&(!S||S.isDirty)){var i=t.getProcessedData(!0),o=t.getExtremes(i.yData,!0);S||(S={startMin:Number.MAX_VALUE,startMax:-Number.MAX_VALUE}),isNumber(o.dataMin)&&isNumber(o.dataMax)&&(S.startMin=Math.min(o.dataMin,S.startMin),S.startMax=Math.max(o.dataMax,S.startMax))}}),i=Math.min(pick(null==S?void 0:S.startMin,v.dataMin),m?v.min:h.toValue(h.toPixels(v.min)-h.minPixelPadding)),a=Math.max(pick(null==S?void 0:S.startMax,v.dataMax),m?v.max:h.toValue(h.toPixels(v.max)+h.minPixelPadding)),h.panningState=S,h.isOrdinal||((n=i-y)>0&&(x+=n,y=i),(n=x-a)>0&&(x=a,y-=n),h.series.length&&y!==v.min&&x!==v.max&&y>=i&&x<=a&&(h.setExtremes(y,x,!1,!1,{trigger:"pan"}),r.resetZoomButton||c||y===i||x===a||!s.match("y")||(r.showResetZoom(),h.displayBtn=!1),o=!0),r[p]=d)}),o&&r.redraw(!1),css(r.container,{cursor:"move"})})}}),extend(Point.prototype,{select:function(t,e){var i=this,o=i.series,s=o.chart;t=pick(t,!i.selected),this.selectedStaging=t,i.firePointEvent(t?"select":"unselect",{accumulate:e},function(){i.selected=i.options.selected=t,o.options.data[o.data.indexOf(i)]=i.options,i.setState(t&&"select"),e||s.getSelectedPoints().forEach(function(t){var e=t.series;t.selected&&t!==i&&(t.selected=t.options.selected=!1,e.options.data[e.data.indexOf(t)]=t.options,t.setState(s.hoverPoints&&e.options.inactiveOtherPoints?"inactive":""),t.firePointEvent("unselect"))})}),delete this.selectedStaging},onMouseOver:function(t){var e=this.series.chart,i=e.pointer;t=t?i.normalize(t):i.getChartCoordinatesFromPoint(this,e.inverted),i.runPointActions(t,this)},onMouseOut:function(){var t=this.series.chart;this.firePointEvent("mouseOut"),this.series.options.inactiveOtherPoints||(t.hoverPoints||[]).forEach(function(t){t.setState()}),t.hoverPoints=t.hoverPoint=null},importEvents:function(){if(!this.hasImportedEvents){var t=this,e=merge(t.series.options.point,t.options).events;t.events=e,objectEach(e,function(e,i){isFunction(e)&&addEvent(t,i,e)}),this.hasImportedEvents=!0}},setState:function(t,e){var i,o,s,r,a,n=this.series,c=this.state,h=n.options.states[t||"normal"]||{},l=defaultOptions.plotOptions[n.type].marker&&n.options.marker,d=l&&!1===l.enabled,p=l&&l.states&&l.states[t||"normal"]||{},u=!1===p.enabled,m=n.stateMarkerGraphic,f=this.marker||{},v=n.chart,g=n.halo,k=l&&n.markerAttribs;if(!((t=t||"")===this.state&&!e||this.selected&&"select"!==t||!1===h.enabled||t&&(u||d&&!1===p.enabled)||t&&f.states&&f.states[t]&&!1===f.states[t].enabled)){this.state=t,k&&(o=n.markerAttribs(this,t)),this.graphic?(c&&this.graphic.removeClass("highcharts-point-"+c),t&&this.graphic.addClass("highcharts-point-"+t),v.styledMode||(s=n.pointAttribs(this,t),r=pick(v.options.chart.animation,h.animation),n.options.inactiveOtherPoints&&s.opacity&&((this.dataLabels||[]).forEach(function(t){t&&t.animate({opacity:s.opacity},r)}),this.connector&&this.connector.animate({opacity:s.opacity},r)),this.graphic.animate(s,r)),o&&this.graphic.animate(o,pick(v.options.chart.animation,p.animation,l.animation)),m&&m.hide()):(t&&p&&(a=f.symbol||n.symbol,m&&m.currentSymbol!==a&&(m=m.destroy()),o&&(m?m[e?"animate":"attr"]({x:o.x,y:o.y}):a&&(n.stateMarkerGraphic=m=v.renderer.symbol(a,o.x,o.y,o.width,o.height).add(n.markerGroup),m.currentSymbol=a)),!v.styledMode&&m&&m.attr(n.pointAttribs(this,t))),m&&(m[t&&this.isInside?"show":"hide"](),m.element.point=this)),i=h.halo;var b=this.graphic||m,y=b&&b.visibility||"inherit";i&&i.size&&b&&"hidden"!==y&&!this.isCluster?(g||(n.halo=g=v.renderer.path().add(b.parentGroup)),g.show()[e?"animate":"attr"]({d:this.haloPath(i.size)}),g.attr({class:"highcharts-halo highcharts-color-"+pick(this.colorIndex,n.colorIndex)+(this.className?" "+this.className:""),visibility:y,zIndex:-1}),g.point=this,v.styledMode||g.attr(extend({fill:this.color||n.color,"fill-opacity":i.opacity},i.attributes))):g&&g.point&&g.point.haloPath&&g.animate({d:g.point.haloPath(0)},null,g.hide),fireEvent(this,"afterSetState")}},haloPath:function(t){return this.series.chart.renderer.symbols.circle(Math.floor(this.plotX)-t,this.plotY-t,2*t,2*t)}}),extend(LineSeries.prototype,{onMouseOver:function(){var t=this.chart,e=t.hoverSeries;t.pointer.setHoverChartIndex(),e&&e!==this&&e.onMouseOut(),this.options.events.mouseOver&&fireEvent(this,"mouseOver"),this.setState("hover"),t.hoverSeries=this},onMouseOut:function(){var t=this.options,e=this.chart,i=e.tooltip,o=e.hoverPoint;e.hoverSeries=null,o&&o.onMouseOut(),this&&t.events.mouseOut&&fireEvent(this,"mouseOut"),!i||this.stickyTracking||i.shared&&!this.noSharedTooltip||i.hide(),e.series.forEach(function(t){t.setState("",!0)})},setState:function(t,e){var i,o=this,s=o.options,r=o.graph,a=s.inactiveOtherPoints,n=s.states,c=s.lineWidth,h=s.opacity,l=pick(n[t||"normal"]&&n[t||"normal"].animation,o.chart.options.chart.animation),d=0;if(t=t||"",o.state!==t&&([o.group,o.markerGroup,o.dataLabelsGroup].forEach(function(e){e&&(o.state&&e.removeClass("highcharts-series-"+o.state),t&&e.addClass("highcharts-series-"+t))}),o.state=t,!o.chart.styledMode)){if(n[t]&&!1===n[t].enabled)return;if(t&&(c=n[t].lineWidth||c+(n[t].lineWidthPlus||0),h=pick(n[t].opacity,h)),r&&!r.dashstyle)for(i={"stroke-width":c},r.animate(i,l);o["zone-graph-"+d];)o["zone-graph-"+d].attr(i),d+=1;a||[o.group,o.markerGroup,o.dataLabelsGroup,o.labelBySeries].forEach(function(t){t&&t.animate({opacity:h},l)})}e&&a&&o.points&&o.setAllPointsToState(t)},setAllPointsToState:function(t){this.points.forEach(function(e){e.setState&&e.setState(t)})},setVisible:function(t,e){var i,o=this,s=o.chart,r=o.legendItem,a=s.options.chart.ignoreHiddenSeries,n=o.visible;o.visible=t=o.options.visible=o.userOptions.visible=void 0===t?!n:t,i=t?"show":"hide",["group","dataLabelsGroup","markerGroup","tracker","tt"].forEach(function(t){o[t]&&o[t][i]()}),s.hoverSeries!==o&&(s.hoverPoint&&s.hoverPoint.series)!==o||o.onMouseOut(),r&&s.legend.colorizeItem(o,t),o.isDirty=!0,o.options.stacking&&s.series.forEach(function(t){t.options.stacking&&t.visible&&(t.isDirty=!0)}),o.linkedSeries.forEach(function(e){e.setVisible(t,!1)}),a&&(s.isDirtyBox=!0),fireEvent(o,i),!1!==e&&s.redraw()},show:function(){this.setVisible(!0)},hide:function(){this.setVisible(!1)},select:function(t){this.selected=t=this.options.selected=void 0===t?!this.selected:t,this.checkbox&&(this.checkbox.checked=t),fireEvent(this,t?"select":"unselect")},drawTracker:TrackerMixin.drawTrackerGraph});