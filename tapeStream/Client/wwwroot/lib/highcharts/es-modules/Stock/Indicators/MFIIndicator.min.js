import BaseSeries from"../../Core/Series/Series.js";import U from"../../Core/Utilities.js";var error=U.error,isArray=U.isArray;function sumArray(e){return e.reduce(function(e,r){return e+r})}function toFixed(e,r){return parseFloat(e.toFixed(r))}function calculateTypicalPrice(e){return(e[1]+e[2]+e[3])/3}function calculateRawMoneyFlow(e,r){return e*r}BaseSeries.seriesType("mfi","sma",{params:{period:14,volumeSeriesID:"volume",decimals:4}},{nameBase:"Money Flow Index",getValues:function(e,r){var a,i,t,s,o,u,l=r.period,c=e.xData,n=e.yData,m=n?n.length:0,p=r.decimals,y=1,f=e.chart.get(r.volumeSeriesID),h=f&&f.yData,d=[],D=!1,S=[],v=[],F=[],w=[];if(f){if(!(c.length<=l)&&isArray(n[0])&&4===n[0].length&&h){for(a=calculateTypicalPrice(n[y]);y<l+1;)i=a,D=(a=calculateTypicalPrice(n[y]))>=i,t=calculateRawMoneyFlow(a,h[y]),F.push(D?t:0),w.push(D?0:t),y++;for(u=y-1;u<m;u++)u>y-1&&(F.shift(),w.shift(),i=a,D=(a=calculateTypicalPrice(n[u]))>i,t=calculateRawMoneyFlow(a,h[u]),F.push(D?t:0),w.push(D?0:t)),s=sumArray(w),o=toFixed(110-110/(1+sumArray(F)/s),p),d.push([c[u],o]),S.push(c[u]),v.push(o);return{values:d,xData:S,yData:v}}}else error("Series "+r.volumeSeriesID+" not found! Check `volumeSeriesID`.",!0,e.chart)}});
