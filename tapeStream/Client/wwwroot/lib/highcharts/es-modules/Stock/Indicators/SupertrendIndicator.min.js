import BaseSeries from"../../Core/Series/Series.js";var seriesTypes=BaseSeries.seriesTypes;import U from"../../Core/Utilities.js";var correctFloat=U.correctFloat,isArray=U.isArray,merge=U.merge,objectEach=U.objectEach,ATR=seriesTypes.atr,SMA=seriesTypes.sma;function createPointObj(o,e,r){return{index:e,close:o.yData[e][r],x:o.xData[e]}}BaseSeries.seriesType("supertrend","sma",{params:{multiplier:3,period:10},risingTrendColor:"#06B535",fallingTrendColor:"#F21313",changeTrendLine:{styles:{lineWidth:1,lineColor:"#333333",dashStyle:"LongDash"}}},{nameBase:"Supertrend",nameComponents:["multiplier","period"],requiredIndicators:["atr"],init:function(){var o,e;SMA.prototype.init.apply(this,arguments),o=this.options,e=this.linkedParent.options,o.cropThreshold=e.cropThreshold-(o.params.period-1)},drawGraph:function(){for(var o,e,r,t,i,l,s,n,a,p=this,c=p.options,h=p.linkedParent,d=h?h.points:[],y=p.points,g=p.graph,u=y.length,x=d.length-u,m=x>0?x:0,T={options:{gapSize:c.gapSize}},C={top:[],bottom:[],intersect:[]},f={top:{styles:{lineWidth:c.lineWidth,lineColor:c.fallingTrendColor||c.color,dashStyle:c.dashStyle}},bottom:{styles:{lineWidth:c.lineWidth,lineColor:c.risingTrendColor||c.color,dashStyle:c.dashStyle}},intersect:c.changeTrendLine};u--;)o=y[u],e=y[u-1],r=d[u-1+m],t=d[u-2+m],i=d[u+m],l=d[u+m+1],s=o.options.color,n={x:o.x,plotX:o.plotX,plotY:o.plotY,isNull:!1},!t&&r&&h.yData[r.index-1]&&(t=createPointObj(h,r.index-1,3)),!l&&i&&h.yData[i.index+1]&&(l=createPointObj(h,i.index+1,3)),!r&&t&&h.yData[t.index+1]?r=createPointObj(h,t.index+1,3):!r&&i&&h.yData[i.index-1]&&(r=createPointObj(h,i.index-1,3)),o&&r&&i&&t&&o.x!==r.x&&(o.x===i.x?(t=r,r=i):o.x===t.x?(r=t,t={close:h.yData[r.index-1][3],x:h.xData[r.index-1]}):l&&o.x===l.x&&(r=l,t=i)),e&&t&&r?(a={x:e.x,plotX:e.plotX,plotY:e.plotY,isNull:!1},o.y>=r.close&&e.y>=t.close?(o.color=s||c.fallingTrendColor||c.color,C.top.push(n)):o.y<r.close&&e.y<t.close?(o.color=s||c.risingTrendColor||c.color,C.bottom.push(n)):(C.intersect.push(n),C.intersect.push(a),C.intersect.push(merge(a,{isNull:!0})),o.y>=r.close&&e.y<t.close?(o.color=s||c.fallingTrendColor||c.color,e.color=s||c.risingTrendColor||c.color,C.top.push(n),C.top.push(merge(a,{isNull:!0}))):o.y<r.close&&e.y>=t.close&&(o.color=s||c.risingTrendColor||c.color,e.color=s||c.fallingTrendColor||c.color,C.bottom.push(n),C.bottom.push(merge(a,{isNull:!0}))))):r&&(o.y>=r.close?(o.color=s||c.fallingTrendColor||c.color,C.top.push(n)):(o.color=s||c.risingTrendColor||c.color,C.bottom.push(n)));objectEach(C,function(o,e){p.points=o,p.options=merge(f[e].styles,T),p.graph=p["graph"+e+"Line"],SMA.prototype.drawGraph.call(p),p["graph"+e+"Line"]=p.graph}),p.points=y,p.options=c,p.graph=g},getValues:function(o,e){var r,t,i,l,s,n,a,p,c,h,d=e.period,y=e.multiplier,g=o.xData,u=o.yData,x=[],m=[],T=[],C=0===d?0:d-1,f=[],S=[];if(!(g.length<=d||!isArray(u[0])||4!==u[0].length||d<0)){for(r=ATR.prototype.getValues.call(this,o,{period:d}).yData,h=0;h<r.length;h++)c=u[C+h],p=u[C+h-1]||[],s=f[h-1],n=S[h-1],a=T[h-1],0===h&&(s=n=a=0),t=correctFloat((c[1]+c[2])/2+y*r[h]),i=correctFloat((c[1]+c[2])/2-y*r[h]),t<s||p[3]>s?f[h]=t:f[h]=s,i>n||p[3]<n?S[h]=i:S[h]=n,a===s&&c[3]<f[h]||a===n&&c[3]<S[h]?l=f[h]:(a===s&&c[3]>f[h]||a===n&&c[3]>S[h])&&(l=S[h]),x.push([g[C+h],l]),m.push(g[C+h]),T.push(l);return{values:x,xData:m,yData:T}}}});