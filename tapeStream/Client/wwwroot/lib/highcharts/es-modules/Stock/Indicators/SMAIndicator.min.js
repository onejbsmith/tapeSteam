import BaseSeries from"../../Core/Series/Series.js";var seriesTypes=BaseSeries.seriesTypes;import H from"../../Core/Globals.js";import requiredIndicator from"../../Mixins/IndicatorRequired.js";import U from"../../Core/Utilities.js";var addEvent=U.addEvent,error=U.error,extend=U.extend,isArray=U.isArray,pick=U.pick,splat=U.splat;import"../../Series/LineSeries.js";import"../../Series/OHLCSeries.js";var Series=H.Series,ohlcProto=seriesTypes.ohlc.prototype,generateMessage=requiredIndicator.generateMessage;addEvent(H.Series,"init",function(e){var a=e.options;a.useOhlcData&&"highcharts-navigator-series"!==a.id&&extend(this,{pointValKey:ohlcProto.pointValKey,keys:ohlcProto.keys,pointArrayMap:ohlcProto.pointArrayMap,toYData:ohlcProto.toYData})}),addEvent(Series,"afterSetOptions",function(e){var a=e.options,t=a.dataGrouping;t&&a.useOhlcData&&"highcharts-navigator-series"!==a.id&&(t.approximation="ohlc")}),BaseSeries.seriesType("sma","line",{name:void 0,tooltip:{valueDecimals:4},linkedTo:void 0,compareToMain:!1,params:{index:0,period:14}},{processData:function(){var e=this.options.compareToMain,a=this.linkedParent;Series.prototype.processData.apply(this,arguments),a&&a.compareValue&&e&&(this.compareValue=a.compareValue)},bindTo:{series:!0,eventName:"updatedData"},hasDerivedData:!0,useCommonDataGrouping:!0,nameComponents:["period"],nameSuffixes:[],calculateOn:"init",requiredIndicators:[],requireIndicators:function(){var e={allLoaded:!0};return this.requiredIndicators.forEach(function(a){seriesTypes[a]?seriesTypes[a].prototype.requireIndicators():(e.allLoaded=!1,e.needed=a)}),e},init:function(e,a){var t=this,i=t.requireIndicators();if(!i.allLoaded)return error(generateMessage(t.type,i.needed));function r(){var e,a,i,r,s,o,n=t.points||[],p=(t.xData||[]).length,d=t.getValues(t.linkedParent,t.options.params)||{values:[],xData:[],yData:[]},l=[],c=!0;if(p&&!t.hasGroupedData&&t.visible&&t.points)if(t.cropped){for(t.xAxis&&(r=t.xAxis.min,s=t.xAxis.max),i=t.cropData(d.xData,d.yData,r,s),o=0;o<i.xData.length;o++)l.push([i.xData[o]].concat(splat(i.yData[o])));e=d.xData.indexOf(t.xData[0]),a=d.xData.indexOf(t.xData[t.xData.length-1]),-1===e&&a===d.xData.length-2&&l[0][0]===n[0].x&&l.shift(),t.updateData(l)}else d.xData.length!==p-1&&d.xData.length!==p+1&&(c=!1,t.updateData(d.values));c&&(t.xData=d.xData,t.yData=d.yData,t.options.data=d.values),!1===t.bindTo.series&&(delete t.processedXData,t.isDirty=!0,t.redraw()),t.isDirtyData=!1}if(Series.prototype.init.call(t,e,a),e.linkSeries(),t.dataEventsToUnbind=[],!t.linkedParent)return error("Series "+t.options.linkedTo+" not found! Check `linkedTo`.",!1,e);if(t.dataEventsToUnbind.push(addEvent(t.bindTo.series?t.linkedParent:t.linkedParent.xAxis,t.bindTo.eventName,r)),"init"===t.calculateOn)r();else var s=addEvent(t.chart,t.calculateOn,function(){r(),s()});return t},getName:function(){var e=this.name,a=[];return e||((this.nameComponents||[]).forEach(function(e,t){a.push(this.options.params[e]+pick(this.nameSuffixes[t],""))},this),e=(this.nameBase||this.type.toUpperCase())+(this.nameComponents?" ("+a.join(", ")+")":"")),e},getValues:function(e,a){var t,i,r=a.period,s=e.xData,o=e.yData,n=o.length,p=0,d=0,l=[],c=[],u=[],h=-1;if(!(s.length<r)){for(isArray(o[0])&&(h=a.index?a.index:0);p<r-1;)d+=h<0?o[p]:o[p][h],p++;for(t=p;t<n;t++)d+=h<0?o[t]:o[t][h],i=[s[t],d/r],l.push(i),c.push(i[0]),u.push(i[1]),d-=h<0?o[t-p]:o[t-p][h];return{values:l,xData:c,yData:u}}},destroy:function(){this.dataEventsToUnbind.forEach(function(e){e()}),Series.prototype.destroy.apply(this,arguments)}});