import Chart from"../Core/Chart/Chart.js";import H from"../Core/Globals.js";import NavigationBindings from"../Extensions/Annotations/NavigationBindings.js";import U from"../Core/Utilities.js";var addEvent=U.addEvent,createElement=U.createElement,css=U.css,extend=U.extend,fireEvent=U.fireEvent,getStyle=U.getStyle,isArray=U.isArray,merge=U.merge,pick=U.pick,setOptions=U.setOptions,DIV="div",SPAN="span",UL="ul",LI="li",PREFIX="highcharts-",activeClass=PREFIX+"active";setOptions({lang:{stockTools:{gui:{simpleShapes:"Simple shapes",lines:"Lines",crookedLines:"Crooked lines",measure:"Measure",advanced:"Advanced",toggleAnnotations:"Toggle annotations",verticalLabels:"Vertical labels",flags:"Flags",zoomChange:"Zoom change",typeChange:"Type change",saveChart:"Save chart",indicators:"Indicators",currentPriceIndicator:"Current Price Indicators",zoomX:"Zoom X",zoomY:"Zoom Y",zoomXY:"Zooom XY",fullScreen:"Fullscreen",typeOHLC:"OHLC",typeLine:"Line",typeCandlestick:"Candlestick",circle:"Circle",label:"Label",rectangle:"Rectangle",flagCirclepin:"Flag circle",flagDiamondpin:"Flag diamond",flagSquarepin:"Flag square",flagSimplepin:"Flag simple",measureXY:"Measure XY",measureX:"Measure X",measureY:"Measure Y",segment:"Segment",arrowSegment:"Arrow segment",ray:"Ray",arrowRay:"Arrow ray",line:"Line",arrowLine:"Arrow line",horizontalLine:"Horizontal line",verticalLine:"Vertical line",infinityLine:"Infinity line",crooked3:"Crooked 3 line",crooked5:"Crooked 5 line",elliott3:"Elliott 3 line",elliott5:"Elliott 5 line",verticalCounter:"Vertical counter",verticalLabel:"Vertical label",verticalArrow:"Vertical arrow",fibonacci:"Fibonacci",pitchfork:"Pitchfork",parallelChannel:"Parallel channel"}},navigation:{popup:{circle:"Circle",rectangle:"Rectangle",label:"Label",segment:"Segment",arrowSegment:"Arrow segment",ray:"Ray",arrowRay:"Arrow ray",line:"Line",arrowLine:"Arrow line",horizontalLine:"Horizontal line",verticalLine:"Vertical line",crooked3:"Crooked 3 line",crooked5:"Crooked 5 line",elliott3:"Elliott 3 line",elliott5:"Elliott 5 line",verticalCounter:"Vertical counter",verticalLabel:"Vertical label",verticalArrow:"Vertical arrow",fibonacci:"Fibonacci",pitchfork:"Pitchfork",parallelChannel:"Parallel channel",infinityLine:"Infinity line",measure:"Measure",measureXY:"Measure XY",measureX:"Measure X",measureY:"Measure Y",flags:"Flags",addButton:"add",saveButton:"save",editButton:"edit",removeButton:"remove",series:"Series",volume:"Volume",connector:"Connector",innerBackground:"Inner background",outerBackground:"Outer background",crosshairX:"Crosshair X",crosshairY:"Crosshair Y",tunnel:"Tunnel",background:"Background"}}},stockTools:{gui:{enabled:!0,className:"highcharts-bindings-wrapper",toolbarClassName:"stocktools-toolbar",buttons:["indicators","separator","simpleShapes","lines","crookedLines","measure","advanced","toggleAnnotations","separator","verticalLabels","flags","separator","zoomChange","fullScreen","typeChange","separator","currentPriceIndicator","saveChart"],definitions:{separator:{symbol:"separator.svg"},simpleShapes:{items:["label","circle","rectangle"],circle:{symbol:"circle.svg"},rectangle:{symbol:"rectangle.svg"},label:{symbol:"label.svg"}},flags:{items:["flagCirclepin","flagDiamondpin","flagSquarepin","flagSimplepin"],flagSimplepin:{symbol:"flag-basic.svg"},flagDiamondpin:{symbol:"flag-diamond.svg"},flagSquarepin:{symbol:"flag-trapeze.svg"},flagCirclepin:{symbol:"flag-elipse.svg"}},lines:{items:["segment","arrowSegment","ray","arrowRay","line","arrowLine","horizontalLine","verticalLine"],segment:{symbol:"segment.svg"},arrowSegment:{symbol:"arrow-segment.svg"},ray:{symbol:"ray.svg"},arrowRay:{symbol:"arrow-ray.svg"},line:{symbol:"line.svg"},arrowLine:{symbol:"arrow-line.svg"},verticalLine:{symbol:"vertical-line.svg"},horizontalLine:{symbol:"horizontal-line.svg"}},crookedLines:{items:["elliott3","elliott5","crooked3","crooked5"],crooked3:{symbol:"crooked-3.svg"},crooked5:{symbol:"crooked-5.svg"},elliott3:{symbol:"elliott-3.svg"},elliott5:{symbol:"elliott-5.svg"}},verticalLabels:{items:["verticalCounter","verticalLabel","verticalArrow"],verticalCounter:{symbol:"vertical-counter.svg"},verticalLabel:{symbol:"vertical-label.svg"},verticalArrow:{symbol:"vertical-arrow.svg"}},advanced:{items:["fibonacci","pitchfork","parallelChannel"],pitchfork:{symbol:"pitchfork.svg"},fibonacci:{symbol:"fibonacci.svg"},parallelChannel:{symbol:"parallel-channel.svg"}},measure:{items:["measureXY","measureX","measureY"],measureX:{symbol:"measure-x.svg"},measureY:{symbol:"measure-y.svg"},measureXY:{symbol:"measure-xy.svg"}},toggleAnnotations:{symbol:"annotations-visible.svg"},currentPriceIndicator:{symbol:"current-price-show.svg"},indicators:{symbol:"indicators.svg"},zoomChange:{items:["zoomX","zoomY","zoomXY"],zoomX:{symbol:"zoom-x.svg"},zoomY:{symbol:"zoom-y.svg"},zoomXY:{symbol:"zoom-xy.svg"}},typeChange:{items:["typeOHLC","typeLine","typeCandlestick"],typeOHLC:{symbol:"series-ohlc.svg"},typeLine:{symbol:"series-line.svg"},typeCandlestick:{symbol:"series-candlestick.svg"}},fullScreen:{symbol:"fullscreen.svg"},saveChart:{symbol:"save-chart.svg"}}}}}),addEvent(Chart,"afterGetContainer",function(){this.setStockTools()}),addEvent(Chart,"getMargins",function(){var e=this.stockTools&&this.stockTools.listWrapper,t=e&&(e.startWidth+getStyle(e,"padding-left")+getStyle(e,"padding-right")||e.offsetWidth);t&&t<this.plotWidth&&(this.plotLeft+=t)}),addEvent(Chart,"destroy",function(){this.stockTools&&this.stockTools.destroy()}),addEvent(Chart,"redraw",function(){this.stockTools&&this.stockTools.guiEnabled&&this.stockTools.redraw()});var Toolbar=function(){function e(e,t,o){this.arrowDown=void 0,this.arrowUp=void 0,this.arrowWrapper=void 0,this.listWrapper=void 0,this.showhideBtn=void 0,this.submenu=void 0,this.toolbar=void 0,this.wrapper=void 0,this.chart=o,this.options=e,this.lang=t,this.iconsURL=this.getIconsURL(),this.guiEnabled=e.enabled,this.visible=pick(e.visible,!0),this.placed=pick(e.placed,!1),this.eventsToUnbind=[],this.guiEnabled&&(this.createHTML(),this.init(),this.showHideNavigatorion()),fireEvent(this,"afterInit")}return e.prototype.init=function(){var e,t=this,o=this.lang,i=this.options,a=this.toolbar,s=t.addSubmenu,r=i.buttons,n=i.definitions,l=a.childNodes;r.forEach(function(i){e=t.addButton(a,n,i,o),t.eventsToUnbind.push(addEvent(e.buttonWrapper,"click",function(){t.eraseActiveButtons(l,e.buttonWrapper)})),isArray(n[i].items)&&s.call(t,e,n[i])})},e.prototype.addSubmenu=function(e,t){var o,i=this,a=e.submenuArrow,s=e.buttonWrapper,r=getStyle(s,"width"),n=this.wrapper,l=this.listWrapper,c=this.toolbar.childNodes,p=0;this.submenu=o=createElement(UL,{className:PREFIX+"submenu-wrapper"},null,s),this.addSubmenuItems(s,t),i.eventsToUnbind.push(addEvent(a,"click",function(e){e.stopPropagation(),i.eraseActiveButtons(c,s),s.className.indexOf(PREFIX+"current")>=0?(l.style.width=l.startWidth+"px",s.classList.remove(PREFIX+"current"),o.style.display="none"):(o.style.display="block",p=o.offsetHeight-s.offsetHeight-3,o.offsetHeight+s.offsetTop>n.offsetHeight&&s.offsetTop>p||(p=0),css(o,{top:-p+"px",left:r+3+"px"}),s.className+=" "+PREFIX+"current",l.startWidth=n.offsetWidth,l.style.width=l.startWidth+getStyle(l,"padding-left")+o.offsetWidth+3+"px")}))},e.prototype.addSubmenuItems=function(e,t){var o,i,a=this,s=this.submenu,r=this.lang,n=this.listWrapper;t.items.forEach(function(o){i=a.addButton(s,t,o,r),a.eventsToUnbind.push(addEvent(i.mainButton,"click",function(){a.switchSymbol(this,e,!0),n.style.width=n.startWidth+"px",s.style.display="none"}))}),o=s.querySelectorAll("li > ."+PREFIX+"menu-item-btn")[0],a.switchSymbol(o,!1)},e.prototype.eraseActiveButtons=function(e,t,o){[].forEach.call(e,function(e){e!==t&&(e.classList.remove(PREFIX+"current"),e.classList.remove(PREFIX+"active"),(o=e.querySelectorAll("."+PREFIX+"submenu-wrapper")).length>0&&(o[0].style.display="none"))})},e.prototype.addButton=function(t,o,i,a){void 0===a&&(a={});var s,r,n,l=o[i],c=l.items,p=e.prototype.classMapping,h=l.className||"";return n=createElement(LI,{className:pick(p[i],"")+" "+h,title:a[i]||i},null,t),s=createElement(SPAN,{className:PREFIX+"menu-item-btn"},null,n),c&&c.length?(r=createElement(SPAN,{className:PREFIX+"submenu-item-arrow "+PREFIX+"arrow-right"},null,n)).style["background-image"]="url("+this.iconsURL+"arrow-bottom.svg)":s.style["background-image"]="url("+this.iconsURL+l.symbol+")",{buttonWrapper:n,mainButton:s,submenuArrow:r}},e.prototype.addNavigation=function(){var e=this.wrapper;this.arrowWrapper=createElement(DIV,{className:PREFIX+"arrow-wrapper"}),this.arrowUp=createElement(DIV,{className:PREFIX+"arrow-up"},null,this.arrowWrapper),this.arrowUp.style["background-image"]="url("+this.iconsURL+"arrow-right.svg)",this.arrowDown=createElement(DIV,{className:PREFIX+"arrow-down"},null,this.arrowWrapper),this.arrowDown.style["background-image"]="url("+this.iconsURL+"arrow-right.svg)",e.insertBefore(this.arrowWrapper,e.childNodes[0]),this.scrollButtons()},e.prototype.scrollButtons=function(){var e=0,t=this.wrapper,o=this.toolbar,i=.1*t.offsetHeight;this.eventsToUnbind.push(addEvent(this.arrowUp,"click",function(){e>0&&(e-=i,o.style["margin-top"]=-e+"px")})),this.eventsToUnbind.push(addEvent(this.arrowDown,"click",function(){t.offsetHeight+e<=o.offsetHeight+i&&(e+=i,o.style["margin-top"]=-e+"px")}))},e.prototype.createHTML=function(){var e,t,o,i=this.chart,a=this.options,s=i.container,r=i.options.navigation,n=r&&r.bindingsClassName;this.wrapper=o=createElement(DIV,{className:PREFIX+"stocktools-wrapper "+a.className+" "+n}),s.parentNode.insertBefore(o,s),this.toolbar=t=createElement(UL,{className:PREFIX+"stocktools-toolbar "+a.toolbarClassName}),this.listWrapper=e=createElement(DIV,{className:PREFIX+"menu-wrapper"}),o.insertBefore(e,o.childNodes[0]),e.insertBefore(t,e.childNodes[0]),this.showHideToolbar(),this.addNavigation()},e.prototype.showHideNavigatorion=function(){this.visible&&this.toolbar.offsetHeight>this.wrapper.offsetHeight-50?this.arrowWrapper.style.display="block":(this.toolbar.style.marginTop="0px",this.arrowWrapper.style.display="none")},e.prototype.showHideToolbar=function(){var e,t=this.chart,o=this.wrapper,i=this.listWrapper,a=this.submenu,s=this.visible;this.showhideBtn=e=createElement(DIV,{className:PREFIX+"toggle-toolbar "+PREFIX+"arrow-left"},null,o),e.style["background-image"]="url("+this.iconsURL+"arrow-right.svg)",s?(o.style.height="100%",e.style.top=getStyle(i,"padding-top")+"px",e.style.left=o.offsetWidth+getStyle(i,"padding-left")+"px"):(a&&(a.style.display="none"),e.style.left="0px",this.visible=s=!1,i.classList.add(PREFIX+"hide"),e.classList.toggle(PREFIX+"arrow-right"),o.style.height=e.offsetHeight+"px"),this.eventsToUnbind.push(addEvent(e,"click",function(){t.update({stockTools:{gui:{visible:!s,placed:!0}}})}))},e.prototype.switchSymbol=function(e,t){var o=e.parentNode,i=o.classList.value,a=o.parentNode.parentNode;a.className="",i&&a.classList.add(i.trim()),a.querySelectorAll("."+PREFIX+"menu-item-btn")[0].style["background-image"]=e.style["background-image"],t&&this.selectButton(a)},e.prototype.selectButton=function(e){e.className.indexOf(activeClass)>=0?e.classList.remove(activeClass):e.classList.add(activeClass)},e.prototype.unselectAllButtons=function(e){var t=e.parentNode.querySelectorAll("."+activeClass);[].forEach.call(t,function(t){t!==e&&t.classList.remove(activeClass)})},e.prototype.update=function(e){merge(!0,this.chart.options.stockTools,e),this.destroy(),this.chart.setStockTools(e),this.chart.navigationBindings&&this.chart.navigationBindings.update()},e.prototype.destroy=function(){var e=this.wrapper,t=e&&e.parentNode;this.eventsToUnbind.forEach(function(e){e()}),t&&t.removeChild(e),this.chart.isDirtyBox=!0,this.chart.redraw()},e.prototype.redraw=function(){this.showHideNavigatorion()},e.prototype.getIconsURL=function(){return this.chart.options.navigation.iconsURL||this.options.iconsURL||"https://code.highcharts.com/8.2.2/gfx/stock-icons/"},e}();Toolbar.prototype.classMapping={circle:PREFIX+"circle-annotation",rectangle:PREFIX+"rectangle-annotation",label:PREFIX+"label-annotation",segment:PREFIX+"segment",arrowSegment:PREFIX+"arrow-segment",ray:PREFIX+"ray",arrowRay:PREFIX+"arrow-ray",line:PREFIX+"infinity-line",arrowLine:PREFIX+"arrow-infinity-line",verticalLine:PREFIX+"vertical-line",horizontalLine:PREFIX+"horizontal-line",crooked3:PREFIX+"crooked3",crooked5:PREFIX+"crooked5",elliott3:PREFIX+"elliott3",elliott5:PREFIX+"elliott5",pitchfork:PREFIX+"pitchfork",fibonacci:PREFIX+"fibonacci",parallelChannel:PREFIX+"parallel-channel",measureX:PREFIX+"measure-x",measureY:PREFIX+"measure-y",measureXY:PREFIX+"measure-xy",verticalCounter:PREFIX+"vertical-counter",verticalLabel:PREFIX+"vertical-label",verticalArrow:PREFIX+"vertical-arrow",currentPriceIndicator:PREFIX+"current-price-indicator",indicators:PREFIX+"indicators",flagCirclepin:PREFIX+"flag-circlepin",flagDiamondpin:PREFIX+"flag-diamondpin",flagSquarepin:PREFIX+"flag-squarepin",flagSimplepin:PREFIX+"flag-simplepin",zoomX:PREFIX+"zoom-x",zoomY:PREFIX+"zoom-y",zoomXY:PREFIX+"zoom-xy",typeLine:PREFIX+"series-type-line",typeOHLC:PREFIX+"series-type-ohlc",typeCandlestick:PREFIX+"series-type-candlestick",fullScreen:PREFIX+"full-screen",toggleAnnotations:PREFIX+"toggle-annotations",saveChart:PREFIX+"save-chart",separator:PREFIX+"separator"},extend(Chart.prototype,{setStockTools:function(e){var t=this.options,o=t.lang,i=merge(t.stockTools&&t.stockTools.gui,e&&e.gui),a=o.stockTools&&o.stockTools.gui;this.stockTools=new Toolbar(i,a,this),this.stockTools.guiEnabled&&(this.isDirtyBox=!0)}}),addEvent(NavigationBindings,"selectButton",function(e){var t=e.button,o=PREFIX+"submenu-wrapper",i=this.chart.stockTools;i&&i.guiEnabled&&(i.unselectAllButtons(e.button),t.parentNode.className.indexOf(o)>=0&&(t=t.parentNode.parentNode),i.selectButton(t))}),addEvent(NavigationBindings,"deselectButton",function(e){var t=e.button,o=PREFIX+"submenu-wrapper",i=this.chart.stockTools;i&&i.guiEnabled&&(t.parentNode.className.indexOf(o)>=0&&(t=t.parentNode.parentNode),i.selectButton(t))}),H.Toolbar=Toolbar;export default H.Toolbar;