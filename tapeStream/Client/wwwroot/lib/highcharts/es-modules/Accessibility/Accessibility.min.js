"use strict";import ChartUtilities from"./Utils/ChartUtilities.js";import H from"../Core/Globals.js";var doc=H.doc;import KeyboardNavigationHandler from"./KeyboardNavigationHandler.js";import CartesianSeries from"../Core/Series/CartesianSeries.js";import O from"../Core/Options.js";var defaultOptions=O.defaultOptions;import Point from"../Core/Series/Point.js";import U from"../Core/Utilities.js";var addEvent=U.addEvent,extend=U.extend,fireEvent=U.fireEvent,merge=U.merge;import AccessibilityComponent from"./AccessibilityComponent.js";import KeyboardNavigation from"./KeyboardNavigation.js";import LegendComponent from"./Components/LegendComponent.js";import MenuComponent from"./Components/MenuComponent.js";import SeriesComponent from"./Components/SeriesComponent/SeriesComponent.js";import ZoomComponent from"./Components/ZoomComponent.js";import RangeSelectorComponent from"./Components/RangeSelectorComponent.js";import InfoRegionsComponent from"./Components/InfoRegionsComponent.js";import ContainerComponent from"./Components/ContainerComponent.js";import whcm from"./HighContrastMode.js";import highContrastTheme from"./HighContrastTheme.js";import defaultOptionsA11Y from"./Options/Options.js";import defaultLangOptions from"./Options/LangOptions.js";import copyDeprecatedOptions from"./Options/DeprecatedOptions.js";import"./A11yI18n.js";import"./FocusBorder.js";function Accessibility(t){this.init(t)}merge(!0,defaultOptions,defaultOptionsA11Y,{accessibility:{highContrastTheme:highContrastTheme},lang:defaultLangOptions}),H.A11yChartUtilities=ChartUtilities,H.KeyboardNavigationHandler=KeyboardNavigationHandler,H.AccessibilityComponent=AccessibilityComponent,Accessibility.prototype={init:function(t){this.chart=t,doc.addEventListener&&t.renderer.isSVG?(copyDeprecatedOptions(t),this.initComponents(),this.keyboardNavigation=new KeyboardNavigation(t,this.components),this.update()):t.renderTo.setAttribute("aria-hidden",!0)},initComponents:function(){var t=this.chart,e=t.options.accessibility;this.components={container:new ContainerComponent,infoRegions:new InfoRegionsComponent,legend:new LegendComponent,chartMenu:new MenuComponent,rangeSelector:new RangeSelectorComponent,series:new SeriesComponent,zoom:new ZoomComponent},e.customComponents&&extend(this.components,e.customComponents);var i=this.components;this.getComponentOrder().forEach(function(e){i[e].initBase(t),i[e].init()})},getComponentOrder:function(){if(!this.components)return[];if(!this.components.series)return Object.keys(this.components);var t=Object.keys(this.components).filter(function(t){return"series"!==t});return["series"].concat(t)},update:function(){var t=this.components,e=this.chart,i=e.options.accessibility;fireEvent(e,"beforeA11yUpdate"),e.types=this.getChartTypes(),this.getComponentOrder().forEach(function(i){t[i].onChartUpdate(),fireEvent(e,"afterA11yComponentUpdate",{name:i,component:t[i]})}),this.keyboardNavigation.update(i.keyboardNavigation.order),!e.highContrastModeActive&&whcm.isHighContrastModeActive()&&whcm.setHighContrastTheme(e),fireEvent(e,"afterA11yUpdate",{accessibility:this})},destroy:function(){var t=this.chart||{},e=this.components;Object.keys(e).forEach(function(t){e[t].destroy(),e[t].destroyBase()}),this.keyboardNavigation&&this.keyboardNavigation.destroy(),t.renderTo&&t.renderTo.setAttribute("aria-hidden",!0),t.focusElement&&t.focusElement.removeFocusBorder()},getChartTypes:function(){var t={};return this.chart.series.forEach(function(e){t[e.type]=1}),Object.keys(t)}},H.Chart.prototype.updateA11yEnabled=function(){var t=this.accessibility,e=this.options.accessibility;e&&e.enabled?t?t.update():this.accessibility=t=new Accessibility(this):t?(t.destroy&&t.destroy(),delete this.accessibility):this.renderTo.setAttribute("aria-hidden",!0)},addEvent(H.Chart,"render",function(t){this.a11yDirty&&this.renderTo&&(delete this.a11yDirty,this.updateA11yEnabled());var e=this.accessibility;e&&e.getComponentOrder().forEach(function(t){e.components[t].onChartRender()})}),addEvent(H.Chart,"update",function(t){var e=t.options.accessibility;e&&(e.customComponents&&(this.options.accessibility.customComponents=e.customComponents,delete e.customComponents),merge(!0,this.options.accessibility,e),this.accessibility&&this.accessibility.destroy&&(this.accessibility.destroy(),delete this.accessibility)),this.a11yDirty=!0}),addEvent(Point,"update",function(){this.series.chart.accessibility&&(this.series.chart.a11yDirty=!0)}),["addSeries","init"].forEach(function(t){addEvent(H.Chart,t,function(){this.a11yDirty=!0})}),["update","updatedData","remove"].forEach(function(t){addEvent(CartesianSeries,t,function(){this.chart.accessibility&&(this.chart.a11yDirty=!0)})}),["afterDrilldown","drillupall"].forEach(function(t){addEvent(H.Chart,t,function(){this.accessibility&&this.accessibility.update()})}),addEvent(H.Chart,"destroy",function(){this.accessibility&&this.accessibility.destroy()});