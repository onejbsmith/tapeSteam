"use strict";import H from"../../Core/Globals.js";import U from"../../Core/Utilities.js";var extend=U.extend;import AccessibilityComponent from"../AccessibilityComponent.js";import KeyboardNavigationHandler from"../KeyboardNavigationHandler.js";import ChartUtilities from"../Utils/ChartUtilities.js";var unhideChartElementFromAT=ChartUtilities.unhideChartElementFromAT;import HTMLUtilities from"../Utils/HTMLUtilities.js";var removeElement=HTMLUtilities.removeElement,getFakeMouseEvent=HTMLUtilities.getFakeMouseEvent;function getExportMenuButtonElement(t){return t.exportSVGElements&&t.exportSVGElements[0]}function exportingShouldHaveA11y(t){var e=t.options.exporting,o=getExportMenuButtonElement(t);return!!(e&&!1!==e.enabled&&e.accessibility&&e.accessibility.enabled&&o&&o.element)}H.Chart.prototype.showExportMenu=function(){var t=getExportMenuButtonElement(this);if(t){var e=t.element;e.onclick&&e.onclick(getFakeMouseEvent("click"))}},H.Chart.prototype.hideExportMenu=function(){var t=this.exportDivElements;t&&this.exportContextMenu&&(t.forEach(function(t){"highcharts-menu-item"===t.className&&t.onmouseout&&t.onmouseout(getFakeMouseEvent("mouseout"))}),this.highlightedExportItemIx=0,this.exportContextMenu.hideMenu(),this.container.focus())},H.Chart.prototype.highlightExportItem=function(t){var e,o=this.exportDivElements&&this.exportDivElements[t],i=this.exportDivElements&&this.exportDivElements[this.highlightedExportItemIx];return!(!o||"LI"!==o.tagName||o.children&&o.children.length)&&(e=!!(this.renderTo.getElementsByTagName("g")[0]||{}).focus,o.focus&&e&&o.focus(),i&&i.onmouseout&&i.onmouseout(getFakeMouseEvent("mouseout")),o.onmouseover&&o.onmouseover(getFakeMouseEvent("mouseover")),this.highlightedExportItemIx=t,!0)},H.Chart.prototype.highlightLastExportItem=function(){var t;if(this.exportDivElements)for(t=this.exportDivElements.length;t--;)if(this.highlightExportItem(t))return!0;return!1};var MenuComponent=function(){};MenuComponent.prototype=new AccessibilityComponent,extend(MenuComponent.prototype,{init:function(){var t=this.chart,e=this;this.addEvent(t,"exportMenuShown",function(){e.onMenuShown()}),this.addEvent(t,"exportMenuHidden",function(){e.onMenuHidden()})},onMenuHidden:function(){var t=this.chart.exportContextMenu;t&&t.setAttribute("aria-hidden","true"),this.isExportMenuShown=!1,this.setExportButtonExpandedState("false")},onMenuShown:function(){var t=this.chart,e=t.exportContextMenu;e&&(this.addAccessibleContextMenuAttribs(),unhideChartElementFromAT(t,e)),this.isExportMenuShown=!0,this.setExportButtonExpandedState("true")},setExportButtonExpandedState:function(t){var e=this.exportButtonProxy;e&&e.setAttribute("aria-expanded",t)},onChartRender:function(){var t=this.chart,e=t.options.accessibility;if(removeElement(this.exportProxyGroup),exportingShouldHaveA11y(t)){this.exportProxyGroup=this.addProxyGroup("all"===e.landmarkVerbosity?{"aria-label":t.langFormat("accessibility.exporting.exportRegionLabel",{chart:t}),role:"region"}:{});var o=getExportMenuButtonElement(this.chart);this.exportButtonProxy=this.createProxyButton(o,this.exportProxyGroup,{"aria-label":t.langFormat("accessibility.exporting.menuButtonLabel",{chart:t}),"aria-expanded":"false"})}},addAccessibleContextMenuAttribs:function(){var t=this.chart,e=t.exportDivElements;if(e&&e.length){e.forEach(function(t){"LI"!==t.tagName||t.children&&t.children.length?t.setAttribute("aria-hidden","true"):t.setAttribute("tabindex",-1)});var o=e[0].parentNode;o.removeAttribute("aria-hidden"),o.setAttribute("aria-label",t.langFormat("accessibility.exporting.chartMenuLabel",{chart:t}))}},getKeyboardNavigation:function(){var t=this.keyCodes,e=this.chart,o=this;return new KeyboardNavigationHandler(e,{keyCodeMap:[[[t.left,t.up],function(){return o.onKbdPrevious(this)}],[[t.right,t.down],function(){return o.onKbdNext(this)}],[[t.enter,t.space],function(){return o.onKbdClick(this)}]],validate:function(){return e.exportChart&&!1!==e.options.exporting.enabled&&!1!==e.options.exporting.accessibility.enabled},init:function(){var t=o.exportButtonProxy,i=e.exportingGroup;i&&t&&e.setFocusToElement(i,t)},terminate:function(){e.hideExportMenu()}})},onKbdPrevious:function(t){for(var e=this.chart,o=e.options.accessibility,i=t.response,n=e.highlightedExportItemIx||0;n--;)if(e.highlightExportItem(n))return i.success;return o.keyboardNavigation.wrapAround?(e.highlightLastExportItem(),i.success):i.prev},onKbdNext:function(t){for(var e=this.chart,o=e.options.accessibility,i=t.response,n=(e.highlightedExportItemIx||0)+1;n<e.exportDivElements.length;++n)if(e.highlightExportItem(n))return i.success;return o.keyboardNavigation.wrapAround?(e.highlightExportItem(0),i.success):i.next},onKbdClick:function(t){var e=this.chart,o=e.exportDivElements[e.highlightedExportItemIx],i=getExportMenuButtonElement(e).element;return this.isExportMenuShown?this.fakeClickEvent(o):(this.fakeClickEvent(i),e.highlightExportItem(0)),t.response.success}});export default MenuComponent;