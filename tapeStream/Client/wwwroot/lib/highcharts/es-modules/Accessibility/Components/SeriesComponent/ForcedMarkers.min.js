"use strict";import CartesianSeries from"../../../Core/Series/CartesianSeries.js";import U from"../../../Core/Utilities.js";var addEvent=U.addEvent,merge=U.merge;function isWithinDescriptionThreshold(r){var e=r.chart.options.accessibility;return r.points.length<e.series.pointDescriptionEnabledThreshold||!1===e.series.pointDescriptionEnabledThreshold}function shouldForceMarkers(r){var e=r.chart.options.accessibility.enabled,a=!1!==(r.options.accessibility&&r.options.accessibility.enabled);return e&&a&&isWithinDescriptionThreshold(r)}function hasIndividualPointMarkerOptions(r){return!!(r._hasPointMarkers&&r.points&&r.points.length)}function unforceSeriesMarkerOptions(r){var e=r.resetA11yMarkerOptions;e&&merge(!0,r.options,{marker:{enabled:e.enabled,states:{normal:{opacity:e.states&&e.states.normal&&e.states.normal.opacity}}}})}function forceZeroOpacityMarkerOptions(r){merge(!0,r,{marker:{enabled:!0,states:{normal:{opacity:0}}}})}function getPointMarkerOpacity(r){return r.marker.states&&r.marker.states.normal&&r.marker.states.normal.opacity||1}function unforcePointMarkerOptions(r){merge(!0,r.marker,{states:{normal:{opacity:getPointMarkerOpacity(r)}}})}function handleForcePointMarkers(r){for(var e=r.points.length;e--;){var a=r.points[e],t=a.options;delete a.hasForcedA11yMarker,t.marker&&(t.marker.enabled?(unforcePointMarkerOptions(t),a.hasForcedA11yMarker=!1):(forceZeroOpacityMarkerOptions(t),a.hasForcedA11yMarker=!0))}}function addForceMarkersEvents(){addEvent(CartesianSeries,"render",function(){var r=this.options;shouldForceMarkers(this)?(r.marker&&!1===r.marker.enabled&&(this.a11yMarkersForced=!0,forceZeroOpacityMarkerOptions(this.options)),hasIndividualPointMarkerOptions(this)&&handleForcePointMarkers(this)):this.a11yMarkersForced&&(delete this.a11yMarkersForced,unforceSeriesMarkerOptions(this))}),addEvent(CartesianSeries,"afterSetOptions",function(r){this.resetA11yMarkerOptions=merge(r.options.marker||{},this.userOptions.marker||{})}),addEvent(CartesianSeries,"afterRender",function(){this.chart.styledMode&&(this.markerGroup&&this.markerGroup[this.a11yMarkersForced?"addClass":"removeClass"]("highcharts-a11y-markers-hidden"),hasIndividualPointMarkerOptions(this)&&this.points.forEach(function(r){r.graphic&&(r.graphic[r.hasForcedA11yMarker?"addClass":"removeClass"]("highcharts-a11y-marker-hidden"),r.graphic[!1===r.hasForcedA11yMarker?"addClass":"removeClass"]("highcharts-a11y-marker-visible"))}))})}export default addForceMarkersEvents;