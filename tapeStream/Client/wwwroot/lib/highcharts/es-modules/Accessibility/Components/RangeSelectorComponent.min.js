"use strict";import AccessibilityComponent from"../AccessibilityComponent.js";import ChartUtilities from"../Utils/ChartUtilities.js";var unhideChartElementFromAT=ChartUtilities.unhideChartElementFromAT;import H from"../../Core/Globals.js";import HTMLUtilities from"../Utils/HTMLUtilities.js";var setElAttrs=HTMLUtilities.setElAttrs;import KeyboardNavigationHandler from"../KeyboardNavigationHandler.js";import U from"../../Core/Utilities.js";var extend=U.extend;function shouldRunInputNavigation(t){return t.rangeSelector&&t.rangeSelector.inputGroup&&"hidden"!==t.rangeSelector.inputGroup.element.getAttribute("visibility")&&!1!==t.options.rangeSelector.inputEnabled&&t.rangeSelector.minInput&&t.rangeSelector.maxInput}H.Chart.prototype.highlightRangeSelectorButton=function(t){var e=this.rangeSelector.buttons,n=this.highlightedRangeSelectorItemIx;return void 0!==n&&e[n]&&e[n].setState(this.oldRangeSelectorItemState||0),this.highlightedRangeSelectorItemIx=t,!!e[t]&&(this.setFocusToElement(e[t].box,e[t].element),this.oldRangeSelectorItemState=e[t].state,e[t].setState(2),!0)};var RangeSelectorComponent=function(){};RangeSelectorComponent.prototype=new AccessibilityComponent,extend(RangeSelectorComponent.prototype,{onChartUpdate:function(){var t=this.chart,e=this,n=t.rangeSelector;n&&(n.buttons&&n.buttons.length&&n.buttons.forEach(function(n){unhideChartElementFromAT(t,n.element),e.setRangeButtonAttrs(n)}),n.maxInput&&n.minInput&&["minInput","maxInput"].forEach(function(i,o){var r=n[i];r&&(unhideChartElementFromAT(t,r),e.setRangeInputAttrs(r,"accessibility.rangeSelector."+(o?"max":"min")+"InputLabel"))}))},setRangeButtonAttrs:function(t){var e=this.chart,n=e.langFormat("accessibility.rangeSelector.buttonText",{chart:e,buttonText:t.text&&t.text.textStr});setElAttrs(t.element,{tabindex:-1,role:"button","aria-label":n})},setRangeInputAttrs:function(t,e){var n=this.chart;setElAttrs(t,{tabindex:-1,role:"textbox","aria-label":n.langFormat(e,{chart:n})})},getRangeSelectorButtonNavigation:function(){var t=this.chart,e=this.keyCodes,n=this;return new KeyboardNavigationHandler(t,{keyCodeMap:[[[e.left,e.right,e.up,e.down],function(t){return n.onButtonNavKbdArrowKey(this,t)}],[[e.enter,e.space],function(){return n.onButtonNavKbdClick(this)}]],validate:function(){return t.rangeSelector&&t.rangeSelector.buttons&&t.rangeSelector.buttons.length},init:function(e){var n=t.rangeSelector.buttons.length-1;t.highlightRangeSelectorButton(e>0?0:n)}})},onButtonNavKbdArrowKey:function(t,e){var n=t.response,i=this.keyCodes,o=this.chart,r=o.options.accessibility.keyboardNavigation.wrapAround,a=e===i.left||e===i.up?-1:1;return o.highlightRangeSelectorButton(o.highlightedRangeSelectorItemIx+a)?n.success:r?(t.init(a),n.success):n[a>0?"next":"prev"]},onButtonNavKbdClick:function(t){var e=t.response,n=this.chart;return 3===n.oldRangeSelectorItemState||this.fakeClickEvent(n.rangeSelector.buttons[n.highlightedRangeSelectorItemIx].element),e.success},getRangeSelectorInputNavigation:function(){var t=this.chart,e=this.keyCodes,n=this;return new KeyboardNavigationHandler(t,{keyCodeMap:[[[e.tab,e.up,e.down],function(t,i){var o=t===e.tab&&i.shiftKey||t===e.up?-1:1;return n.onInputKbdMove(this,o)}]],validate:function(){return shouldRunInputNavigation(t)},init:function(t){n.onInputNavInit(t)},terminate:function(){n.onInputNavTerminate()}})},onInputKbdMove:function(t,e){var n=this.chart,i=t.response,o=n.highlightedInputRangeIx=n.highlightedInputRangeIx+e;return o>1||o<0?i[e>0?"next":"prev"]:(n.rangeSelector[o?"maxInput":"minInput"].focus(),i.success)},onInputNavInit:function(t){var e=this.chart,n=t>0?0:1;e.highlightedInputRangeIx=n,e.rangeSelector[n?"maxInput":"minInput"].focus()},onInputNavTerminate:function(){var t=this.chart.rangeSelector||{};t.maxInput&&t.hideInput("max"),t.minInput&&t.hideInput("min")},getKeyboardNavigation:function(){return[this.getRangeSelectorButtonNavigation(),this.getRangeSelectorInputNavigation()]}});export default RangeSelectorComponent;