"use strict";import AccessibilityComponent from"../AccessibilityComponent.js";import ChartUtilities from"../Utils/ChartUtilities.js";var unhideChartElementFromAT=ChartUtilities.unhideChartElementFromAT;import H from"../../Core/Globals.js";var noop=H.noop;import HTMLUtilities from"../Utils/HTMLUtilities.js";var removeElement=HTMLUtilities.removeElement,setElAttrs=HTMLUtilities.setElAttrs;import KeyboardNavigationHandler from"../KeyboardNavigationHandler.js";import U from"../../Core/Utilities.js";var extend=U.extend,pick=U.pick;function chartHasMapZoom(t){return!!(t.mapZoom&&t.mapNavButtons&&t.mapNavButtons.length)}H.Axis.prototype.panStep=function(t,o){var e=o||3,n=this.getExtremes(),r=(n.max-n.min)/e*t,i=n.max+r,a=n.min+r,s=i-a;t<0&&a<n.dataMin?i=(a=n.dataMin)+s:t>0&&i>n.dataMax&&(a=(i=n.dataMax)-s),this.setExtremes(a,i)};var ZoomComponent=noop;ZoomComponent.prototype=new AccessibilityComponent,extend(ZoomComponent.prototype,{init:function(){var t=this,o=this.chart;["afterShowResetZoom","afterDrilldown","drillupall"].forEach(function(e){t.addEvent(o,e,function(){t.updateProxyOverlays()})})},onChartUpdate:function(){var t=this.chart,o=this;t.mapNavButtons&&t.mapNavButtons.forEach(function(e,n){unhideChartElementFromAT(t,e.element),o.setMapNavButtonAttrs(e.element,"accessibility.zoom.mapZoom"+(n?"Out":"In"))})},setMapNavButtonAttrs:function(t,o){var e=this.chart,n=e.langFormat(o,{chart:e});setElAttrs(t,{tabindex:-1,role:"button","aria-label":n})},onChartRender:function(){this.updateProxyOverlays()},updateProxyOverlays:function(){var t=this.chart;removeElement(this.drillUpProxyGroup),removeElement(this.resetZoomProxyGroup),t.resetZoomButton&&this.recreateProxyButtonAndGroup(t.resetZoomButton,"resetZoomProxyButton","resetZoomProxyGroup",t.langFormat("accessibility.zoom.resetZoomButton",{chart:t})),t.drillUpButton&&this.recreateProxyButtonAndGroup(t.drillUpButton,"drillUpProxyButton","drillUpProxyGroup",t.langFormat("accessibility.drillUpButton",{chart:t,buttonText:t.getDrilldownBackText()}))},recreateProxyButtonAndGroup:function(t,o,e,n){removeElement(this[e]),this[e]=this.addProxyGroup(),this[o]=this.createProxyButton(t,this[e],{"aria-label":n,tabindex:-1})},getMapZoomNavigation:function(){var t=this.keyCodes,o=this.chart,e=this;return new KeyboardNavigationHandler(o,{keyCodeMap:[[[t.up,t.down,t.left,t.right],function(t){return e.onMapKbdArrow(this,t)}],[[t.tab],function(t,o){return e.onMapKbdTab(this,o)}],[[t.space,t.enter],function(){return e.onMapKbdClick(this)}]],validate:function(){return chartHasMapZoom(o)},init:function(t){return e.onMapNavInit(t)}})},onMapKbdArrow:function(t,o){var e=this.keyCodes,n=o===e.up||o===e.down?"yAxis":"xAxis",r=o===e.left||o===e.up?-1:1;return this.chart[n][0].panStep(r),t.response.success},onMapKbdTab:function(t,o){var e,n=this.chart,r=t.response,i=o.shiftKey,a=i&&!this.focusedMapNavButtonIx||!i&&this.focusedMapNavButtonIx;return n.mapNavButtons[this.focusedMapNavButtonIx].setState(0),a?(n.mapZoom(),r[i?"prev":"next"]):(this.focusedMapNavButtonIx+=i?-1:1,e=n.mapNavButtons[this.focusedMapNavButtonIx],n.setFocusToElement(e.box,e.element),e.setState(2),r.success)},onMapKbdClick:function(t){return this.fakeClickEvent(this.chart.mapNavButtons[this.focusedMapNavButtonIx].element),t.response.success},onMapNavInit:function(t){var o=this.chart,e=o.mapNavButtons[0],n=o.mapNavButtons[1],r=t>0?e:n;o.setFocusToElement(r.box,r.element),r.setState(2),this.focusedMapNavButtonIx=t>0?0:1},simpleButtonNavigation:function(t,o,e){var n=this.keyCodes,r=this,i=this.chart;return new KeyboardNavigationHandler(i,{keyCodeMap:[[[n.tab,n.up,n.down,n.left,n.right],function(t,o){var e=t===n.tab&&o.shiftKey||t===n.left||t===n.up;return this.response[e?"prev":"next"]}],[[n.space,n.enter],function(){var t=e(this,i);return pick(t,this.response.success)}]],validate:function(){return i[t]&&i[t].box&&r[o]},init:function(){i.setFocusToElement(i[t].box,r[o])}})},getKeyboardNavigation:function(){return[this.simpleButtonNavigation("resetZoomButton","resetZoomProxyButton",function(t,o){o.zoomOut()}),this.simpleButtonNavigation("drillUpButton","drillUpProxyButton",function(t,o){return o.drillUp(),t.response.prev}),this.getMapZoomNavigation()]}});export default ZoomComponent;