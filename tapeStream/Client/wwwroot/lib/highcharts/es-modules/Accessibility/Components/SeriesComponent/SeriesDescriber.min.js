"use strict";import AnnotationsA11y from"../AnnotationsA11y.js";var getPointAnnotationTexts=AnnotationsA11y.getPointAnnotationTexts;import ChartUtilities from"../../Utils/ChartUtilities.js";var getAxisDescription=ChartUtilities.getAxisDescription,getSeriesFirstPointElement=ChartUtilities.getSeriesFirstPointElement,getSeriesA11yElement=ChartUtilities.getSeriesA11yElement,unhideChartElementFromAT=ChartUtilities.unhideChartElementFromAT;import HTMLUtilities from"../../Utils/HTMLUtilities.js";var escapeStringForHTML=HTMLUtilities.escapeStringForHTML,reverseChildNodes=HTMLUtilities.reverseChildNodes,stripHTMLTags=HTMLUtilities.stripHTMLTagsFromString;import Tooltip from"../../../Core/Tooltip.js";import U from"../../../Core/Utilities.js";var find=U.find,format=U.format,isNumber=U.isNumber,numberFormat=U.numberFormat,pick=U.pick,defined=U.defined;function findFirstPointWithGraphic(e){var i=e.index;return e.series&&e.series.data&&defined(i)&&find(e.series.data,function(e){return!!(e&&void 0!==e.index&&e.index>i&&e.graphic&&e.graphic.element)})||null}function shouldAddDummyPoint(e){var i=e.series&&e.series.is("sunburst");return e.isNull&&!i}function makeDummyElement(e,i){var t=e.series.chart.renderer.rect(i.x,i.y,1,1);return t.attr({class:"highcharts-a11y-dummy-point",fill:"none",opacity:0,"fill-opacity":0,"stroke-opacity":0}),t}function addDummyPointElement(e){var i=e.series,t=findFirstPointWithGraphic(e),r=t&&t.graphic,s=r?r.parentGroup:i.graph||i.group,n=makeDummyElement(e,t?{x:pick(e.plotX,t.plotX,0),y:pick(e.plotY,t.plotY,0)}:{x:pick(e.plotX,0),y:pick(e.plotY,0)});if(s&&s.element)return e.graphic=n,e.hasDummyGraphic=!0,n.add(s),s.element.insertBefore(n.element,r?r.element:null),n.element}function hasMorePointsThanDescriptionThreshold(e){var i=e.chart.options.accessibility.series.pointDescriptionEnabledThreshold;return!!(!1!==i&&e.points&&e.points.length>=i)}function shouldSetScreenReaderPropsOnPoints(e){var i=e.options.accessibility||{};return!hasMorePointsThanDescriptionThreshold(e)&&!i.exposeAsGroupOnly}function shouldSetKeyboardNavPropsOnPoints(e){var i=e.chart.options.accessibility.keyboardNavigation.seriesNavigation;return!(!e.points||!(e.points.length<i.pointNavigationEnabledThreshold||!1===i.pointNavigationEnabledThreshold))}function shouldDescribeSeriesElement(e){var i=e.chart,t=i.options.chart||{},r=t.options3d&&t.options3d.enabled,s=i.series.length>1,n=i.options.accessibility.series.describeSingleSeries,o=(e.options.accessibility||{}).exposeAsGroupOnly;return!(r&&s)&&(s||n||o||hasMorePointsThanDescriptionThreshold(e))}function pointNumberToString(e,i){var t=e.series.chart,r=t.options.accessibility.point||{},s=e.series.tooltipOptions||{},n=t.options.lang;return isNumber(i)?numberFormat(i,r.valueDecimals||s.valueDecimals||-1,n.decimalPoint,n.accessibility.thousandsSep||n.thousandsSep):i}function getSeriesDescriptionText(e){var i=(e.options.accessibility||{}).description;return i&&e.chart.langFormat("accessibility.series.description",{description:i,series:e})||""}function getSeriesAxisDescriptionText(e,i){var t=e[i];return e.chart.langFormat("accessibility.series."+i+"Description",{name:getAxisDescription(t),series:e})}function getPointA11yTimeDescription(e){var i=e.series,t=i.chart,r=t.options.accessibility.point||{};if(i.xAxis&&i.xAxis.dateTime){var s=Tooltip.prototype.getXDateFormat.call({getDateFormat:Tooltip.prototype.getDateFormat,chart:t},e,t.options.tooltip,i.xAxis),n=r.dateFormatter&&r.dateFormatter(e)||r.dateFormat||s;return t.time.dateFormat(n,e.x,void 0)}}function getPointXDescription(e){var i=getPointA11yTimeDescription(e),t=(e.series.xAxis||{}).categories&&defined(e.category)&&(""+e.category).replace("<br/>"," "),r=e.id&&e.id.indexOf("highcharts-")<0,s="x, "+e.x;return e.name||i||t||(r?e.id:s)}function getPointArrayMapValueDescription(e,i,t){var r=i||"",s=t||"";return e.series.pointArrayMap.reduce(function(i,t){return i+(i.length?", ":"")+function(i){var t=pointNumberToString(e,pick(e[i],e.options[i]));return i+": "+r+t+s}(t)},"")}function getPointValue(e){var i=e.series,t=i.chart.options.accessibility.point||{},r=i.tooltipOptions||{},s=t.valuePrefix||r.valuePrefix||"",n=t.valueSuffix||r.valueSuffix||"",o=pointNumberToString(e,e[void 0!==e.value?"value":"y"]);return e.isNull?i.chart.langFormat("accessibility.series.nullPointValue",{point:e}):i.pointArrayMap?getPointArrayMapValueDescription(e,s,n):s+o+n}function getPointAnnotationDescription(e){var i=e.series.chart,t=getPointAnnotationTexts(e),r={point:e,annotations:t};return t.length?i.langFormat("accessibility.series.pointAnnotationsDescription",r):""}function getPointValueDescription(e){var i=e.series,t=i.chart,r=t.options.accessibility.point.valueDescriptionFormat,s=pick(i.xAxis&&i.xAxis.options.accessibility&&i.xAxis.options.accessibility.enabled,!t.angular),n=s?getPointXDescription(e):"",o={point:e,index:defined(e.index)?e.index+1:"",xDescription:n,value:getPointValue(e),separator:s?", ":""};return format(r,o,t)}function defaultPointDescriptionFormatter(e){var i=e.series,t=i.chart,r=getPointValueDescription(e),s=e.options&&e.options.accessibility&&e.options.accessibility.description,n=s?" "+s:"",o=t.series.length>1&&i.name?" "+i.name+".":"",a=getPointAnnotationDescription(e),c=a?" "+a:"";return e.accessibility=e.accessibility||{},e.accessibility.valueDescription=r,r+n+o+c}function setPointScreenReaderAttribs(e,i){var t=e.series,r=t.chart.options.accessibility.point||{},s=t.options.accessibility||{},n=escapeStringForHTML(stripHTMLTags(s.pointDescriptionFormatter&&s.pointDescriptionFormatter(e)||r.descriptionFormatter&&r.descriptionFormatter(e)||defaultPointDescriptionFormatter(e)));i.setAttribute("role","img"),i.setAttribute("aria-label",n)}function describePointsInSeries(e){var i=shouldSetScreenReaderPropsOnPoints(e),t=shouldSetKeyboardNavPropsOnPoints(e);(i||t)&&e.points.forEach(function(e){var t=e.graphic&&e.graphic.element||shouldAddDummyPoint(e)&&addDummyPointElement(e);t&&(t.setAttribute("tabindex","-1"),t.style.outline="0",i?setPointScreenReaderAttribs(e,t):t.setAttribute("aria-hidden",!0))})}function defaultSeriesDescriptionFormatter(e){var i=e.chart,t=i.types||[],r=getSeriesDescriptionText(e),s=function(t){return i[t]&&i[t].length>1&&e[t]},n=getSeriesAxisDescriptionText(e,"xAxis"),o=getSeriesAxisDescriptionText(e,"yAxis"),a={name:e.name||"",ix:e.index+1,numSeries:i.series&&i.series.length,numPoints:e.points&&e.points.length,series:e},c=t.length>1?"Combination":"";return(i.langFormat("accessibility.series.summary."+e.type+c,a)||i.langFormat("accessibility.series.summary.default"+c,a))+(r?" "+r:"")+(s("yAxis")?" "+o:"")+(s("xAxis")?" "+n:"")}function describeSeriesElement(e,i){var t=e.options.accessibility||{},r=e.chart.options.accessibility,s=r.landmarkVerbosity;t.exposeAsGroupOnly?i.setAttribute("role","img"):"all"===s&&i.setAttribute("role","region"),i.setAttribute("tabindex","-1"),i.style.outline="0",i.setAttribute("aria-label",escapeStringForHTML(stripHTMLTags(r.series.descriptionFormatter&&r.series.descriptionFormatter(e)||defaultSeriesDescriptionFormatter(e))))}function describeSeries(e){var i=e.chart,t=getSeriesFirstPointElement(e),r=getSeriesA11yElement(e),s=i.is3d&&i.is3d();r&&(r.lastChild!==t||s||reverseChildNodes(r),describePointsInSeries(e),unhideChartElementFromAT(i,r),shouldDescribeSeriesElement(e)?describeSeriesElement(e,r):r.setAttribute("aria-label",""))}var SeriesDescriber={describeSeries:describeSeries,defaultPointDescriptionFormatter:defaultPointDescriptionFormatter,defaultSeriesDescriptionFormatter:defaultSeriesDescriptionFormatter,getPointA11yTimeDescription:getPointA11yTimeDescription,getPointXDescription:getPointXDescription,getPointValue:getPointValue,getPointValueDescription:getPointValueDescription};export default SeriesDescriber;