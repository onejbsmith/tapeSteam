"use strict";import H from"../Core/Globals.js";import SVGElement from"../Core/Renderer/SVG/SVGElement.js";import SVGLabel from"../Core/Renderer/SVG/SVGLabel.js";import U from"../Core/Utilities.js";var addEvent=U.addEvent,extend=U.extend,pick=U.pick,svgElementBorderUpdateTriggers=["x","y","transform","width","height","r","d","stroke-width"];function addDestroyFocusBorderHook(o){if(!o.focusBorderDestroyHook){var e=o.destroy;o.destroy=function(){var r,t;return null===(t=null===(r=o.focusBorder)||void 0===r?void 0:r.destroy)||void 0===t||t.call(r),e.apply(o,arguments)},o.focusBorderDestroyHook=e}}function removeDestroyFocusBorderHook(o){o.focusBorderDestroyHook&&(o.destroy=o.focusBorderDestroyHook,delete o.focusBorderDestroyHook)}function addUpdateFocusBorderHooks(o){for(var e=[],r=1;r<arguments.length;r++)e[r-1]=arguments[r];o.focusBorderUpdateHooks||(o.focusBorderUpdateHooks={},svgElementBorderUpdateTriggers.forEach(function(r){var t=r+"Setter",s=o[t]||o._defaultSetter;o.focusBorderUpdateHooks[t]=s,o[t]=function(){var r=s.apply(o,arguments);return o.addFocusBorder.apply(o,e),r}}))}function removeUpdateFocusBorderHooks(o){o.focusBorderUpdateHooks&&(Object.keys(o.focusBorderUpdateHooks).forEach(function(e){var r=o.focusBorderUpdateHooks[e];r===o._defaultSetter?delete o[e]:o[e]=r}),delete o.focusBorderUpdateHooks)}extend(SVGElement.prototype,{addFocusBorder:function(o,e){this.focusBorder&&this.removeFocusBorder();var r=this.getBBox(),t=pick(o,3);r.x+=this.translateX?this.translateX:0,r.y+=this.translateY?this.translateY:0;var s=r.x-t,d=r.y-t,i=r.width+2*t,a=r.height+2*t;var n,c,u,h=this instanceof SVGLabel;if("text"===this.element.nodeName||h){var f=!!this.rotation,l=h?{x:f?1:0,y:0}:(c=0,u=0,"middle"===(n=this).attr("text-anchor")?(c=H.isFirefox&&n.rotation?.25:.5,u=H.isFirefox&&!n.rotation?.75:.5):n.rotation?c=.25:u=.75,{x:c,y:u});if(s=+this.attr("x")-r.width*l.x-t,d=+this.attr("y")-r.height*l.y-t,h&&f){var B=i;i=a,a=B,s=+this.attr("x")-r.height*l.x-t,d=+this.attr("y")-r.width*l.y-t}}this.focusBorder=this.renderer.rect(s,d,i,a,parseInt((e&&e.borderRadius||0).toString(),10)).addClass("highcharts-focus-border").attr({zIndex:99}).add(this.parentGroup),this.renderer.styledMode||this.focusBorder.attr({stroke:e&&e.stroke,"stroke-width":e&&e.strokeWidth}),addUpdateFocusBorderHooks(this,o,e),addDestroyFocusBorderHook(this)},removeFocusBorder:function(){removeUpdateFocusBorderHooks(this),removeDestroyFocusBorderHook(this),this.focusBorder&&(this.focusBorder.destroy(),delete this.focusBorder)}}),H.Chart.prototype.renderFocusBorder=function(){var o=this.focusElement,e=this.options.accessibility.keyboardNavigation.focusBorder;o&&(o.removeFocusBorder(),e.enabled&&o.addFocusBorder(e.margin,{stroke:e.style.color,strokeWidth:e.style.lineWidth,borderRadius:e.style.borderRadius}))},H.Chart.prototype.setFocusToElement=function(o,e){var r=this.options.accessibility.keyboardNavigation.focusBorder,t=e||o.element;t&&t.focus&&(t.hcEvents&&t.hcEvents.focusin||addEvent(t,"focusin",function(){}),t.focus(),r.hideBrowserFocusOutline&&(t.style.outline="none")),this.focusElement&&this.focusElement.removeFocusBorder(),this.focusElement=o,this.renderFocusBorder()};