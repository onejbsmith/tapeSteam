import Color from"../Core/Color/Color.js";import U from"../Core/Utilities.js";var extend=U.extend,isArray=U.isArray,isNumber=U.isNumber,isObject=U.isObject,merge=U.merge,pick=U.pick,isBoolean=function(e){return"boolean"==typeof e},isFn=function(e){return"function"==typeof e},setTreeValues=function e(o,t){var i,r=t.before,n=t.idRoot,l=t.mapIdToNode[n],s=!isBoolean(t.levelIsConstant)||t.levelIsConstant,a=t.points[o.i],c=a&&a.options||{},d=0,u=[];return extend(o,{levelDynamic:o.level-(s?0:l.level),name:pick(a&&a.name,""),visible:n===o.id||!!isBoolean(t.visible)&&t.visible}),isFn(r)&&(o=r(o,t)),o.children.forEach(function(i,r){var n=extend({},t);extend(n,{index:r,siblings:o.children.length,visible:o.visible}),i=e(i,n),u.push(i),i.visible&&(d+=i.val)}),o.visible=d>0||o.visible,i=pick(c.value,d),extend(o,{children:u,childrenTotal:d,isLeaf:o.visible&&!d,val:i}),o},getColor=function(e,o){var t,i,r,n,l,s,a=o.index,c=o.mapOptionsToLevel,d=o.parentColor,u=o.parentColorIndex,v=o.series,p=o.colors,b=o.siblings,f=v.points,m=v.chart.options.chart;return e&&(t=f[e.i],i=c[e.level]||{},t&&i.colorByPoint&&(n=t.index%(p?p.length:m.colorCount),r=p&&p[n]),v.chart.styledMode||(l=pick(t&&t.options.color,i&&i.color,r,d&&function(e){var o=i&&i.colorVariation;return o&&"brightness"===o.key?Color.parse(e).brighten(o.to*(a/b)).get():e}(d),v.color)),s=pick(t&&t.options.colorIndex,i&&i.colorIndex,n,u,o.colorIndex)),{color:l,colorIndex:s}},getLevelOptions=function(e){var o,t,i,r,n,l,s=null;if(isObject(e))for(s={},r=isNumber(e.from)?e.from:1,l=e.levels,t={},o=isObject(e.defaults)?e.defaults:{},isArray(l)&&(t=l.reduce(function(e,t){var i,n,l;return isObject(t)&&isNumber(t.level)&&(l=merge({},t),n=isBoolean(l.levelIsConstant)?l.levelIsConstant:o.levelIsConstant,delete l.levelIsConstant,delete l.level,i=t.level+(n?0:r-1),isObject(e[i])?extend(e[i],l):e[i]=l),e},{})),n=isNumber(e.to)?e.to:1,i=0;i<=n;i++)s[i]=merge({},o,isObject(t[i])?t[i]:{});return s},updateRootId=function(e){var o,t;return isObject(e)&&(t=isObject(e.options)?e.options:{},o=pick(e.rootNode,t.rootId,""),isObject(e.userOptions)&&(e.userOptions.rootId=o),e.rootNode=o),o},result={getColor:getColor,getLevelOptions:getLevelOptions,setTreeValues:setTreeValues,updateRootId:updateRootId};export default result;