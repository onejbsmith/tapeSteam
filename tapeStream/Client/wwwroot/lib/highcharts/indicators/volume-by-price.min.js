!function(t){"object"==typeof module&&module.exports?module.exports=t.default=t:"function"==typeof define&&define.amd?define("highcharts/indicators/volume-by-price",["highcharts","highcharts/modules/stock"],function(e){return t(e),t.Highcharts=e,t}):t("undefined"!=typeof Highcharts?Highcharts:void 0)}(function(e){function t(e,t,i,s){e.hasOwnProperty(t)||(e[t]=s.apply(null,i))}t(e=e?e._modules:{},"Stock/Indicators/VBPIndicator.js",[e["Core/Animation/AnimationUtilities.js"],e["Core/Series/Series.js"],e["Core/Globals.js"],e["Core/Series/Point.js"],e["Core/Utilities.js"]],function(e,t,s,i,o){var a=e.animObject;e=s.noop;var n=o.addEvent,y=o.arrayMax,d=o.arrayMin,D=o.correctFloat,p=o.error,r=o.extend,u=o.isArray,x=Math.abs,S=t.seriesTypes.column.prototype;t.seriesType("vbp","sma",{params:{ranges:12,volumeSeriesID:"volume"},zoneLines:{enabled:!0,styles:{color:"#0A9AC9",dashStyle:"LongDash",lineWidth:1}},volumeDivision:{enabled:!0,styles:{positiveColor:"rgba(144, 237, 125, 0.8)",negativeColor:"rgba(244, 91, 91, 0.8)"}},animationLimit:1e3,enableMouseTracking:!1,pointPadding:0,zIndex:-1,crisp:!0,dataGrouping:{enabled:!1},dataLabels:{allowOverlap:!0,enabled:!0,format:"P: {point.volumePos:.2f} | N: {point.volumeNeg:.2f}",padding:0,style:{fontSize:"7px"},verticalAlign:"top"}},{nameBase:"Volume by Price",bindTo:{series:!1,eventName:"afterSetExtremes"},calculateOn:"render",markerAttribs:e,drawGraph:e,getColumnMetrics:S.getColumnMetrics,crispCol:S.crispCol,init:function(e){s.seriesTypes.sma.prototype.init.apply(this,arguments);var t=this.options.params,i=this.linkedParent,t=e.get(t.volumeSeriesID);return this.addCustomEvents(i,t),this},addCustomEvents:function(e,t){function i(){s.chart.redraw(),s.setData([]),s.zoneStarts=[],s.zoneLinesSVG&&(s.zoneLinesSVG.destroy(),delete s.zoneLinesSVG)}var s=this;return s.dataEventsToUnbind.push(n(e,"remove",function(){i()})),t&&s.dataEventsToUnbind.push(n(t,"remove",function(){i()})),s},animate:function(e){var i=this,t=i.chart.inverted,s=i.group,o={};!e&&s&&(e=t?"translateY":"translateX",t=t?i.yAxis.top:i.xAxis.left,s["forceAnimate:"+e]=!0,o[e]=t,s.animate(o,r(a(i.options.animation),{step:function(e,t){i.group.attr({scaleX:Math.max(.001,t.pos)})}})))},drawPoints:function(){this.options.volumeDivision.enabled&&(this.posNegVolume(!0,!0),S.drawPoints.apply(this,arguments),this.posNegVolume(!1,!1)),S.drawPoints.apply(this,arguments)},posNegVolume:function(e,t){var i,s=t?["positive","negative"]:["negative","positive"],o=this.options.volumeDivision,a=this.points.length,n=[],r=[],l=0;for(e?(this.posWidths=n,this.negWidths=r):(n=this.posWidths,r=this.negWidths);l<a;l++){var h,p,u=this.points[l];u[s[0]+"Graphic"]=u.graphic,u.graphic=u[s[1]+"Graphic"],e&&(h=u.shapeArgs.width,(i=(p=this.priceZones[l]).wholeVolumeData)?(n.push(h/i*p.positiveVolumeData),r.push(h/i*p.negativeVolumeData)):(n.push(0),r.push(0))),u.color=t?o.styles.positiveColor:o.styles.negativeColor,u.shapeArgs.width=t?this.posWidths[l]:this.negWidths[l],u.shapeArgs.x=t?u.shapeArgs.x:this.posWidths[l]}},translate:function(){var i,s,o,a=this,e=a.options,t=a.chart,n=a.yAxis,r=n.min,l=a.options.zoneLines,h=a.priceZones,p=0;S.translate.apply(a);var u,d,c,m,v,g,f=a.points;f.length&&(u=e.pointPadding<.5?e.pointPadding:.1,e=a.volumeDataArray,d=y(e),c=t.plotWidth/2,m=t.plotTop,v=x(n.toPixels(r)-n.toPixels(r+a.rangeStep)),g=x(n.toPixels(r)-n.toPixels(r+a.rangeStep)),u&&(r=x(v*(1-2*u)),p=x((v-r)/2),v=x(r)),f.forEach(function(e,t){s=e.barX=e.plotX=0,o=e.plotY=n.toPixels(h[t].start)-m-(n.reversed?v-g:v)-p,i=D(c*h[t].wholeVolumeData/d),e.pointWidth=i,e.shapeArgs=a.crispCol.apply(a,[s,o,i,v]),e.volumeNeg=h[t].negativeVolumeData,e.volumePos=h[t].positiveVolumeData,e.volumeAll=h[t].wholeVolumeData}),l.enabled&&a.drawZones(t,n,a.zoneStarts,l.styles))},getValues:function(e,t){var i,s=e.processedXData,o=e.processedYData,a=this.chart,n=t.ranges,r=[],l=[],h=[];if(e.chart)if(i=a.get(t.volumeSeriesID)){if(!(t=u(o[0]))||4===o[0].length)return(this.priceZones=this.specifyZones(t,s,o,n,i)).forEach(function(e,t){r.push([e.x,e.end]),l.push(r[t][0]),h.push(r[t][1])}),{values:r,xData:l,yData:h};p("Type of "+e.name+" series is different than line, OHLC or candlestick.",!0,a)}else p("Series "+t.volumeSeriesID+" not found! Check `volumeSeriesID`.",!0,a);else p("Base series not found! In case it has been removed, add a new one.",!0,a)},specifyZones:function(e,t,i,s,o){if(e){for(var a,n=i.length,r=i[0][3],l=r,h=1;h<n;h++)(a=i[h][3])<r&&(r=a),l<a&&(l=a);n={min:r,max:l}}else n=!1;n=(r=n)?r.min:d(i),a=r?r.max:y(i),r=this.zoneStarts=[],l=[];var p=0,h=1;if(!n||!a)return this.points.length&&(this.setData([]),this.zoneStarts=[],this.zoneLinesSVG.destroy()),[];var u=this.rangeStep=D(a-n)/s;for(r.push(n);p<s-1;p++)r.push(D(r[p]+u));for(r.push(a),s=r.length;h<s;h++)l.push({index:h-1,x:t[0],start:r[h-1],end:r[h]});return this.volumePerZone(e,l,o,t,i)},volumePerZone:function(t,e,i,s,o){var a,n,r,l,h,p=this,u=i.processedXData,d=i.processedYData,c=e.length-1,m=o.length;return i=d.length,x(m-i)&&(s[0]!==u[0]&&d.unshift(0),s[m-1]!==u[i-1]&&d.push(0)),p.volumeDataArray=[],e.forEach(function(e){for(e.wholeVolumeData=0,e.positiveVolumeData=0,h=e.negativeVolumeData=0;h<m;h++)r=n=!1,l=t?o[h][3]:o[h],a=h?t?o[h-1][3]:o[h-1]:l,l<=e.start&&0===e.index&&(n=!0),l>=e.end&&e.index===c&&(r=!0),(l>e.start||n)&&(l<e.end||r)&&(e.wholeVolumeData+=d[h],l<a?e.negativeVolumeData+=d[h]:e.positiveVolumeData+=d[h]);p.volumeDataArray.push(e.wholeVolumeData)}),e},drawZones:function(t,i,e,s){var o,a=t.renderer,n=this.zoneLinesSVG,r=[],l=t.plotWidth,h=t.plotTop;e.forEach(function(e){o=i.toPixels(e)-h,r=r.concat(t.renderer.crispLine([["M",0,o],["L",l,o]],s.lineWidth))}),n?n.animate({d:r}):n=this.zoneLinesSVG=a.path(r).attr({"stroke-width":s.lineWidth,stroke:s.color,dashstyle:s.dashStyle,zIndex:this.group.zIndex+.1}).add(this.group)}},{destroy:function(){return this.negativeGraphic&&(this.negativeGraphic=this.negativeGraphic.destroy()),i.prototype.destroy.apply(this,arguments)}})}),t(e,"masters/indicators/volume-by-price.src.js",[],function(){})});