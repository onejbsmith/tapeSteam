"use strict";!function(t){"object"==typeof module&&module.exports?module.exports=t.default=t:"function"==typeof define&&define.amd?define("highcharts/indicators/volume-by-price",["highcharts","highcharts/modules/stock"],function(e){return t(e),t.Highcharts=e,t}):t("undefined"!=typeof Highcharts?Highcharts:void 0)}(function(e){var t=e?e._modules:{};function o(e,t,o,i){e.hasOwnProperty(t)||(e[t]=i.apply(null,o))}o(t,"Stock/Indicators/VBPIndicator.js",[t["Core/Animation/AnimationUtilities.js"],t["Core/Series/Series.js"],t["Core/Globals.js"],t["Core/Series/Point.js"],t["Core/Utilities.js"]],function(e,t,n,o,i){var r=e.animObject,s=n.noop,a=i.addEvent,x=i.arrayMax,m=i.arrayMin,S=i.correctFloat,u=i.error,l=i.extend,d=i.isArray;var V=Math.abs,b=t.seriesTypes.column.prototype;t.seriesType("vbp","sma",{params:{ranges:12,volumeSeriesID:"volume"},zoneLines:{enabled:!0,styles:{color:"#0A9AC9",dashStyle:"LongDash",lineWidth:1}},volumeDivision:{enabled:!0,styles:{positiveColor:"rgba(144, 237, 125, 0.8)",negativeColor:"rgba(244, 91, 91, 0.8)"}},animationLimit:1e3,enableMouseTracking:!1,pointPadding:0,zIndex:-1,crisp:!0,dataGrouping:{enabled:!1},dataLabels:{allowOverlap:!0,enabled:!0,format:"P: {point.volumePos:.2f} | N: {point.volumeNeg:.2f}",padding:0,style:{fontSize:"7px"},verticalAlign:"top"}},{nameBase:"Volume by Price",bindTo:{series:!1,eventName:"afterSetExtremes"},calculateOn:"render",markerAttribs:s,drawGraph:s,getColumnMetrics:b.getColumnMetrics,crispCol:b.crispCol,init:function(e){var t,o,i,s=this;return n.seriesTypes.sma.prototype.init.apply(s,arguments),t=s.options.params,o=s.linkedParent,i=e.get(t.volumeSeriesID),s.addCustomEvents(o,i),s},addCustomEvents:function(e,t){var o=this;function i(){o.chart.redraw(),o.setData([]),o.zoneStarts=[],o.zoneLinesSVG&&(o.zoneLinesSVG.destroy(),delete o.zoneLinesSVG)}return o.dataEventsToUnbind.push(a(e,"remove",function(){i()})),t&&o.dataEventsToUnbind.push(a(t,"remove",function(){i()})),o},animate:function(e){var t,o,i=this,s=i.chart.inverted,n=i.group,a={};!e&&n&&(t=s?"translateY":"translateX",o=s?i.yAxis.top:i.xAxis.left,n["forceAnimate:"+t]=!0,a[t]=o,n.animate(a,l(r(i.options.animation),{step:function(e,t){i.group.attr({scaleX:Math.max(.001,t.pos)})}})))},drawPoints:function(){var e=this;e.options.volumeDivision.enabled&&(e.posNegVolume(!0,!0),b.drawPoints.apply(e,arguments),e.posNegVolume(!1,!1)),b.drawPoints.apply(e,arguments)},posNegVolume:function(e,t){var o,i,s,n,a=this,r=t?["positive","negative"]:["negative","positive"],l=a.options.volumeDivision,p=a.points.length,h=[],u=[],d=0;for(e?(a.posWidths=h,a.negWidths=u):(h=a.posWidths,u=a.negWidths);d<p;d++)(n=a.points[d])[r[0]+"Graphic"]=n.graphic,n.graphic=n[r[1]+"Graphic"],e&&(o=n.shapeArgs.width,(s=(i=a.priceZones[d]).wholeVolumeData)?(h.push(o/s*i.positiveVolumeData),u.push(o/s*i.negativeVolumeData)):(h.push(0),u.push(0))),n.color=t?l.styles.positiveColor:l.styles.negativeColor,n.shapeArgs.width=t?a.posWidths[d]:a.negWidths[d],n.shapeArgs.x=t?n.shapeArgs.x:a.posWidths[d]},translate:function(){var e,t,o,i,s,n,a,r,l,p,h,u,d=this,c=d.options,m=d.chart,v=d.yAxis,g=v.min,f=d.options.zoneLines,y=d.priceZones,D=0;b.translate.apply(d),(e=d.points).length&&(l=c.pointPadding<.5?c.pointPadding:.1,t=d.volumeDataArray,o=x(t),i=m.plotWidth/2,p=m.plotTop,s=V(v.toPixels(g)-v.toPixels(g+d.rangeStep)),a=V(v.toPixels(g)-v.toPixels(g+d.rangeStep)),l&&(n=V(s*(1-2*l)),D=V((s-n)/2),s=V(n)),e.forEach(function(e,t){h=e.barX=e.plotX=0,u=e.plotY=v.toPixels(y[t].start)-p-(v.reversed?s-a:s)-D,r=S(i*y[t].wholeVolumeData/o),e.pointWidth=r,e.shapeArgs=d.crispCol.apply(d,[h,u,r,s]),e.volumeNeg=y[t].negativeVolumeData,e.volumePos=y[t].positiveVolumeData,e.volumeAll=y[t].wholeVolumeData}),f.enabled&&d.drawZones(m,v,d.zoneStarts,f.styles))},getValues:function(e,t){var o,i,s=e.processedXData,n=e.processedYData,a=this.chart,r=t.ranges,l=[],p=[],h=[];if(e.chart)if(i=a.get(t.volumeSeriesID)){if(!(o=d(n[0]))||4===n[0].length)return(this.priceZones=this.specifyZones(o,s,n,r,i)).forEach(function(e,t){l.push([e.x,e.end]),p.push(l[t][0]),h.push(l[t][1])}),{values:l,xData:p,yData:h};u("Type of "+e.name+" series is different than line, OHLC or candlestick.",!0,a)}else u("Series "+t.volumeSeriesID+" not found! Check `volumeSeriesID`.",!0,a);else u("Base series not found! In case it has been removed, add a new one.",!0,a)},specifyZones:function(e,t,o,i,s){var n,a,r=!!e&&function(e){for(var t,o=e.length,i=e[0][3],s=i,n=1;n<o;n++)(t=e[n][3])<i&&(i=t),s<t&&(s=t);return{min:i,max:s}}(o),l=r?r.min:m(o),p=r?r.max:x(o),h=this.zoneStarts=[],u=[],d=0,c=1;if(!l||!p)return this.points.length&&(this.setData([]),this.zoneStarts=[],this.zoneLinesSVG.destroy()),[];for(n=this.rangeStep=S(p-l)/i,h.push(l);d<i-1;d++)h.push(S(h[d]+n));for(h.push(p),a=h.length;c<a;c++)u.push({index:c-1,x:t[0],start:h[c-1],end:h[c]});return this.volumePerZone(e,u,s,t,o)},volumePerZone:function(t,e,o,i,s){var n,a,r,l,p,h=this,u=o.processedXData,d=o.processedYData,c=e.length-1,m=s.length,v=d.length;return V(m-v)&&(i[0]!==u[0]&&d.unshift(0),i[m-1]!==u[v-1]&&d.push(0)),h.volumeDataArray=[],e.forEach(function(e){for(e.wholeVolumeData=0,e.positiveVolumeData=0,e.negativeVolumeData=0,p=0;p<m;p++)r=a=!1,l=t?s[p][3]:s[p],n=p?t?s[p-1][3]:s[p-1]:l,l<=e.start&&0===e.index&&(a=!0),l>=e.end&&e.index===c&&(r=!0),(l>e.start||a)&&(l<e.end||r)&&(e.wholeVolumeData+=d[p],l<n?e.negativeVolumeData+=d[p]:e.positiveVolumeData+=d[p]);h.volumeDataArray.push(e.wholeVolumeData)}),e},drawZones:function(t,o,e,i){var s,n=t.renderer,a=this.zoneLinesSVG,r=[],l=t.plotWidth,p=t.plotTop;e.forEach(function(e){s=o.toPixels(e)-p,r=r.concat(t.renderer.crispLine([["M",0,s],["L",l,s]],i.lineWidth))}),a?a.animate({d:r}):a=this.zoneLinesSVG=n.path(r).attr({"stroke-width":i.lineWidth,stroke:i.color,dashstyle:i.dashStyle,zIndex:this.group.zIndex+.1}).add(this.group)}},{destroy:function(){return this.negativeGraphic&&(this.negativeGraphic=this.negativeGraphic.destroy()),o.prototype.destroy.apply(this,arguments)}})}),o(t,"masters/indicators/volume-by-price.src.js",[],function(){})});